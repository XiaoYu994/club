{"version":3,"file":"activity.js","sources":["utils/activity.js"],"sourcesContent":["/**\n * activity.js - 活动相关工具函数\n */\n\n/**\n * 获取活动实际状态\n * @param {Object} activity - 活动对象\n * @returns {number} - 活动状态码：0-已取消，1-报名中，2-进行中，3-已结束，-1-未知\n */\nexport function getActualStatus(activity) {\n  if (!activity) return -1;\n  \n  const now = Date.now();\n  const startTime = Number(activity.startTime || 0);\n  const endTime = Number(activity.endTime || 0);\n  \n  if (activity.status === 0) {\n    return 0; // 已取消\n  } else if (now > endTime) {\n    return 3; // 已结束\n  } else if (now >= startTime && now <= endTime) {\n    return 2; // 进行中\n  } else {\n    return 1; // 报名中\n  }\n}\n\n/**\n * 获取状态文本\n * @param {Object} activity - 活动对象\n * @returns {string} - 状态文本\n */\nexport function getStatusText(activity) {\n  const actualStatus = getActualStatus(activity);\n  switch (actualStatus) {\n    case 0: return '已取消';\n    case 1: return '报名中';\n    case 2: return '进行中';\n    case 3: return '已结束';\n    default: return '未知';\n  }\n}\n\n/**\n * 获取状态类名\n * @param {Object} activity - 活动对象\n * @returns {string} - 状态类名\n */\nexport function getStatusClass(activity) {\n  const actualStatus = getActualStatus(activity);\n  switch (actualStatus) {\n    case 0: return 'cancelled';\n    case 1: return 'planned';\n    case 2: return 'ongoing';\n    case 3: return 'ended';\n    default: return '';\n  }\n}\n\n/**\n * 获取报名状态文本\n * @param {number} status - 报名状态码\n * @returns {string} - 报名状态文本\n */\nexport function getApplyStatusText(status) {\n  switch (status) {\n    case 0: return '审核中';\n    case 1: return '已通过';\n    case 2: return '已拒绝';\n    default: return '未知';\n  }\n}\n\n/**\n * 获取报名状态类名\n * @param {number} status - 报名状态码\n * @returns {string} - 报名状态类名\n */\nexport function getApplyStatusClass(status) {\n  switch (status) {\n    case 0: return 'pending';\n    case 1: return 'approved';\n    case 2: return 'rejected';\n    default: return '';\n  }\n}\n\n/**\n * 检查用户信息是否完整\n * @param {Object} userInfo - 用户信息对象\n * @returns {Object} - 包含isComplete和missingFields两个属性\n */\nexport function checkUserInfoComplete(userInfo) {\n  // 检查必要的用户信息字段是否存在且不为空\n  const requiredFields = ['username', 'studentId', 'mobile', 'college', 'className'];\n  const missingFields = [];\n  \n  for (const field of requiredFields) {\n    if (!userInfo[field]) {\n      missingFields.push(getFieldDisplayName(field));\n    }\n  }\n  \n  return {\n    isComplete: missingFields.length === 0,\n    missingFields\n  };\n}\n\n/**\n * 获取字段显示名称\n * @param {string} field - 字段名\n * @returns {string} - 字段显示名称\n */\nexport function getFieldDisplayName(field) {\n  const nameMap = {\n    username: '姓名',\n    studentId: '学号',\n    mobile: '手机号',\n    college: '学院',\n    className: '班级',\n    major: '专业',\n    reason: '参加原因'\n  };\n  return nameMap[field] || field;\n}\n\n/**\n * 解析表单字段\n * @param {string|Object} formConfig - 表单配置\n * @returns {Array} - 解析后的表单字段数组\n */\nexport function parseFormFields(formConfig) {\n  try {\n    if (!formConfig) {\n      // 使用默认表单\n      return [{ \n        key: \"reason\", \n        label: \"参加原因\", \n        type: \"textarea\", \n        required: false, \n        value: \"\" \n      }];\n    }\n    \n    let parsedConfig;\n    \n    // 如果已经是对象，不需要再解析\n    if (typeof formConfig === 'object') {\n      parsedConfig = formConfig;\n    } else {\n      parsedConfig = JSON.parse(formConfig);\n    }\n    \n    // 确保是数组\n    if (!Array.isArray(parsedConfig)) {\n      parsedConfig = [parsedConfig];\n    }\n    \n    // 转换为标准格式\n    return parsedConfig.map(field => {\n      return {\n        key: field.name.toLowerCase().replace(/\\s/g, '_'),\n        label: field.name,\n        type: field.type || 'text',\n        required: field.required || false,\n        value: '',\n        options: field.options || []\n      };\n    });\n  } catch (e) {\n    console.error('解析表单字段失败:', e);\n    // 解析失败时使用默认表单\n    return [{ \n      key: \"reason\", \n      label: \"参加原因\", \n      type: \"textarea\", \n      required: false, \n      value: \"\" \n    }];\n  }\n}\n\n/**\n * 解析表单数据\n * @param {string|Object} forms - 表单数据\n * @returns {Object} - 解析后的表单数据对象\n */\nexport function parseFormData(forms) {\n  try {\n    if (!forms) return {};\n    \n    if (typeof forms === 'string') {\n      return JSON.parse(forms);\n    }\n    \n    if (typeof forms === 'object') {\n      return forms;\n    }\n    \n    return {};\n  } catch (e) {\n    console.error('解析表单数据失败:', e);\n    return {};\n  }\n}\n\n/**\n * 填充用户信息到表单\n * @param {Array} formFields - 表单字段数组\n * @param {Object} userInfo - 用户信息\n * @returns {Array} - 填充后的表单字段数组\n */\nexport function fillUserInfoToForm(formFields, userInfo) {\n  if (!formFields || !Array.isArray(formFields) || !userInfo) {\n    return formFields;\n  }\n  \n  // 用户信息字段映射\n  const userFieldMap = {\n    'username': ['姓名', '名字', '用户名'],\n    'studentId': ['学号', '学生编号', '学生ID'],\n    'mobile': ['手机号', '电话', '联系方式', '手机'],\n    'college': ['学院', '院系'],\n    'className': ['班级', '班组'],\n    'major': ['专业', '学科']\n  };\n  \n  return formFields.map(field => {\n    // 检查字段是否应该填充用户信息\n    for (const [userField, labels] of Object.entries(userFieldMap)) {\n      // 如果字段键名匹配或字段标签匹配\n      if (field.key === userField || labels.includes(field.label)) {\n        field.value = userInfo[userField] || '';\n        break;\n      }\n    }\n    return field;\n  });\n}\n\n/**\n * 验证表单数据\n * @param {Array} formFields - 表单字段数组\n * @returns {Object} - 包含isValid和errorMessage两个属性\n */\nexport function validateFormData(formFields) {\n  if (!formFields || !Array.isArray(formFields)) {\n    return { isValid: false, errorMessage: '表单数据无效' };\n  }\n  \n  for (const field of formFields) {\n    // 检查必填字段是否有值\n    if (field.required) {\n      // 对于checkbox类型，需要特殊处理\n      if (field.type === 'checkbox') {\n        // 如果值是字符串（逗号分隔的选项），检查是否为空\n        if (typeof field.value === 'string') {\n          if (!field.value) {\n            return { \n              isValid: false, \n              errorMessage: `请至少选择一个${field.label}选项` \n            };\n          }\n        } \n        // 如果值是数组，检查是否为空数组\n        else if (Array.isArray(field.value)) {\n          if (field.value.length === 0) {\n            return { \n              isValid: false, \n              errorMessage: `请至少选择一个${field.label}选项` \n            };\n          }\n        }\n        // 如果值既不是字符串也不是数组，则认为是无效值\n        else if (!field.value) {\n          return { \n            isValid: false, \n            errorMessage: `请至少选择一个${field.label}选项` \n          };\n        }\n      } \n      // 其他类型字段的检查\n      else if (!field.value) {\n        return { \n          isValid: false, \n          errorMessage: `请填写${field.label}` \n        };\n      }\n    }\n  }\n  \n  return { isValid: true, errorMessage: '' };\n}\n\n/**\n * 格式化日期时间\n * @param {number|string|Date} timestamp - 时间戳或日期对象\n * @param {string} format - 格式化模式，默认为'YYYY-MM-DD HH:mm'\n * @returns {string} - 格式化后的日期时间字符串\n */\nexport function formatDateTime(timestamp, format = 'YYYY-MM-DD HH:mm') {\n  if (!timestamp) return '';\n  \n  let date;\n  if (timestamp instanceof Date) {\n    date = timestamp;\n  } else {\n    date = new Date(Number(timestamp));\n  }\n  \n  if (isNaN(date.getTime())) return '';\n  \n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  const seconds = String(date.getSeconds()).padStart(2, '0');\n  \n  return format\n    .replace('YYYY', year)\n    .replace('MM', month)\n    .replace('DD', day)\n    .replace('HH', hours)\n    .replace('mm', minutes)\n    .replace('ss', seconds);\n}\n\n/**\n * 构建表单提交数据\n * @param {Array} formFields - 表单字段数组\n * @returns {Object} - 构建后的表单数据对象\n */\nexport function buildFormData(formFields) {\n  if (!formFields || !Array.isArray(formFields)) {\n    return {};\n  }\n  \n  const formData = {};\n  \n  formFields.forEach(field => {\n    formData[field.key] = field.value;\n  });\n  \n  return formData;\n}\n\n/**\n * 检查用户是否已报名活动\n * @param {Object} applyInfo - 报名信息对象\n * @returns {boolean} - 是否已报名\n */\nexport function hasApplied(applyInfo) {\n  return !!applyInfo && (applyInfo.status === 0 || applyInfo.status === 1);\n}\n\n/**\n * 获取报名按钮文本\n * @param {Object} activity - 活动对象\n * @param {Object} applyInfo - 报名信息对象\n * @returns {string} - 按钮文本\n */\nexport function getApplyButtonText(activity, applyInfo) {\n  const actualStatus = getActualStatus(activity);\n  \n  if (actualStatus === 0) {\n    return '活动已取消';\n  } else if (actualStatus === 3) {\n    return '活动已结束';\n  } else if (hasApplied(applyInfo)) {\n    if (applyInfo.status === 0) {\n      return '审核中';\n    } else {\n      return '已报名';\n    }\n  } else if (applyInfo && applyInfo.status === 2) {\n    return '报名被拒绝';\n  } else {\n    return '立即报名';\n  }\n}\n\n/**\n * 获取报名按钮状态\n * @param {Object} activity - 活动对象\n * @param {Object} applyInfo - 报名信息对象\n * @returns {boolean} - 按钮是否禁用\n */\nexport function isApplyButtonDisabled(activity, applyInfo) {\n  const actualStatus = getActualStatus(activity);\n  \n  if (actualStatus === 0 || actualStatus === 3) {\n    return true;\n  } else if (hasApplied(applyInfo)) {\n    return true;\n  } else if (applyInfo && applyInfo.status === 2) {\n    return true;\n  } else {\n    return false;\n  }\n} \n\n/**\n * 通知活动数据已变更\n * 在活动创建、编辑、删除等操作后调用，通知相关页面刷新数据\n */\nexport function notifyActivityDataChanged() {\n  uni.$emit('activityDataChanged', true);\n}\n\n/**\n * 监听活动数据变更事件\n * @param {Function} callback - 数据变更时的回调函数\n * @returns {Function} - 用于移除监听的函数\n */\nexport function listenActivityDataChanged(callback) {\n  uni.$on('activityDataChanged', callback);\n  \n  // 返回一个函数，用于移除监听\n  return () => {\n    uni.$off('activityDataChanged', callback);\n  };\n} "],"names":["uni"],"mappings":"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"}