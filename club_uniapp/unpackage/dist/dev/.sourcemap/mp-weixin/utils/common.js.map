{"version":3,"file":"common.js","sources":["utils/common.js"],"sourcesContent":["// 格式化时间\nexport function formatTime(timestamp){\n  const now = new Date().getTime();\n  const diff = now - timestamp;\n  \n  if (diff < 60000) { // 1分钟内\n    return '刚刚';\n  } else if (diff < 3600000) { // 1小时内\n    return Math.floor(diff / 60000) + '分钟前';\n  } else if (diff < 86400000) { // 1天内\n    return Math.floor(diff / 3600000) + '小时前';\n  } else if (diff < 604800000) { // 1周内\n    return Math.floor(diff / 86400000) + '天前';\n  } else {\n    const date = new Date(timestamp);\n    return `${date.getMonth() + 1}-${date.getDate()} ${date.getHours()}:${date.getMinutes()}`;\n  }\n}\n\n// 格式化日期(yyyy-MM-dd)\nexport function formatDate(date, format = 'yyyy-MM-dd'){\n  // 确保date是Date对象\n  if (!(date instanceof Date)) {\n    try {\n      // 处理时间戳\n      if (typeof date === 'number' || (typeof date === 'string' && !isNaN(Number(date)))) {\n        // 将时间戳转换为数字并创建Date对象\n        const timestamp = Number(date);\n        date = new Date(timestamp);\n      } else {\n        // 处理日期字符串\n        date = new Date(date);\n      }\n      \n      // 检查是否为有效日期\n      if (isNaN(date.getTime())) {\n        console.error('无效的日期:', date);\n        return '无效日期';\n      }\n    } catch (error) {\n      console.error('日期转换错误:', error, '原始值:', date);\n      return '日期错误';\n    }\n  }\n  \n  const year = date.getFullYear();\n  const month = (date.getMonth() + 1).toString().padStart(2, '0');\n  const day = date.getDate().toString().padStart(2, '0');\n  const hours = date.getHours().toString().padStart(2, '0');\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n  const seconds = date.getSeconds().toString().padStart(2, '0');\n  \n  // 根据指定格式返回日期字符串\n  return format\n    .replace('yyyy', year)\n    .replace('MM', month)\n    .replace('dd', day)\n    .replace('hh', hours)\n    .replace('mm', minutes)\n    .replace('ss', seconds);\n}\n\n// 格式化时间(HH:mm)\nexport function formatOnlyTime(date){\n  const hours = date.getHours().toString().padStart(2, '0');\n  const minutes = date.getMinutes().toString().padStart(2, '0');\n  return `${hours}:${minutes}`;\n}\n\n/**\n * 获取图片URL（可选择是否添加时间戳防止缓存）\n * @param {string} url - 原始图片URL\n * @param {string} defaultUrl - 默认图片URL，当原始URL为空时使用\n * @param {boolean} addTimestamp - 是否添加时间戳防止缓存，默认为true\n * @returns {string} 处理后的图片URL\n */\nexport function getImageUrl(url, defaultUrl = '/static/images/default-poster.png', addTimestamp = true) {\n  if (!url) return defaultUrl;\n  \n  try {\n    // 移除可能已存在的时间戳参数\n    let cleanUrl = url;\n    if (url.includes('?t=') || url.includes('&t=')) {\n      cleanUrl = url.replace(/[?&]t=\\d+/g, '');\n    }\n    \n    // 根据参数决定是否添加时间戳\n    if (addTimestamp) {\n      // 添加新的时间戳参数\n      const timestamp = new Date().getTime();\n      return cleanUrl.includes('?') ? \n        `${cleanUrl}&t=${timestamp}` : \n        `${cleanUrl}?t=${timestamp}`;\n    } else {\n      // 不添加时间戳，直接返回干净的URL\n      return cleanUrl;\n    }\n  } catch (e) {\n    console.error('处理图片URL出错:', e);\n    return url || defaultUrl;\n  }\n}"],"names":["uni"],"mappings":";;AACO,SAAS,WAAW,WAAU;AACnC,QAAM,OAAM,oBAAI,KAAM,GAAC,QAAO;AAC9B,QAAM,OAAO,MAAM;AAEnB,MAAI,OAAO,KAAO;AAChB,WAAO;AAAA,EACX,WAAa,OAAO,MAAS;AACzB,WAAO,KAAK,MAAM,OAAO,GAAK,IAAI;AAAA,EACtC,WAAa,OAAO,OAAU;AAC1B,WAAO,KAAK,MAAM,OAAO,IAAO,IAAI;AAAA,EACxC,WAAa,OAAO,QAAW;AAC3B,WAAO,KAAK,MAAM,OAAO,KAAQ,IAAI;AAAA,EACzC,OAAS;AACL,UAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,WAAO,GAAG,KAAK,SAAQ,IAAK,CAAC,IAAI,KAAK,QAAO,CAAE,IAAI,KAAK,UAAU,IAAI,KAAK,WAAY,CAAA;AAAA,EACxF;AACH;AAGO,SAAS,WAAW,MAAM,SAAS,cAAa;AAErD,MAAI,EAAE,gBAAgB,OAAO;AAC3B,QAAI;AAEF,UAAI,OAAO,SAAS,YAAa,OAAO,SAAS,YAAY,CAAC,MAAM,OAAO,IAAI,CAAC,GAAI;AAElF,cAAM,YAAY,OAAO,IAAI;AAC7B,eAAO,IAAI,KAAK,SAAS;AAAA,MACjC,OAAa;AAEL,eAAO,IAAI,KAAK,IAAI;AAAA,MACrB;AAGD,UAAI,MAAM,KAAK,QAAO,CAAE,GAAG;AACzBA,sBAAc,MAAA,MAAA,SAAA,yBAAA,UAAU,IAAI;AAC5B,eAAO;AAAA,MACR;AAAA,IACF,SAAQ,OAAO;AACdA,kEAAc,WAAW,OAAO,QAAQ,IAAI;AAC5C,aAAO;AAAA,IACR;AAAA,EACF;AAED,QAAM,OAAO,KAAK;AAClB,QAAM,SAAS,KAAK,aAAa,GAAG,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC9D,QAAM,MAAM,KAAK,QAAS,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACrD,QAAM,QAAQ,KAAK,SAAU,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACxD,QAAM,UAAU,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC5D,QAAM,UAAU,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAG5D,SAAO,OACJ,QAAQ,QAAQ,IAAI,EACpB,QAAQ,MAAM,KAAK,EACnB,QAAQ,MAAM,GAAG,EACjB,QAAQ,MAAM,KAAK,EACnB,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,OAAO;AAC1B;AAgBO,SAAS,YAAY,KAAK,aAAa,qCAAqC,eAAe,MAAM;AACtG,MAAI,CAAC;AAAK,WAAO;AAEjB,MAAI;AAEF,QAAI,WAAW;AACf,QAAI,IAAI,SAAS,KAAK,KAAK,IAAI,SAAS,KAAK,GAAG;AAC9C,iBAAW,IAAI,QAAQ,cAAc,EAAE;AAAA,IACxC;AAGD,QAAI,cAAc;AAEhB,YAAM,aAAY,oBAAI,KAAM,GAAC,QAAO;AACpC,aAAO,SAAS,SAAS,GAAG,IAC1B,GAAG,QAAQ,MAAM,SAAS,KAC1B,GAAG,QAAQ,MAAM,SAAS;AAAA,IAClC,OAAW;AAEL,aAAO;AAAA,IACR;AAAA,EACF,SAAQ,GAAG;AACVA,kBAAA,MAAA,MAAA,SAAA,yBAAc,cAAc,CAAC;AAC7B,WAAO,OAAO;AAAA,EACf;AACH;;;;"}