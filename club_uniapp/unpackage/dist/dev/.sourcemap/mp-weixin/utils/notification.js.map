{"version":3,"file":"notification.js","sources":["utils/notification.js"],"sourcesContent":["/**\n * 全局消息通知工具\n * 提供统一的消息弹窗显示方法\n */\n\nlet notificationQueue = [] // 消息队列\nlet isShowing = false // 是否正在显示消息\n\n/**\n * 显示通知弹窗\n * @param {Object} options - 配置项\n * @param {String} options.type - 消息类型 activity_cancel/check_in/apply_approved/apply_rejected/activity_reminder\n * @param {String} options.title - 标题（可选，不传则使用默认标题）\n * @param {String} options.message - 消息内容\n * @param {String} options.extraInfo - 额外信息（可选）\n * @param {Function} options.onConfirm - 确认回调（可选）\n * @param {Function} options.onCancel - 取消回调（可选）\n */\nexport function showNotification(options = {}) {\n  console.log('【通知】showNotification 被调用，参数:', options)\n\n  const {\n    type = 'default',\n    title,\n    message,\n    extraInfo,\n    onConfirm,\n    onCancel\n  } = options\n\n  // 消息类型配置\n  const notificationConfig = {\n    activity_cancel: {\n      icon: 'info-filled',\n      color: '#ff6b6b',\n      defaultTitle: '活动取消通知',\n    },\n    check_in: {\n      icon: 'checkmarkempty',\n      color: '#51cf66',\n      defaultTitle: '签到成功',\n    },\n    apply_approved: {\n      icon: 'checkmarkempty',\n      color: '#51cf66',\n      defaultTitle: '报名审核通过',\n    },\n    apply_rejected: {\n      icon: 'closeempty',\n      color: '#ff6b6b',\n      defaultTitle: '报名审核未通过',\n    },\n    club_apply_approved: {\n      icon: 'checkmarkempty',\n      color: '#51cf66',\n      defaultTitle: '社团申请通过',\n    },\n    club_apply_rejected: {\n      icon: 'closeempty',\n      color: '#ff6b6b',\n      defaultTitle: '社团申请未通过',\n    },\n    activity_reminder: {\n      icon: 'calendar-filled',\n      color: '#ff9800',\n      defaultTitle: '活动提醒',\n    },\n    admin_notification: {\n      icon: 'notification-filled',\n      color: '#3b82f6',\n      defaultTitle: '管理员通知',\n    },\n    admin_message: {\n      icon: 'chat-filled',\n      color: '#3b82f6',\n      defaultTitle: '管理员消息',\n    },\n    system_broadcast: {\n      icon: 'sound-filled',\n      color: '#ff9800',\n      defaultTitle: '系统广播',\n    },\n    default: {\n      icon: 'notification-filled',\n      color: '#3b82f6',\n      defaultTitle: '系统通知',\n    }\n  }\n\n  const config = notificationConfig[type] || notificationConfig.default\n  const finalTitle = title || config.defaultTitle\n\n  // 构建消息内容\n  let content = message || ''\n  if (extraInfo) {\n    content += '\\n\\n' + extraInfo\n  }\n\n  console.log('【通知】准备显示消息，标题:', finalTitle, '内容:', content)\n\n  // 添加到队列\n  notificationQueue.push({\n    title: finalTitle,\n    content,\n    onConfirm,\n    onCancel\n  })\n\n  console.log('【通知】当前队列长度:', notificationQueue.length, '是否正在显示:', isShowing)\n\n  // 如果当前没有正在显示的消息，则显示\n  if (!isShowing) {\n    showNextNotification()\n  }\n}\n\n/**\n * 显示队列中的下一条消息\n */\nfunction showNextNotification() {\n  if (notificationQueue.length === 0) {\n    console.log('【通知】队列为空，停止显示')\n    isShowing = false\n    return\n  }\n\n  isShowing = true\n  const notification = notificationQueue.shift()\n\n  console.log('【通知】开始显示消息:', notification.title)\n\n  try {\n    uni.showModal({\n      title: notification.title,\n      content: notification.content,\n      showCancel: false,\n      confirmText: '知道了',\n      success: (res) => {\n        console.log('【通知】用户点击了确认按钮')\n        if (res.confirm && notification.onConfirm) {\n          notification.onConfirm()\n        }\n        // 显示下一条消息\n        setTimeout(() => {\n          showNextNotification()\n        }, 300)\n      },\n      fail: (err) => {\n        console.error('【通知】显示失败:', err)\n        // 失败也要继续显示下一条\n        setTimeout(() => {\n          showNextNotification()\n        }, 300)\n      }\n    })\n  } catch (error) {\n    console.error('【通知】showModal 异常:', error)\n    // 出现异常也要继续显示下一条\n    setTimeout(() => {\n      showNextNotification()\n    }, 300)\n  }\n}\n\n/**\n * 安装全局通知方法\n * 用于在Vue实例中注册\n */\nexport function install(app) {\n  console.log('【通知】正在安装通知插件...')\n\n  // Vue3\n  if (app.config && app.config.globalProperties) {\n    app.config.globalProperties.$showNotification = showNotification\n    console.log('【通知】已注册到 Vue3 globalProperties')\n  }\n  // Vue2\n  else if (app.prototype) {\n    app.prototype.$showNotification = showNotification\n    console.log('【通知】已注册到 Vue2 prototype')\n  }\n\n  // uni全局方法\n  if (typeof uni !== 'undefined') {\n    uni.$showNotification = showNotification\n    console.log('【通知】已注册到 uni 全局对象')\n  }\n}\n\nexport default {\n  install,\n  showNotification\n}\n"],"names":["uni"],"mappings":"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"}