{"version":3,"file":"websocket.js","sources":["utils/websocket.js"],"sourcesContent":["import { getToken } from './auth.js';\n\n// 单例实例\nlet instance = null;\n\n/**\n * 增强型WebSocket客户端\n */\nclass WebSocketClient {\n  constructor() {\n    if (instance) return instance;\n    instance = this;\n    \n    this.ws = null;\n    this.baseURL = null;\n    this.isConnected = false;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 10; // 增加最大重试次数\n    this.reconnectInterval = 3000;\n    this.reconnectTimer = null;\n    this.messageHandlers = new Map();\n    this.messageBuffer = [];\n    this.connectionStateListeners = new Set();\n    this.heartbeatTimer = null; // 心跳定时器\n    this.heartbeatInterval = 30000; // 30秒发送一次心跳\n    \n    // 监听网络变化\n    this.setupNetworkListener();\n  }\n\n  setupNetworkListener() {\n    uni.onNetworkStatusChange((res) => {\n      if (res.isConnected && !this.isConnected) {\n        console.log('网络恢复，尝试重新连接');\n        this.attemptReconnect();\n      }\n    });\n  }\n\n  notifyStateChange() {\n    this.connectionStateListeners.forEach(listener => {\n      listener(this.isConnected);\n    });\n  }\n\n  /**\n   * 添加连接状态监听器\n   * @param {function} listener - 状态变化回调函数\n   */\n  addStateListener(listener) {\n    this.connectionStateListeners.add(listener);\n  }\n\n  /**\n   * 移除连接状态监听器\n   * @param {function} listener - 要移除的回调函数\n   */\n  removeStateListener(listener) {\n    this.connectionStateListeners.delete(listener);\n  }\n\n  /**\n   * 连接WebSocket服务器\n   * @param {string} serverUrl - 服务器地址\n   * @param {boolean} forceReconnect - 是否强制重新连接（默认false）\n   * @returns {Promise} 连接成功或失败的Promise\n   */\n  connect(serverUrl, forceReconnect = false) {\n    return new Promise((resolve, reject) => {\n      // 如果已经连接且不强制重连，直接返回成功\n      if (this.isConnected && !forceReconnect) {\n        console.log('【WebSocket】已连接，复用现有连接');\n        resolve();\n        return;\n      }\n\n      // 如果强制重连或者有未完成的连接，先清除\n      if (this.ws && forceReconnect) {\n        console.log('【WebSocket】强制重连，断开现有连接');\n        this.disconnect();\n      }\n      \n      const token = getToken();\n      if (!token) {\n        reject(new Error('未登录，无法连接WebSocket服务'));\n        return;\n      }\n      \n      // 保存基础URL用于重连\n      this.baseUrl = serverUrl;\n      \n      // 构建完整URL\n      let fullUrl;\n      if (serverUrl.startsWith('ws://') || serverUrl.startsWith('wss://')) {\n        fullUrl = `${serverUrl}/ws/chat?token=${encodeURIComponent(token)}`;\n      } else if (serverUrl.startsWith('http://')) {\n        fullUrl = `ws://${serverUrl.substring(7)}/ws/chat?token=${encodeURIComponent(token)}`;\n      } else if (serverUrl.startsWith('https://')) {\n        fullUrl = `wss://${serverUrl.substring(8)}/ws/chat?token=${encodeURIComponent(token)}`;\n      } else {\n        fullUrl = `ws://${serverUrl}/ws/chat?token=${encodeURIComponent(token)}`;\n      }\n      \n      console.log('连接WebSocket:', fullUrl);\n      \n      try {\n        // 微信小程序需要特殊处理\n        const header = {}\n\n        // 添加 ngrok 跳过浏览器警告头（仅在非微信环境）\n        // #ifndef MP-WEIXIN\n        header['ngrok-skip-browser-warning'] = 'true'\n        // #endif\n\n        console.log('【WebSocket】创建连接，URL:', fullUrl)\n        console.log('【WebSocket】Headers:', header)\n\n        this.ws = uni.connectSocket({\n          url: fullUrl,\n          header: header,  // 添加自定义请求头\n          complete: () => {}\n        });\n\n        // 监听WebSocket事件\n        this.setupSocketHandlers(resolve, reject);\n        \n      } catch (error) {\n        console.error('创建WebSocket连接失败:', error);\n        reject(error);\n      }\n    });\n  }\n\n  setupSocketHandlers(resolve, reject) {\n    this.ws.onOpen(() => {\n      console.log('【WebSocket】连接已建立');\n      this.isConnected = true;\n      this.reconnectAttempts = 0;\n      this.notifyStateChange();\n\n      // 发送缓存的消息\n      this.flushMessageBuffer();\n      \n      // 启动心跳保活\n      this.startHeartbeat();\n\n      resolve();\n    });\n\n    this.ws.onError((error) => {\n      console.error('【WebSocket】连接错误:', error);\n      console.error('【WebSocket】错误代码:', error.errCode);\n      console.error('【WebSocket】错误信息:', error.errMsg);\n      console.error('【WebSocket】完整错误:', JSON.stringify(error));\n      this.handleConnectionLoss();\n      reject(error);\n    });\n\n    this.ws.onClose((event) => {\n      console.log('【WebSocket】连接已关闭');\n      console.log('【WebSocket】关闭代码:', event.code);\n      console.log('【WebSocket】关闭原因:', event.reason);\n      console.log('【WebSocket】完整事件:', JSON.stringify(event));\n      this.handleConnectionLoss();\n    });\n\n    this.ws.onMessage((res) => {\n      try {\n        console.log('【WebSocket】收到原始消息:', res.data);\n        const message = JSON.parse(res.data);\n        console.log('【WebSocket】解析后的消息:', message);\n        this.handleMessage(message);\n      } catch (error) {\n        console.error('【WebSocket】解析消息失败:', error, '原始数据:', res.data);\n      }\n    });\n  }\n\n  handleConnectionLoss() {\n    this.isConnected = false;\n    this.notifyStateChange();\n    \n    // 停止心跳\n    this.stopHeartbeat();\n    \n    // 检查token是否仍然有效\n    if (getToken()) {\n      this.attemptReconnect();\n    } else {\n      console.log('用户已登出，取消重连');\n    }\n  }\n\n  flushMessageBuffer() {\n    if (this.messageBuffer.length > 0) {\n      console.log(`发送${this.messageBuffer.length}条缓冲消息`);\n      \n      // 使用节流发送缓冲消息\n      const sendNext = () => {\n        if (this.messageBuffer.length === 0) return;\n        \n        const msg = this.messageBuffer.shift();\n        this.sendMessage(msg);\n        \n        // 添加延迟避免消息风暴\n        if (this.messageBuffer.length > 0) {\n          setTimeout(sendNext, 100);\n        }\n      };\n      \n      sendNext();\n    }\n  }\n\n  /**\n   * 断开WebSocket连接\n   */\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.isConnected = false;\n      this.notifyStateChange();\n      this.clearReconnectTimer();\n      this.stopHeartbeat();\n    }\n  }\n\n  clearReconnectTimer() {\n    if (this.reconnectTimer) {\n      clearTimeout(this.reconnectTimer);\n      this.reconnectTimer = null;\n    }\n  }\n\n  /**\n   * 尝试重新连接\n   */\n  attemptReconnect() {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.log('已达到最大重连次数，不再尝试重连');\n      return;\n    }\n\n    this.clearReconnectTimer();\n    \n    // 指数退避策略\n    const delay = Math.min(\n      this.reconnectInterval * Math.pow(2, this.reconnectAttempts),\n      30000 // 最大延迟30秒\n    );\n    \n    this.reconnectAttempts++;\n    \n    console.log(`${Math.round(delay/1000)}秒后尝试第${this.reconnectAttempts}次重连...`);\n    \n    this.reconnectTimer = setTimeout(() => {\n      console.log('尝试重新连接WebSocket...');\n      this.connect(this.baseUrl)\n        .catch(error => {\n          console.error('重新连接失败:', error);\n        });\n    }, delay);\n  }\n\n  /**\n   * 发送消息\n   * @param {object} message - 要发送的消息对象\n   */\n  sendMessage(message) {\n    // 限制缓冲区大小\n    if (this.messageBuffer.length > 50) {\n      console.warn('消息缓冲区已满，丢弃旧消息');\n      this.messageBuffer.shift();\n    }\n    \n    if (!this.isConnected) {\n      console.log('WebSocket未连接，消息将加入缓冲区');\n      this.messageBuffer.push(message);\n      return;\n    }\n\n    try {\n      const messageStr = JSON.stringify(message);\n      this.ws.send({\n        data: messageStr,\n        fail: (error) => {\n          console.error('发送消息失败:', error);\n          // 加入缓冲区等待重连\n          this.messageBuffer.push(message);\n          \n          // 如果连接已断开，尝试重连\n          if (!this.isConnected) {\n            this.attemptReconnect();\n          }\n        }\n      });\n    } catch (error) {\n      console.error('序列化消息失败:', error);\n    }\n  }\n\n  /**\n   * 处理接收到的消息\n   * @param {object} message - 收到的消息对象\n   */\n  handleMessage(message) {\n    if (!message || !message.type) {\n      console.warn('收到无效消息:', message);\n      return;\n    }\n\n    console.log('【WebSocket】处理消息，类型:', message.type);\n\n    // 根据消息类型调用对应的处理函数\n    const handler = this.messageHandlers.get(message.type);\n    if (handler) {\n      console.log('【WebSocket】找到消息处理器，准备执行');\n      try {\n        handler(message);\n      } catch (error) {\n        console.error(`处理消息类型 ${message.type} 时出错:`, error);\n      }\n    } else {\n      console.log('【WebSocket】未找到消息处理器，已注册的处理器:', Array.from(this.messageHandlers.keys()));\n      console.log('【WebSocket】未处理的消息类型:', message.type, message);\n    }\n  }\n\n  /**\n   * 注册消息处理函数\n   * @param {string} messageType - 消息类型\n   * @param {function} handler - 处理函数\n   */\n  onMessageType(messageType, handler) {\n    this.messageHandlers.set(messageType, handler);\n  }\n\n  /**\n   * 清除所有消息处理函数\n   */\n  clearHandlers() {\n    this.messageHandlers.clear();\n  }\n  \n  /**\n   * 启动心跳保活\n   */\n  startHeartbeat() {\n    this.stopHeartbeat(); // 先清除旧的\n    \n    this.heartbeatTimer = setInterval(() => {\n      if (this.isConnected && this.ws) {\n        try {\n          // 发送心跳 ping 消息\n          this.ws.send({\n            data: JSON.stringify({ type: 'ping' }),\n            fail: (error) => {\n              console.warn('【WebSocket】心跳发送失败:', error);\n            }\n          });\n        } catch (error) {\n          console.error('【WebSocket】心跳异常:', error);\n        }\n      }\n    }, this.heartbeatInterval);\n  }\n  \n  /**\n   * 停止心跳保活\n   */\n  stopHeartbeat() {\n    if (this.heartbeatTimer) {\n      clearInterval(this.heartbeatTimer);\n      this.heartbeatTimer = null;\n    }\n  }\n}\n\n// 导出单例\nconst wsClient = new WebSocketClient();\nexport default wsClient;"],"names":["uni","getToken"],"mappings":"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"}