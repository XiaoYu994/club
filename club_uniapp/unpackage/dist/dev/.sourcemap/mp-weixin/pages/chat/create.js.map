{"version":3,"file":"create.js","sources":["pages/chat/create.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdC9jcmVhdGUudnVl"],"sourcesContent":["<template>\n  <view class=\"create-chat-container pageBg\">\n    <!-- 顶部导航 -->\n    <!-- #ifndef MP-TOUTIAO -->\n    <custom-nav-bar title=\"创建群聊\" :showBack=\"true\"></custom-nav-bar>\n    <!-- #endif -->\n    \n    <!-- 创建表单 -->\n    <view class=\"form-container\">\n      <view class=\"form-item\">\n        <text class=\"label\">群组名称</text>\n        <input \n          class=\"input\"\n          v-model=\"formData.name\"\n          placeholder=\"请输入群组名称\"\n          maxlength=\"30\"\n        />\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">群组简介</text>\n        <textarea\n          class=\"textarea\"\n          v-model=\"formData.description\"\n          placeholder=\"请输入群组简介\"\n          maxlength=\"200\"\n        ></textarea>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">群组头像</text>\n        <view class=\"avatar-uploader\" @tap=\"chooseAvatar\">\n          <image \n            v-if=\"formData.avatar\" \n            :src=\"formData.avatar\" \n            class=\"avatar-preview\" \n            mode=\"aspectFill\"\n          ></image>\n          <view v-else class=\"upload-placeholder\">\n            <uni-icons type=\"camera\" size=\"24\" color=\"#999\"></uni-icons>\n            <text>上传头像</text>\n          </view>\n        </view>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">关联社团</text>\n        <view class=\"club-selector\" @tap=\"showClubSelector\">\n          <text v-if=\"selectedClub.name\">{{ selectedClub.name }}</text>\n          <text v-else class=\"placeholder\">请选择关联社团</text>\n          <uni-icons type=\"arrowright\" size=\"18\" color=\"#999\"></uni-icons>\n        </view>\n      </view>\n      \n      <view class=\"form-item\">\n        <text class=\"label\">群组类型</text>\n        <picker \n          @change=\"onTypeChange\" \n          :value=\"typeIndex\" \n          :range=\"groupTypes\"\n          range-key=\"name\"\n        >\n          <view class=\"picker\">\n            <text>{{ groupTypes[typeIndex].name }}</text>\n            <uni-icons type=\"arrowright\" size=\"18\" color=\"#999\"></uni-icons>\n          </view>\n        </picker>\n      </view>\n      \n      <view class=\"form-item\">\n        <view class=\"switch-item\">\n          <text>是否允许非社团成员加入</text>\n          <switch \n            :checked=\"formData.allowNonMembers\" \n            @change=\"onSwitchChange\" \n            color=\"#2979ff\"\n          />\n        </view>\n      </view>\n    </view>\n    \n    <!-- 提交按钮 -->\n    <view class=\"submit-btn\" @tap=\"submitForm\" :class=\"{ 'disabled': !isFormValid }\">\n      创建群组\n    </view>\n    \n    <!-- 社团选择弹窗 -->\n    <uni-popup ref=\"clubSelectorPopup\" type=\"bottom\">\n      <view class=\"club-popup\">\n        <view class=\"popup-header\">\n          <text>选择关联社团</text>\n          <uni-icons type=\"closeempty\" size=\"24\" color=\"#999\" @click=\"closeClubSelector\"></uni-icons>\n        </view>\n        <scroll-view class=\"club-list\" scroll-y>\n          <view \n            v-for=\"club in clubList\" \n            :key=\"club.id\" \n            class=\"club-item\" \n            @tap=\"selectClub(club)\"\n          >\n            <image :src=\"club.logo || '/static/img/club-default.png'\" class=\"club-logo\" mode=\"aspectFill\"></image>\n            <view class=\"club-info\">\n              <text class=\"club-name\">{{ club.name }}</text>\n              <text class=\"club-members\">{{ club.memberCount }}名成员</text>\n            </view>\n          </view>\n        </scroll-view>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, computed } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport { chatAPI } from '@/api/api.js';\nimport { clubAPI } from '@/api/api.js';\nimport { getToken } from '@/utils/auth.js';\n\n// 表单数据\nconst formData = reactive({\n  name: '',\n  description: '',\n  avatar: '',\n  clubId: null,\n  type: 0, // 0-公共群 1-部门群 2-管理员群\n  allowNonMembers: false\n});\n\n// 群组类型\nconst groupTypes = [\n  { id: 0, name: '公共群' },\n  { id: 1, name: '部门群' },\n  { id: 2, name: '管理员群' }\n];\nconst typeIndex = ref(0);\n\n// 关联社团\nconst selectedClub = reactive({\n  id: null,\n  name: ''\n});\nconst clubList = ref([]);\nconst clubSelectorPopup = ref(null);\n\n// 表单验证\nconst isFormValid = computed(() => {\n  return formData.name.trim() !== '' && selectedClub.id !== null;\n});\n\n// 初始化\nonLoad(async () => {\n  // 获取用户的社团列表\n  await loadUserClubs();\n});\n\n// 加载用户的社团\nconst loadUserClubs = async () => {\n  try {\n    const response = await clubAPI.getUserClubs();\n    if (response.code === 1) {\n      clubList.value = response.data || [];\n      \n      // 如果只有一个社团，自动选择\n      if (clubList.value.length === 1) {\n        selectClub(clubList.value[0]);\n      }\n    }\n  } catch (error) {\n    console.error('获取社团列表失败:', error);\n    uni.showToast({\n      title: '获取社团列表失败',\n      icon: 'none'\n    });\n  }\n};\n\n// 选择头像\nconst chooseAvatar = () => {\n  uni.chooseImage({\n    count: 1,\n    sizeType: ['compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      const tempFilePath = res.tempFilePaths[0];\n      \n      // 上传头像\n      uploadAvatar(tempFilePath);\n    }\n  });\n};\n\n// 上传头像\nconst uploadAvatar = (filePath) => {\n  uni.showLoading({\n    title: '上传中...'\n  });\n  \n  uni.uploadFile({\n    url: '/api/user/upload/image', // 图片上传API\n    filePath: filePath,\n    name: 'file',\n    header: {\n      'token': getToken()\n    },\n    success: (uploadRes) => {\n      try {\n        const data = JSON.parse(uploadRes.data);\n        if (data.code === 1 && data.data) {\n          formData.avatar = data.data.url;\n        } else {\n          uni.showToast({\n            title: data.msg || '上传失败',\n            icon: 'none'\n          });\n        }\n      } catch (e) {\n        uni.showToast({\n          title: '上传失败',\n          icon: 'none'\n        });\n      }\n    },\n    fail: () => {\n      uni.showToast({\n        title: '上传失败',\n        icon: 'none'\n      });\n    },\n    complete: () => {\n      uni.hideLoading();\n    }\n  });\n};\n\n// 显示社团选择器\nconst showClubSelector = () => {\n  clubSelectorPopup.value.open('bottom');\n};\n\n// 关闭社团选择器\nconst closeClubSelector = () => {\n  clubSelectorPopup.value.close();\n};\n\n// 选择社团\nconst selectClub = (club) => {\n  selectedClub.id = club.id;\n  selectedClub.name = club.name;\n  formData.clubId = club.id;\n  closeClubSelector();\n};\n\n// 群组类型选择\nconst onTypeChange = (e) => {\n  typeIndex.value = e.detail.value;\n  formData.type = groupTypes[typeIndex.value].id;\n};\n\n// 切换开关\nconst onSwitchChange = (e) => {\n  formData.allowNonMembers = e.detail.value;\n};\n\n// 提交表单\nconst submitForm = async () => {\n  if (!isFormValid.value) {\n    uni.showToast({\n      title: '请填写完整信息',\n      icon: 'none'\n    });\n    return;\n  }\n  \n  uni.showLoading({\n    title: '创建中...'\n  });\n  \n  try {\n    const response = await chatAPI.createChatGroup(formData);\n    if (response.code === 1) {\n      uni.showToast({\n        title: '群组创建成功',\n        icon: 'success'\n      });\n      \n      // 创建成功后跳转到聊天室\n      setTimeout(() => {\n        uni.redirectTo({\n          url: `/pages/chat/room?id=${response.data.id}&name=${encodeURIComponent(response.data.name)}`\n        });\n      }, 1500);\n    } else {\n      uni.showToast({\n        title: response.msg || '创建失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('创建群组失败:', error);\n    uni.showToast({\n      title: '创建群组失败',\n      icon: 'none'\n    });\n  } finally {\n    uni.hideLoading();\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.create-chat-container {\n  min-height: 100vh;\n  padding-bottom: 100rpx;\n  \n  .form-container {\n    background: #fff;\n    border-radius: 16rpx;\n    margin: 20rpx;\n    padding: 0 30rpx;\n    \n    .form-item {\n      padding: 30rpx 0;\n      border-bottom: 1px solid #f5f5f5;\n      \n      &:last-child {\n        border-bottom: none;\n      }\n      \n      .label {\n        display: block;\n        font-size: 28rpx;\n        color: #333;\n        margin-bottom: 16rpx;\n      }\n      \n      .input, .textarea {\n        width: 100%;\n        font-size: 28rpx;\n        color: #333;\n      }\n      \n      .textarea {\n        min-height: 160rpx;\n        line-height: 1.5;\n      }\n      \n      .avatar-uploader {\n        width: 160rpx;\n        height: 160rpx;\n        border: 1px dashed #ddd;\n        border-radius: 10rpx;\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        justify-content: center;\n        \n        .avatar-preview {\n          width: 160rpx;\n          height: 160rpx;\n          border-radius: 10rpx;\n        }\n        \n        .upload-placeholder {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          justify-content: center;\n          \n          text {\n            font-size: 24rpx;\n            color: #999;\n            margin-top: 10rpx;\n          }\n        }\n      }\n      \n      .club-selector, .picker {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        height: 80rpx;\n        padding: 0 20rpx;\n        background: #f9f9f9;\n        border-radius: 8rpx;\n        font-size: 28rpx;\n        color: #333;\n        \n        .placeholder {\n          color: #999;\n        }\n      }\n      \n      .switch-item {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        font-size: 28rpx;\n        color: #333;\n      }\n    }\n  }\n  \n  .submit-btn {\n    position: fixed;\n    bottom: 40rpx;\n    left: 40rpx;\n    right: 40rpx;\n    height: 90rpx;\n    line-height: 90rpx;\n    background: #2979ff;\n    color: #fff;\n    text-align: center;\n    border-radius: 45rpx;\n    font-size: 32rpx;\n    box-shadow: 0 4rpx 16rpx rgba(41, 121, 255, 0.3);\n    \n    &.disabled {\n      background: #ccc;\n      box-shadow: none;\n    }\n  }\n  \n  .club-popup {\n    background: #fff;\n    border-top-left-radius: 20rpx;\n    border-top-right-radius: 20rpx;\n    overflow: hidden;\n    \n    .popup-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 30rpx;\n      border-bottom: 1px solid #f5f5f5;\n      \n      text {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: #333;\n      }\n    }\n    \n    .club-list {\n      max-height: 700rpx;\n      \n      .club-item {\n        display: flex;\n        align-items: center;\n        padding: 30rpx;\n        border-bottom: 1px solid #f5f5f5;\n        \n        .club-logo {\n          width: 80rpx;\n          height: 80rpx;\n          border-radius: 8rpx;\n          margin-right: 20rpx;\n        }\n        \n        .club-info {\n          flex: 1;\n          \n          .club-name {\n            font-size: 28rpx;\n            color: #333;\n            margin-bottom: 8rpx;\n          }\n          \n          .club-members {\n            font-size: 24rpx;\n            color: #999;\n          }\n        }\n      }\n    }\n  }\n}\n</style> ","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/chat/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","computed","onLoad","clubAPI","uni","getToken","chatAPI"],"mappings":";;;;;;;;;;;;;;;;;;;AAwHA,UAAM,WAAWA,cAAAA,SAAS;AAAA,MACxB,MAAM;AAAA,MACN,aAAa;AAAA,MACb,QAAQ;AAAA,MACR,QAAQ;AAAA,MACR,MAAM;AAAA;AAAA,MACN,iBAAiB;AAAA,IACnB,CAAC;AAGD,UAAM,aAAa;AAAA,MACjB,EAAE,IAAI,GAAG,MAAM,MAAO;AAAA,MACtB,EAAE,IAAI,GAAG,MAAM,MAAO;AAAA,MACtB,EAAE,IAAI,GAAG,MAAM,OAAQ;AAAA,IACzB;AACA,UAAM,YAAYC,cAAAA,IAAI,CAAC;AAGvB,UAAM,eAAeD,cAAAA,SAAS;AAAA,MAC5B,IAAI;AAAA,MACJ,MAAM;AAAA,IACR,CAAC;AACD,UAAM,WAAWC,cAAAA,IAAI,CAAA,CAAE;AACvB,UAAM,oBAAoBA,cAAAA,IAAI,IAAI;AAGlC,UAAM,cAAcC,cAAQ,SAAC,MAAM;AACjC,aAAO,SAAS,KAAK,KAAI,MAAO,MAAM,aAAa,OAAO;AAAA,IAC5D,CAAC;AAGDC,kBAAAA,OAAO,YAAY;AAEjB,YAAM,cAAa;AAAA,IACrB,CAAC;AAGD,UAAM,gBAAgB,YAAY;AAChC,UAAI;AACF,cAAM,WAAW,MAAMC,gBAAQ;AAC/B,YAAI,SAAS,SAAS,GAAG;AACvB,mBAAS,QAAQ,SAAS,QAAQ,CAAA;AAGlC,cAAI,SAAS,MAAM,WAAW,GAAG;AAC/B,uBAAW,SAAS,MAAM,CAAC,CAAC;AAAA,UAC7B;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdC,sBAAA,MAAA,MAAA,SAAA,gCAAc,aAAa,KAAK;AAChCA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACF;AAAA,IACH;AAGA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QAC9B,SAAS,CAAC,QAAQ;AAChB,gBAAM,eAAe,IAAI,cAAc,CAAC;AAGxC,uBAAa,YAAY;AAAA,QAC1B;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,eAAe,CAAC,aAAa;AACjCA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACX,CAAG;AAEDA,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK;AAAA;AAAA,QACL;AAAA,QACA,MAAM;AAAA,QACN,QAAQ;AAAA,UACN,SAASC,WAAAA,SAAU;AAAA,QACpB;AAAA,QACD,SAAS,CAAC,cAAc;AACtB,cAAI;AACF,kBAAM,OAAO,KAAK,MAAM,UAAU,IAAI;AACtC,gBAAI,KAAK,SAAS,KAAK,KAAK,MAAM;AAChC,uBAAS,SAAS,KAAK,KAAK;AAAA,YACtC,OAAe;AACLD,4BAAAA,MAAI,UAAU;AAAA,gBACZ,OAAO,KAAK,OAAO;AAAA,gBACnB,MAAM;AAAA,cAClB,CAAW;AAAA,YACF;AAAA,UACF,SAAQ,GAAG;AACVA,0BAAAA,MAAI,UAAU;AAAA,cACZ,OAAO;AAAA,cACP,MAAM;AAAA,YAChB,CAAS;AAAA,UACF;AAAA,QACF;AAAA,QACD,MAAM,MAAM;AACVA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,QACD,UAAU,MAAM;AACdA,wBAAG,MAAC,YAAW;AAAA,QAChB;AAAA,MACL,CAAG;AAAA,IACH;AAGA,UAAM,mBAAmB,MAAM;AAC7B,wBAAkB,MAAM,KAAK,QAAQ;AAAA,IACvC;AAGA,UAAM,oBAAoB,MAAM;AAC9B,wBAAkB,MAAM;IAC1B;AAGA,UAAM,aAAa,CAAC,SAAS;AAC3B,mBAAa,KAAK,KAAK;AACvB,mBAAa,OAAO,KAAK;AACzB,eAAS,SAAS,KAAK;AACvB;IACF;AAGA,UAAM,eAAe,CAAC,MAAM;AAC1B,gBAAU,QAAQ,EAAE,OAAO;AAC3B,eAAS,OAAO,WAAW,UAAU,KAAK,EAAE;AAAA,IAC9C;AAGA,UAAM,iBAAiB,CAAC,MAAM;AAC5B,eAAS,kBAAkB,EAAE,OAAO;AAAA,IACtC;AAGA,UAAM,aAAa,YAAY;AAC7B,UAAI,CAAC,YAAY,OAAO;AACtBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AAEDA,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,MACX,CAAG;AAED,UAAI;AACF,cAAM,WAAW,MAAME,QAAAA,QAAQ,gBAAgB,QAAQ;AACvD,YAAI,SAAS,SAAS,GAAG;AACvBF,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO;AAAA,YACP,MAAM;AAAA,UACd,CAAO;AAGD,qBAAW,MAAM;AACfA,0BAAAA,MAAI,WAAW;AAAA,cACb,KAAK,uBAAuB,SAAS,KAAK,EAAE,SAAS,mBAAmB,SAAS,KAAK,IAAI,CAAC;AAAA,YACrG,CAAS;AAAA,UACF,GAAE,IAAI;AAAA,QACb,OAAW;AACLA,wBAAAA,MAAI,UAAU;AAAA,YACZ,OAAO,SAAS,OAAO;AAAA,YACvB,MAAM;AAAA,UACd,CAAO;AAAA,QACF;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAA,MAAA,MAAA,SAAA,gCAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AAAA,MACL,UAAY;AACRA,sBAAG,MAAC,YAAW;AAAA,MAChB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClTA,GAAG,WAAW,eAAe;"}