{"version":3,"file":"room.js","sources":["pages/chat/room.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2hhdC9yb29tLnZ1ZQ"],"sourcesContent":["\t<template>\n\t  <view class=\"chat-room-container pageBg\" :class=\"{'panel-open': showMorePanel}\">\n\t\t<!-- 顶部导航 -->\n\t\t<!-- #ifndef MP-TOUTIAO -->\n\t\t<custom-nav-bar :title=\"roomInfo.name || '聊天室'\" :showBack=\"true\"></custom-nav-bar>\n\t\t<!-- #endif -->\n\t\t\n\t\t<!-- 消息列表 -->\n\t\t<scroll-view \n\t\t  class=\"chat-list\" \n\t\t  scroll-y \n\t\t  @scrolltoupper=\"loadMoreMessages\" \n\t\t  upper-threshold=\"50\" \n\t\t  scroll-with-animation \n\t\t  show-scrollbar=\"false\" \n\t\t  :scroll-into-view=\"scrollIntoViewId\"\n\t\t>\n\t\t  <!-- 上拉加载提示区 -->\n\t\t  <view class=\"load-more\" v-if=\"loading\">\n\t\t    <view class=\"loading-icon\"></view>\n\t\t    <text>正在加载更多...</text>\n\t\t  </view>\n\t\t  <view class=\"load-more\" v-else-if=\"!hasMore\">\n\t\t    <text>没有更多消息了</text>\n\t\t  </view>\n\t\t  \n\t\t  <!-- 消息容器 -->\n\t\t  <view class=\"messages-container\">\n\t\t    <view v-for=\"(msg, idx) in messages\" :key=\"msg.id\" :id=\"'msg-'+msg.id\" class=\"message-item\">\n\t\t\t<!-- 时间分割线 -->\n\t\t\t<view class=\"time-divider\" v-if=\"shouldShowDivider(idx)\">\n\t\t\t  <text>{{ formatDividerTime(msg.createTime) }}</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- 消息行 -->\n\t\t\t<view :class=\"['message-row', msg.senderId === userId ? 'self' : 'other']\">\n\t\t\t  <!-- 他人消息 -->\n\t\t\t  <template v-if=\"msg.senderId !== userId\">\n\t\t\t\t<view class=\"avatar-container\">\n\t\t\t\t  <image class=\"avatar\" :src=\"msg.senderAvatar || '/static/images/avatar-default.png'\" mode=\"aspectFill\" />\n\t\t\t\t</view>\n\t\t\t\t<view class=\"message-content\">\n\t\t\t\t  <view class=\"sender-name\">{{ msg.senderName || '未知用户' }}</view>\n\t\t\t\t  <view class=\"bubble\">\n\t\t\t\t\t<template v-if=\"msg.contentType === 0\">\n\t\t\t\t\t  <text class=\"text\">{{ msg.content }}</text>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 1\">\n\t\t\t\t\t  <image class=\"image\" :src=\"msg.mediaUrl\" @tap=\"previewImage(msg.mediaUrl)\" mode=\"widthFix\" />\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 2\">\n\t\t\t\t\t  <view class=\"file-box\" @tap=\"openFile(msg.mediaUrl)\">\n\t\t\t\t\t\t<uni-icons type=\"download\" size=\"30\" color=\"#2979ff\" />\n\t\t\t\t\t\t<text class=\"file-name\">{{ extractFileName(msg.mediaUrl) }}</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 3\">\n\t\t\t\t\t  <view class=\"location-box\" @tap=\"openLocation(msg.content)\">\n\t\t\t\t\t\t<uni-icons type=\"location\" size=\"24\" color=\"#ff9800\" />\n\t\t\t\t\t\t<text class=\"location-name\">{{ msg.content ? parseLocation(msg.content).name : '位置信息' }}</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 4\">\n\t\t\t\t\t  <view class=\"custom-box\">\n\t\t\t\t\t\t<uni-icons type=\"info\" size=\"24\" color=\"#2979ff\" />\n\t\t\t\t\t\t<text class=\"custom-text\">自定义消息</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t  </view>\n\t\t\t\t  <view class=\"time\">{{ formatMessageTime(msg.createTime) }}</view>\n\t\t\t\t</view>\n\t\t\t  </template>\n\t\t\t  \n\t\t\t  <!-- 自己的消息 -->\n\t\t\t  <template v-else>\n\t\t\t\t<view class=\"message-content self\">\n\t\t\t\t  <view class=\"bubble\">\n\t\t\t\t\t<template v-if=\"msg.contentType === 0\">\n\t\t\t\t\t  <text class=\"text\">{{ msg.content }}</text>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 1\">\n\t\t\t\t\t  <image class=\"image\" :src=\"msg.mediaUrl\" @tap=\"previewImage(msg.mediaUrl)\" mode=\"widthFix\" />\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 2\">\n\t\t\t\t\t  <view class=\"file-box\" @tap=\"openFile(msg.mediaUrl)\">\n\t\t\t\t\t\t<uni-icons  type=\"download\" size=\"30\" color=\"#2979ff\" />\n\t\t\t\t\t\t<text class=\"file-name\">{{ extractFileName(msg.mediaUrl) }}</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 3\">\n\t\t\t\t\t  <view class=\"location-box\" @tap=\"openLocation(msg.content)\">\n\t\t\t\t\t\t<uni-icons type=\"location\" size=\"24\" color=\"#ff9800\" />\n\t\t\t\t\t\t<text class=\"location-name\">{{ msg.content ? parseLocation(msg.content).name : '位置信息' }}</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else-if=\"msg.contentType === 4\">\n\t\t\t\t\t  <view class=\"custom-box\">\n\t\t\t\t\t\t<uni-icons type=\"info\" size=\"24\" color=\"#2979ff\" />\n\t\t\t\t\t\t<text class=\"custom-text\">自定义消息</text>\n\t\t\t\t\t  </view>\n\t\t\t\t\t</template>\n\t\t\t\t  </view>\n\t\t\t\t  <view class=\"time\">{{ formatMessageTime(msg.createTime) }}</view>\n\t\t\t\t</view>\n\t\t\t\t<view class=\"avatar-container\">\n\t\t\t\t  <image class=\"avatar\" :src=\"userAvatar || '/static/images/avatar-default.png'\" mode=\"aspectFill\" />\n\t\t\t\t</view>\n\t\t\t  </template>\n\t\t\t</view>\n\t\t  </view>\n\t\t  </view>\n\t\t</scroll-view>\n\t\t\n\t\t<!-- 底部输入框 - 使用固定定位 -->\n\t\t<view class=\"input-area\" :class=\"{'with-panel': showMorePanel}\">\n\t\t  <!-- 扩展功能按钮 -->\n\t\t  <view class=\"more-btn\" @tap=\"toggleMorePanel\">\n\t\t\t<uni-icons type=\"plusempty\" size=\"28\" color=\"#666\"></uni-icons>\n\t\t  </view>\n\t\t  \n\t\t  <!-- 文本输入 -->\n\t\t  <view class=\"input-wrapper\">\n\t\t\t<textarea\n\t\t\t  class=\"message-input\"\n\t\t\t  v-model=\"messageText\"\n\t\t\t  auto-height\n\t\t\t  :maxlength=\"500\"\n\t\t\t  :cursor-spacing=\"20\"\n\t\t\t  :show-confirm-bar=\"false\"\n\t\t\t  @input=\"handleInput\"\n\t\t\t  @focus=\"inputFocus\"\n\t\t\t  @blur=\"inputBlur\"\n\t\t\t  placeholder=\"请输入消息...\"\n\t\t\t></textarea>\n\t\t  </view>\n\t\t  \n\t\t  <!-- 发送按钮 -->\n\t\t  <view class=\"send-btn\" @tap=\"sendMessage\" :class=\"{'active': messageText.trim()}\">\n\t\t\t<uni-icons type=\"paperplane-filled\" size=\"24\" color=\"#fff\"></uni-icons>\n\t\t  </view>\n\t\t</view>\n\t\t\n\t\t<!-- 扩展功能面板 -->\n\t\t<view class=\"more-panel\" v-if=\"showMorePanel\">\n\t\t  <view class=\"panel-item\" @tap=\"chooseImage\">\n\t\t\t<view class=\"panel-icon\">\n\t\t\t  <uni-icons type=\"image\" size=\"28\" color=\"#07c160\"></uni-icons>\n\t\t\t</view>\n\t\t\t<text>图片</text>\n\t\t  </view>\n\t\t  <view class=\"panel-item\" @tap=\"chooseLocation\">\n\t\t\t<view class=\"panel-icon\">\n\t\t\t  <uni-icons type=\"location\" size=\"28\" color=\"#ff9800\"></uni-icons>\n\t\t\t</view>\n\t\t\t<text>位置</text>\n\t\t  </view>\n\t\t  <view class=\"panel-item\" @tap=\"chooseFile\">\n\t\t\t<view class=\"panel-icon\">\n\t\t\t  <uni-icons type=\"folder-add\" size=\"28\" color=\"#2979ff\"></uni-icons>\n\t\t\t  \n\t\t\t</view>\n\t\t\t<text>文件</text>\n\t\t  </view>\n\t\t</view>\n\t  </view>\n\t</template>\n\n\t<script setup>\n\timport { ref, reactive, computed, onMounted, onBeforeUnmount, nextTick } from 'vue';\n\timport { onLoad, onUnload, onBackPress, onHide } from '@dcloudio/uni-app';\n\timport apiModule, { chatAPI } from '@/api/api.js';\n\timport wsClient from '@/utils/websocket.js';\n\timport { getToken, getUser, setUser } from '@/utils/auth.js';\n\timport request from '@/utils/request.js';\n\timport { formatTime, formatDate, formatOnlyTime } from '@/utils/common.js';\n\t\n\t// 防抖函数，避免频繁操作\n\tconst debounce = (fn, delay) => {\n\t  let timer = null;\n\t  return function(...args) {\n\t    if (timer) clearTimeout(timer);\n\t    timer = setTimeout(() => {\n\t      fn.apply(this, args);\n\t    }, delay);\n\t  };\n\t};\n\t\n\t// 页面栈计数器（用于判断是否完全退出聊天模块）\n\tlet chatPageCount = 0;\n\t\n\t// 获取路由参数\n\tconst groupId = ref(null);\n\tconst roomInfo = reactive({\n\t  name: '',\n\t  avatar: '',\n\t  memberCount: 0\n\t});\n\t\n\t// 用户信息\n\tconst userInfo = getUser();\n\tconsole.log('当前用户信息:', userInfo);\n\t\n\t// 用户ID\n\tconst userIdValue = ref(null);\n\tif (userInfo && userInfo.id) {\n\t  userIdValue.value = Number(userInfo.id);\n\t  console.log('转换后的用户ID:', userIdValue.value);\n\t}\n\t\n\tconst userId = computed(() => {\n\t  if (userIdValue.value !== null) {\n\t    return userIdValue.value;\n\t  }\n\t  const currentUser = getUser();\n\t  if (currentUser && currentUser.id) {\n\t    userIdValue.value = Number(currentUser.id);\n\t    console.log('重新获取用户ID:', userIdValue.value);\n\t    return userIdValue.value;\n\t  }\n\t  return null;\n\t});\n\tconst userAvatar = ref(userInfo && userInfo.avatar ? userInfo.avatar : '/static/images/avatar-default.png');\n\tconst userName = ref(userInfo && userInfo.name ? userInfo.name : '我');\n\t\n\t// 消息状态\n\tconst messages = ref([]);\n\tconst messageText = ref('');\n\tconst loading = ref(false);\n\tconst page = ref(1);\n\tconst pageSize = ref(10);\n\tconst hasMore = ref(true);\n\tconst showMorePanel = ref(false);\n\tconst scrollIntoViewId = ref('');\n\t\n\t// 初始化从后端获取用户信息\n\tasync function initUserInfo() {\n\t  if (!getUser()) {\n\t    try {\n\t      const res = await apiModule.user.getUserInfo();\n\t      if (res.code === 200 && res.data) {\n\t        setUser(res.data);\n\t        userAvatar.value = res.data.avatar || userAvatar.value;\n\t        userName.value = res.data.name || userName.value;\n\t        userIdValue.value = Number(res.data.id);\n\t        console.log('从后端拉取并更新用户信息:', res.data);\n\t      }\n\t    } catch (e) {\n\t      console.error('获取用户信息失败:', e);\n\t    }\n\t  }\n\t}\n\t\n\t/**\n\t * @description 更新消息处理函数（群组切换时调用）\n\t */\n\tfunction updateMessageHandler() {\n\t  // 注册聊天室消息处理器（不清除全局处理器，避免影响通知功能）\n\t  wsClient.onMessageType('group_message', handleReceivedMessage);\n\t  wsClient.onMessageType('error', handleError);\n\t  console.log('【聊天室】消息处理器已注册');\n\t}\n\t\n\t/**\n\t * @description 确保WebSocket连接，不会重复建立连接\n\t */\n\tconst connectWebSocket = async () => {\n\t  // 获取后端服务器地址，从api.js中引入baseURL\n\t  const serverUrl = apiModule.baseURL || 'localhost:8081';\n\n\t  if (wsClient.isConnected) {\n\t    console.log('【聊天室】WebSocket已连接，直接使用现有连接');\n\t    updateMessageHandler();\n\t    return;\n\t  }\n\n\t  console.log('【聊天室】WebSocket未连接，尝试连接...');\n\t  try {\n\t    // 传入 false 表示不强制重连，如果已连接则复用\n\t    await wsClient.connect(serverUrl, false);\n\t    console.log('【聊天室】WebSocket连接成功');\n\t    updateMessageHandler();\n\t  } catch (error) {\n\t    console.warn('【聊天室】WebSocket初次连接失败，正在重试...', error);\n\t    // 不主动提示用户，等待自动重连\n\t  }\n\t};\n\t\n\t/**\n\t * @description 加载群组详情信息\n\t */\n\tconst loadGroupDetail = async () => {\n\t  try {\n\t    const response = await chatAPI.getGroupDetail(groupId.value);\n\t    if (response.code === 200) {\n\t      Object.assign(roomInfo, response.data);\n\t    } else {\n\t      uni.showToast({\n\t        title: response.msg || '获取群组信息失败',\n\t        icon: 'none'\n\t      });\n\t    }\n\t  } catch (error) {\n\t    console.error('获取群组详情失败:', error);\n\t  }\n\t};\n\t\n\t/**\n\t * @description 格式化消息时间，用于显示时间分割线\n\t */\n\tfunction formatDividerTime(timestamp) {\n\t  if (!timestamp) return '';\n\t  \n\t  let dateObj;\n\t  // 处理时间戳\n\t  if (typeof timestamp === 'number') {\n\t    dateObj = new Date(timestamp);\n\t  } \n\t  // 处理ISO格式字符串\n\t  else if (typeof timestamp === 'string') {\n\t    if (timestamp.includes('T') || timestamp.includes('-')) {\n\t      dateObj = new Date(timestamp);\n\t    } else {\n\t      // 处理纯数字字符串\n\t      dateObj = new Date(parseInt(timestamp));\n\t    }\n\t  } \n\t  // 处理Date对象\n\t  else if (timestamp instanceof Date) {\n\t    dateObj = timestamp;\n\t  }\n\t  \n\t  // 检查日期是否有效\n\t  if (isNaN(dateObj.getTime())) {\n\t    console.error('无效的时间格式:', timestamp);\n\t    return '未知时间';\n\t  }\n\t  \n\t  const now = new Date();\n\t  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n\t  const yesterday = new Date(today);\n\t  yesterday.setDate(yesterday.getDate() - 1);\n\t  \n\t  const msgDate = new Date(dateObj.getFullYear(), dateObj.getMonth(), dateObj.getDate());\n\t  \n\t  // 今天的消息显示时间\n\t  if (msgDate.getTime() === today.getTime()) {\n\t    return `今天 ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;\n\t  }\n\t  // 昨天的消息\n\t  else if (msgDate.getTime() === yesterday.getTime()) {\n\t    return `昨天 ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;\n\t  }\n\t  // 今年的其他日期\n\t  else if (msgDate.getFullYear() === now.getFullYear()) {\n\t    return `${(dateObj.getMonth() + 1).toString().padStart(2, '0')}-${dateObj.getDate().toString().padStart(2, '0')} ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;\n\t  }\n\t  // 其他年份\n\t  else {\n\t    return `${dateObj.getFullYear()}-${(dateObj.getMonth() + 1).toString().padStart(2, '0')}-${dateObj.getDate().toString().padStart(2, '0')} ${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;\n\t  }\n\t}\n\t\n\t/**\n\t * @description 格式化消息时间，用于显示消息时间\n\t */\n\tfunction formatMessageTime(timestamp) {\n\t  if (!timestamp) return '';\n\t  \n\t  let dateObj;\n\t  // 处理时间戳\n\t  if (typeof timestamp === 'number') {\n\t    dateObj = new Date(timestamp);\n\t  } \n\t  // 处理ISO格式字符串\n\t  else if (typeof timestamp === 'string') {\n\t    if (timestamp.includes('T') || timestamp.includes('-')) {\n\t      dateObj = new Date(timestamp);\n\t    } else {\n\t      // 处理纯数字字符串\n\t      dateObj = new Date(parseInt(timestamp));\n\t    }\n\t  } \n\t  // 处理Date对象\n\t  else if (timestamp instanceof Date) {\n\t    dateObj = timestamp;\n\t  }\n\t  \n\t  // 检查日期是否有效\n\t  if (isNaN(dateObj.getTime())) {\n\t    console.error('无效的时间格式:', timestamp);\n\t    return '未知时间';\n\t  }\n\t  \n\t  return `${dateObj.getHours().toString().padStart(2, '0')}:${dateObj.getMinutes().toString().padStart(2, '0')}`;\n\t}\n\t\n\t/**\n\t * @description 判断是否需要显示时间分割线\n\t */\n\tconst shouldShowDivider = (index) => {\n\t  // 仅在非首条消息显示，并且格式化时间非空\n\t  if (index <= 0) return false;\n\t  const dividerTime = formatDividerTime(messages.value[index].createTime);\n\t  if (!dividerTime) return false;\n\t  // 比较当前消息和前一条消息时间差\n\t  const currentMsg = messages.value[index];\n\t  const prevMsg = messages.value[index - 1];\n\t  if (!currentMsg || !prevMsg || !currentMsg.createTime || !prevMsg.createTime) return false;\n\t  let currentTime, prevTime;\n\t  try {\n\t    currentTime = typeof currentMsg.createTime === 'number'\n\t      ? currentMsg.createTime\n\t      : new Date(currentMsg.createTime).getTime();\n\t    prevTime = typeof prevMsg.createTime === 'number'\n\t      ? prevMsg.createTime\n\t      : new Date(prevMsg.createTime).getTime();\n\t    return Math.abs(prevTime - currentTime) > 5 * 60 * 1000;\n\t  } catch (e) {\n\t    console.error('比较消息时间出错:', e);\n\t    return false;\n\t  }\n\t};\n\t\n\t/**\n\t * @description 加载初始消息\n\t */\n\tasync function loadInitialMessages() {\n\t  if (loading.value) return;\n\t  \n\t  loading.value = true;\n\t  try {\n\t    const response = await chatAPI.getGroupMessages(groupId.value, 1, pageSize.value);\n\t    if (response.code === 200) {\n\t            // 后端返回的数据是按时间降序排序的，需要反转为升序（最老的消息在前）\n\t      const pageMsgs = (response.data.list || []);\n\t      \n\t      // 预先处理消息数据\n\t      const processedMsgs = pageMsgs.map(msg => {\n\t        if (msg.createTime === undefined && msg.create_time) {\n\t          msg.createTime = msg.create_time;\n\t        }\n\t        msg.senderId = Number(msg.senderId);\n\t        if (userId.value) {\n\t          msg.isSelf = msg.senderId === userId.value;\n\t        } else {\n\t          msg.isSelf = false;\n\t        }\n\t        return msg;\n\t      });\n\t      \n      // 反转消息顺序，使最老的消息在前，最新的消息在后\n      messages.value = processedMsgs.reverse();\n\t      nextTick(() => {\n        // 滚动到最新的消息（数组末尾）\n        const lastMsg = messages.value[messages.value.length - 1];\n        if (lastMsg) {\n          scrollIntoViewId.value = 'msg-' + lastMsg.id;\n        }\n\t      });\n\t      page.value = 2;\n\t      hasMore.value = processedMsgs.length >= pageSize.value;\n\t    } else {\n\t      uni.showToast({ title: response.msg || '获取消息失败', icon: 'none' });\n\t    }\n\t  } catch (error) {\n\t    console.error('获取消息历史失败:', error);\n\t  } finally {\n\t    loading.value = false;\n\t  }\n\t}\n\t\n\t// 节流版本的loadMoreMessages，避免频繁触发\n\tconst loadMoreMessages = debounce(async () => {\n\t  if (loading.value || !hasMore.value) return;\n\t  \n\t  loading.value = true;\n\t  \n\t  try {\n\t    const response = await chatAPI.getGroupMessages(groupId.value, page.value, pageSize.value);\n\t    if (response.code === 200) {\n\t      const pageMsgs = (response.data.list || []);\n\t      // 预先处理消息数据，避免循环内多次处理\n\t      const processedMsgs = pageMsgs.map(msg => {\n\t        if (msg.createTime === undefined && msg.create_time) {\n\t          msg.createTime = msg.create_time;\n\t        }\n\t        msg.senderId = Number(msg.senderId);\n\t        if (userId.value) {\n\t          msg.isSelf = msg.senderId === userId.value;\n\t        } else {\n\t          msg.isSelf = false;\n\t        }\n\t        return msg;\n\t      });\n\t      \n\t      // 历史消息（更旧的）需要反转后添加到数组前面\n\t      if (processedMsgs.length > 0) {\n\t        // 反转历史消息顺序，然后添加到数组前面\n\t        const reversedMsgs = processedMsgs.reverse();\n\t        messages.value = [...reversedMsgs, ...messages.value];\n\t      }\n\t      page.value++;\n\t      hasMore.value = processedMsgs.length >= pageSize.value;\n\t    } else {\n\t      uni.showToast({ title: response.msg || '获取消息失败', icon: 'none' });\n\t    }\n\t  } catch (error) {\n\t    console.error('获取消息历史失败:', error);\n\t  } finally {\n\t    loading.value = false;\n\t  }\n\t}, 300);\n\t\n\t/**\n\t * @description 处理接收到的WebSocket消息\n\t */\n\tconst handleReceivedMessage = (message) => {\n\t  if (message.groupId === groupId.value) {\n\t    message.senderId = Number(message.senderId);\n\t    \n\t    console.log('收到WebSocket消息:', message);\n\t    \n\t    if (message.contentType === 3) {\n\t      try {\n\t        if (typeof message.content === 'string') {\n\t          const locationData = JSON.parse(message.content);\n\t          if (!locationData.name) {\n\t            locationData.name = locationData.address || '位置信息';\n\t          }\n\t          message.content = JSON.stringify(locationData);\n\t        }\n\t      } catch (e) {\n\t        console.error('解析位置消息失败:', e);\n\t      }\n\t    }\n\t    \n\t    if (userId.value && message.senderId === userId.value) {\n\t      if (message.localMsgId) {\n\t        const localMsgIndex = messages.value.findIndex(msg => \n\t          msg.isLocalMessage && msg.id === message.localMsgId);\n\t          \n\t        if (localMsgIndex !== -1) {\n\t          messages.value.splice(localMsgIndex, 1, message);\n\t          return;\n\t        }\n\t      }\n\t    }\n\t    \n\t    // 新消息添加到数组末尾（保持时间顺序）\n\t    messages.value.push(message);\n\t    nextTick(() => {\n\t      scrollIntoViewId.value = 'msg-' + message.id;\n\t    });\n\t    \n\t  }\n\t};\n\t\n\t/**\n\t * @description 处理WebSocket错误消息\n\t */\n\tconst handleError = (message) => {\n\t  uni.showToast({\n\t    title: message.content || '发生错误',\n\t    icon: 'none'\n\t  });\n\t};\n\t\n\t/**\n\t * @description 发送消息\n\t */\n\tconst sendMessage = () => {\n\t  const content = messageText.value.trim();\n\t  if (!content) return;\n\t\n\t  if (!userId.value) {\n\t    const currentUser = getUser();\n\t    if (currentUser && currentUser.id) {\n\t      userIdValue.value = Number(currentUser.id);\n\t    } else {\n\t      uni.showToast({ title: '用户信息获取失败', icon: 'none' });\n\t      return;\n\t    }\n\t  }\n\t\n\t  const timestamp = Date.now();\n\t  const avatar = userAvatar.value || '/static/images/avatar-default.png';\n\t  const localMsg = {\n\t    id: `local-${timestamp}`,\n\t    groupId: groupId.value,\n\t    senderId: userId.value,\n\t    senderName: userName.value,\n\t    senderAvatar: avatar,\n\t    createTime: timestamp,\n\t    content: content,\n\t    contentType: 0,\n\t    isLocalMessage: true\n\t  };\n\t  \n\t  // 添加到消息列表末尾（保持时间顺序）\n\t  messages.value.push(localMsg);\n\t  nextTick(() => {\n\t    scrollIntoViewId.value = 'msg-' + localMsg.id;\n\t  });\n\t\n\t  if (!wsClient.isConnected) {\n\t    uni.showToast({ title: '聊天服务未连接', icon: 'none' });\n\t    return;\n\t  }\n\t\n\t  const message = {\n\t    type: 'group_message',\n\t    groupId: groupId.value,\n\t    content: content,\n\t    contentType: 0,\n\t    localMsgId: localMsg.id\n\t  };\n\t\n\t  wsClient.sendMessage(message);\n\t\n\t  messageText.value = '';\n\t  showMorePanel.value = false;\n\t};\n\t\n\t// 输入处理\n\tconst handleInput = (e) => {\n\t  messageText.value = e.detail.value;\n\t};\n\t\n\tconst inputFocus = () => {\n\t  showMorePanel.value = false;\n\t};\n\t\n\tconst inputBlur = () => {\n\t  // 可以在这里处理失去焦点的逻辑\n\t};\n\t\n\t// 切换更多面板\n\tconst toggleMorePanel = () => {\n\t  showMorePanel.value = !showMorePanel.value;\n\t};\n\t\n\t/**\n\t * 提取文件名\n\t */\n\tconst extractFileName = (url) => {\n\t  if (!url) return '未知文件';\n\t  const parts = url.split('/');\n\t  return parts[parts.length - 1];\n\t};\n\t\n\t/**\n\t * 解析位置信息\n\t */\n\tconst parseLocation = (content) => {\n\t  try {\n\t    if (typeof content === 'string') {\n\t      return JSON.parse(content);\n\t    }\n\t    return content;\n\t  } catch (e) {\n\t    console.error('解析位置信息失败:', e);\n\t    return { name: '位置信息', address: '' };\n\t  }\n\t};\n\t\n\t/**\n\t * 预览图片\n\t */\n\tconst previewImage = (url) => {\n\t  if (!url) return;\n\t  uni.previewImage({\n\t    urls: [url],\n\t    current: url\n\t  });\n\t};\n\t\n\t/**\n\t * 打开文件\n\t */\n\tconst openFile = (url) => {\n\t  if (!url) {\n\t    uni.showToast({ title: '文件链接无效', icon: 'none' });\n\t    return;\n\t  }\n\t  \n\t  uni.showLoading({\n\t    title: '正在加载文件...',\n\t    mask: true\n\t  });\n\t  \n\t  // #ifdef H5\n\t  // H5平台可以直接在新窗口打开文件链接\n\t  window.open(url, '_blank');\n\t  uni.hideLoading();\n\t  // #endif\n\t  \n\t  // #ifdef APP-PLUS || MP-WEIXIN\n\t  uni.downloadFile({\n\t    url: url,\n\t    success: (res) => {\n\t      uni.hideLoading();\n\t      if (res.statusCode === 200) {\n\t        // #ifdef APP-PLUS\n\t        uni.openDocument({\n\t          filePath: res.tempFilePath,\n\t          success: function() {\n\t            console.log('打开文件成功');\n\t          },\n\t          fail: function(err) {\n\t            console.error('打开文件失败:', err);\n\t            uni.showToast({ title: '无法打开此类型文件', icon: 'none' });\n\t          }\n\t        });\n\t        // #endif\n\t        \n\t        // #ifdef MP-WEIXIN\n\t        // 微信小程序环境\n\t        wx.openDocument({\n\t          filePath: res.tempFilePath,\n\t          showMenu: true, // 显示右上角菜单，可以转发、收藏等操作\n\t          fileType: getFileType(url), // 尝试获取文件类型\n\t          success: function() {\n\t            console.log('打开文件成功');\n\t          },\n\t          fail: function(err) {\n\t            console.error('微信小程序打开文件失败:', err);\n\t            // 如果打开失败，提示用户复制链接\n\t            uni.showModal({\n\t              title: '打开失败',\n\t              content: '无法打开此类型文件，是否复制链接后手动打开？',\n\t              confirmText: '复制链接',\n\t              success: (res) => {\n\t                if (res.confirm) {\n\t                  uni.setClipboardData({\n\t                    data: url,\n\t                    success: () => {\n\t                      uni.showToast({ title: '链接已复制', icon: 'success' });\n\t                    }\n\t                  });\n\t                }\n\t              }\n\t            });\n\t          }\n\t        });\n\t        // #endif\n\t      } else {\n\t        uni.showToast({ title: '下载文件失败', icon: 'none' });\n\t      }\n\t    },\n\t    fail: (err) => {\n\t      uni.hideLoading();\n\t      console.error('下载文件失败:', err);\n\t      uni.showToast({ title: '下载文件失败', icon: 'none' });\n\t    }\n\t  });\n\t  // #endif\n\t  \n\t  // #ifdef MP-ALIPAY || MP-BAIDU || MP-TOUTIAO || MP-QQ\n\t  // 其他小程序平台，提供复制链接选项\n\t  uni.hideLoading();\n\t  uni.showModal({\n\t    title: '查看文件',\n\t    content: '当前平台不支持直接查看文件，是否复制链接？',\n\t    confirmText: '复制链接',\n\t    success: (res) => {\n\t      if (res.confirm) {\n\t        uni.setClipboardData({\n\t          data: url,\n\t          success: () => {\n\t            uni.showToast({ title: '链接已复制', icon: 'success' });\n\t          }\n\t        });\n\t      }\n\t    }\n\t  });\n\t  // #endif\n\t};\n\n\t/**\n\t * 根据URL获取文件类型\n\t */\n\tconst getFileType = (url) => {\n\t  if (!url) return '';\n\t  \n\t  const extension = url.split('.').pop().toLowerCase();\n\t  \n\t  // 映射常见文件扩展名到微信文档类型\n\t  const typeMap = {\n\t    'doc': 'doc',\n\t    'docx': 'doc',\n\t    'xls': 'xls',\n\t    'xlsx': 'xls',\n\t    'ppt': 'ppt',\n\t    'pptx': 'ppt',\n\t    'pdf': 'pdf',\n\t    'txt': 'txt'\n\t  };\n\t  \n\t  return typeMap[extension] || '';\n\t};\n\t\n\t/**\n\t * 打开位置\n\t */\n\tconst openLocation = (content) => {\n\t  try {\n\t    const locationData = typeof content === 'string' ? JSON.parse(content) : content;\n\t    uni.openLocation({\n\t      latitude: Number(locationData.latitude),\n\t      longitude: Number(locationData.longitude),\n\t      name: locationData.name || '位置信息',\n\t      address: locationData.address || '',\n\t      success: () => {\n\t        console.log('打开位置成功');\n\t      },\n\t      fail: (err) => {\n\t        console.error('打开位置失败:', err);\n\t        uni.showToast({ title: '打开位置失败', icon: 'none' });\n\t      }\n\t    });\n\t  } catch (e) {\n\t    console.error('解析位置信息失败:', e);\n\t    uni.showToast({ title: '位置信息无效', icon: 'none' });\n\t  }\n\t};\n\t\n\t/**\n\t * 选择图片并发送\n\t */\n\tconst chooseImage = () => {\n\t  uni.chooseImage({\n\t    count: 1,\n\t    sizeType: ['compressed'],\n\t    sourceType: ['album', 'camera'],\n\t    success: async (res) => {\n\t      const tempFilePath = res.tempFilePaths[0];\n\t      \n\t      // 检查WebSocket连接状态\n\t      if (!wsClient.isConnected) {\n\t        // 尝试重新连接\n\t        try {\n\t          uni.showLoading({ title: '正在连接聊天服务...' });\n\t          // 使用api.js中的baseURL，传入false避免断开现有连接\n\t          await wsClient.connect(apiModule.baseURL || 'localhost:8081', false);\n\t          uni.hideLoading();\n\t        } catch (error) {\n\t          uni.hideLoading();\n\t          uni.showToast({\n\t            title: '聊天服务连接失败，请稍后重试',\n\t            icon: 'none'\n\t          });\n\t          console.error('聊天服务连接失败:', error);\n\t          return;\n\t        }\n\t      }\n\t      \n\t      try {\n\t        // 显示上传中提示\n\t        uni.showLoading({\n\t          title: '正在上传图片...',\n\t          mask: true\n\t        });\n\t        \n\t        // 上传文件\n\t        const uploadRes = await apiModule.common.upload(tempFilePath);\n\t        uni.hideLoading();\n\t        \n\t        if (uploadRes.code === 200 && uploadRes.data && uploadRes.data.url) {\n\t          const mediaUrl = uploadRes.data.url;\n\t          \n\t          // 创建本地消息\n\t          const timestamp = Date.now();\n\t          const localMsg = {\n\t            id: `local-${timestamp}`,\n\t            groupId: groupId.value,\n\t            senderId: userId.value,\n\t            senderName: userName.value,\n\t            senderAvatar: userAvatar.value || '/static/images/avatar-default.png',\n\t            createTime: timestamp,\n\t            content: '[图片]',\n\t            contentType: 1, // 图片类型\n\t            mediaUrl: mediaUrl,\n\t            isLocalMessage: true\n\t          };\n\t          \n\t          // 添加到消息列表末尾\n\t          messages.value.push(localMsg);\n\t          nextTick(() => {\n\t            scrollIntoViewId.value = 'msg-' + localMsg.id;\n\t          });\n\t          \n\t          // 发送消息到WebSocket\n\t          if (wsClient.isConnected) {\n\t            const message = {\n\t              type: 'group_message',\n\t              groupId: groupId.value,\n\t              content: '[图片]',\n\t              contentType: 1, // 图片类型\n\t              mediaUrl: mediaUrl,\n\t              localMsgId: localMsg.id\n\t            };\n\t            wsClient.sendMessage(message);\n\t          } else {\n\t            uni.showToast({ title: '聊天服务未连接，消息将在重连后发送', icon: 'none' });\n\t          }\n\t        } else {\n\t          uni.showToast({ \n\t            title: uploadRes.message || '上传失败', \n\t            icon: 'none' \n\t          });\n\t          console.error('图片上传响应异常:', uploadRes);\n\t        }\n\t      } catch (error) {\n\t        uni.hideLoading();\n\t        console.error('上传图片失败', error);\n\t        uni.showToast({ \n\t          title: '图片上传失败，请重试', \n\t          icon: 'none' \n\t        });\n\t      }\n\t    }\n\t  });\n\t  \n\t  showMorePanel.value = false;\n\t};\n\t\n\t/**\n\t * 选择位置并发送\n\t */\n\tconst chooseLocation = () => {\n\t  uni.chooseLocation({\n\t    success: (res) => {\n\t      if (!res.name || !res.address || !res.latitude || !res.longitude) {\n\t        uni.showToast({ title: '未选择有效位置', icon: 'none' });\n\t        return;\n\t      }\n\t      \n\t      // 位置数据格式化\n\t      const locationData = {\n\t        name: res.name,\n\t        address: res.address,\n\t        latitude: res.latitude,\n\t        longitude: res.longitude\n\t      };\n\t      \n\t      // 创建本地消息\n\t      const timestamp = Date.now();\n\t      const localMsg = {\n\t        id: `local-${timestamp}`,\n\t        groupId: groupId.value,\n\t        senderId: userId.value,\n\t        senderName: userName.value,\n\t        senderAvatar: userAvatar.value || '/static/images/avatar-default.png',\n\t        createTime: timestamp,\n\t        content: JSON.stringify(locationData),\n\t        contentType: 3, // 位置类型\n\t        isLocalMessage: true\n\t      };\n\t      \n\t      // 添加到消息列表末尾（保持时间顺序）\n\t      messages.value.push(localMsg);\n\t      nextTick(() => {\n\t        scrollIntoViewId.value = 'msg-' + localMsg.id;\n\t      });\n\t      \n\t      // 发送消息到WebSocket\n\t      if (wsClient.isConnected) {\n\t        const message = {\n\t          type: 'group_message',\n\t          groupId: groupId.value,\n\t          content: JSON.stringify(locationData),\n\t          contentType: 3, // 位置类型\n\t          localMsgId: localMsg.id\n\t        };\n\t        wsClient.sendMessage(message);\n\t      } else {\n\t        uni.showToast({ title: '聊天服务未连接', icon: 'none' });\n\t      }\n\t    },\n\t    fail: (err) => {\n\t      console.error('选择位置失败:', err);\n\t    }\n\t  });\n\t  \n\t  showMorePanel.value = false;\n\t};\n\t\n\t/**\n\t * 选择文件并发送\n\t */\n\tconst chooseFile = () => {\n\t  // 由于H5和小程序平台API不同，需要做兼容处理\n\t  // #ifdef APP-PLUS || H5\n\t  uni.chooseFile({\n\t    count: 1,\n\t    extension: ['.doc', '.docx', '.pdf', '.xls', '.xlsx', '.ppt', '.pptx', '.txt'],\n\t    success: async (res) => {\n\t      handleFileUpload(res.tempFiles[0].path);\n\t    }\n\t  });\n\t  // #endif\n\t  \n\t  // #ifdef MP-WEIXIN\n\t  wx.chooseMessageFile({\n\t    count: 1,\n\t    type: 'file',\n\t    extension: ['doc', 'docx', 'pdf', 'xls', 'xlsx', 'ppt', 'pptx', 'txt'],\n\t    success: async (res) => {\n\t      if (res.tempFiles && res.tempFiles.length > 0) {\n\t        const file = res.tempFiles[0];\n\t        console.log('选择的文件:', file);\n\t        handleFileUpload(file.path, file.name);\n\t      }\n\t    },\n\t    fail: (err) => {\n\t      console.error('选择文件失败:', err);\n\t  uni.showToast({\n\t        title: '选择文件失败',\n\t        icon: 'none'\n\t      });\n\t    }\n\t  });\n\t  // #endif\n\t  \n\t  // #ifdef MP-ALIPAY || MP-BAIDU || MP-TOUTIAO || MP-QQ\n\t  uni.showToast({\n\t    title: '当前平台暂不支持文件发送',\n\t    icon: 'none'\n\t  });\n\t  // #endif\n\t  \n\t  showMorePanel.value = false;\n\t};\n\t\n\t/**\n\t * 处理文件上传和发送\n\t */\n\tconst handleFileUpload = async (filePath, fileName = '') => {\n\t  try {\n\t    // 检查WebSocket连接状态\n\t    if (!wsClient.isConnected) {\n\t      // 尝试重新连接\n\t      try {\n\t        uni.showLoading({ title: '正在连接聊天服务...' });\n\t        // 使用api.js中的baseURL，传入false避免断开现有连接\n\t        await wsClient.connect(apiModule.baseURL || 'localhost:8081', false);\n\t        uni.hideLoading();\n\t      } catch (error) {\n\t        uni.hideLoading();\n\t        uni.showToast({\n\t          title: '聊天服务连接失败，请稍后重试',\n\t          icon: 'none'\n\t        });\n\t        console.error('聊天服务连接失败:', error);\n\t        return;\n\t      }\n\t    }\n\t    \n\t    // 显示上传中提示\n\t    uni.showLoading({\n\t      title: '正在上传文件...',\n\t      mask: true\n\t    });\n\t    \n\t    // 上传文件\n\t    const uploadRes = await apiModule.common.upload(filePath);\n\t    uni.hideLoading();\n\t    \n\t    if (uploadRes.code === 200 && uploadRes.data && uploadRes.data.url) {\n\t      const mediaUrl = uploadRes.data.url;\n\t      const displayFileName = fileName || uploadRes.data.newFileName || extractFileName(filePath);\n\t      \n\t      // 创建本地消息\n\t      const timestamp = Date.now();\n\t      const localMsg = {\n\t        id: `local-${timestamp}`,\n\t        groupId: groupId.value,\n\t        senderId: userId.value,\n\t        senderName: userName.value,\n\t        senderAvatar: userAvatar.value || '/static/images/avatar-default.png',\n\t        createTime: timestamp,\n\t        content: displayFileName, // 将文件名作为消息内容，方便显示\n\t        contentType: 2, // 文件类型\n\t        mediaUrl: mediaUrl,\n\t        isLocalMessage: true\n\t      };\n\t      \n\t            // 添加到消息列表末尾（保持时间顺序）\n      messages.value.push(localMsg);\n\t      nextTick(() => {\n\t        scrollIntoViewId.value = 'msg-' + localMsg.id;\n\t      });\n\t      \n\t      // 发送消息到WebSocket\n\t      if (wsClient.isConnected) {\n\t        const message = {\n\t          type: 'group_message',\n\t          groupId: groupId.value,\n\t          content: displayFileName, // 将文件名作为消息内容\n\t          contentType: 2, // 文件类型\n\t          mediaUrl: mediaUrl,\n\t          localMsgId: localMsg.id\n\t        };\n\t        wsClient.sendMessage(message);\n\t      } else {\n\t        uni.showToast({ title: '聊天服务未连接，消息将在重连后发送', icon: 'none' });\n\t      }\n\t    } else {\n\t      uni.showToast({ \n\t        title: uploadRes.message || '上传失败', \n\t        icon: 'none' \n\t      });\n\t      console.error('文件上传响应异常:', uploadRes);\n\t    }\n\t  } catch (error) {\n\t    uni.hideLoading();\n\t    console.error('上传文件失败', error);\n\t    uni.showToast({ \n\t      title: '文件上传失败，请重试', \n\t      icon: 'none' \n\t    });\n\t  }\n\t};\n\t\n\t// 页面加载\n\tonLoad(async (option) => {\n\t  chatPageCount++; // 页面栈增加\n\t  await initUserInfo();\n\t  \n\t  if (option.id) {\n\t    groupId.value = parseInt(option.id);\n\t    if (option.name) {\n\t      roomInfo.name = decodeURIComponent(option.name);\n\t    }\n\t    \n\t    console.log(`进入聊天室，群组ID: ${groupId.value}, 名称: ${roomInfo.name}`);\n\t    \n\t    // 连接WebSocket（如果未连接）并更新消息处理器\n\t    connectWebSocket();\n\t    \n\t    await loadGroupDetail();\n\t    await loadInitialMessages();\n\t  }\n\t});\n\t\n\t// 页面卸载\n\tonUnload(() => {\n\t  chatPageCount--;\n\t  if (chatPageCount === 0) {\n\t    // 当所有聊天页面都关闭时，才断开WebSocket\n\t    if (wsClient.isConnected) {\n\t      wsClient.disconnect();\n\t      console.log('所有聊天页面已关闭，断开WebSocket连接');\n\t    }\n\t  }\n\t});\n\t\n\t// 页面隐藏（保持连接）\n\tonHide(() => {\n\t  console.log('页面隐藏，保持WebSocket连接');\n\t});\n\t</script>\n\t\n\t<style lang=\"scss\" scoped>\n\t.chat-room-container {\n\t  display: flex;\n\t  flex-direction: column;\n\t  height: 100vh;\n\t  position: relative;\n\t  box-sizing: border-box;\n\t  padding-bottom: 120rpx; /* 为底部输入区域留出空间 */\n\t}\n\n\t/* 面板展开时，为消息列表额外预留空间（输入区+面板高度） */\n\t.chat-room-container.panel-open {\n    padding-bottom: 420rpx; /* 120rpx 输入区 + 300rpx 面板 */\n\t}\n\n\t.chat-list {\n\t  flex: 1;\n\t  padding: 20rpx;\n\t  box-sizing: border-box;\n\t  background-color: #F6F6F6;\n\t  height: calc(100vh - 120rpx - var(--status-bar-height) - 44px);\n\t  /* 优化滚动性能 */\n\t  -webkit-overflow-scrolling: touch;\n  /* 确保滚动视图从顶部开始 */\n  display: flex;\n  flex-direction: column;\n\t  \n\t  .load-more {\n\t    padding: 20rpx 0;\n\t    text-align: center;\n\t    \n\t    text {\n\t      font-size: 24rpx;\n\t      color: #999;\n\t    }\n\t    \n\t    .loading-icon {\n\t      display: inline-block;\n\t      width: 30rpx;\n\t      height: 30rpx;\n\t      border: 2rpx solid #999;\n\t      border-radius: 50%;\n\t      border-top-color: transparent;\n\t      animation: loading 0.8s linear infinite;\n\t      margin-right: 10rpx;\n\t      vertical-align: middle;\n\t    }\n\t    \n\t    @keyframes loading {\n\t      from { transform: rotate(0deg); }\n\t      to { transform: rotate(360deg); }\n\t    }\n\t  }\n\t  \n\t  .messages-container {\n    /* 使用flex布局，消息从上到下正常排列 */\n\t    display: flex;\n    flex-direction: column;\n    /* 让容器根据内容自适应高度，不强制占满 */\n    flex: 1;\n    justify-content: flex-start;\n\t    \n\t    .message-item {\n\t      /* 每个消息项 */\n\t      width: 100%;\n\t      margin-bottom: 10rpx;\n\t    }\n\t  }\n\t  \n\t  .time-divider {\n\t\ttext-align: center;\n\t\tpadding: 10rpx 0;\n\t\tmargin: 20rpx 0;\n\t\t\n\t\ttext {\n\t\t  font-size: 24rpx;\n\t\t  color: #999;\n\t\t  background-color: rgba(0,0,0,0.1);\n\t\t  border-radius: 10rpx;\n\t\t  padding: 4rpx 16rpx;\n\t\t}\n\t  }\n\t  \n\t  .message-row {\n\t\tdisplay: flex;\n\t\tmargin-bottom: 30rpx;\n\t\talign-items: flex-start;\n\t\twill-change: transform; /* 提示浏览器这个元素会变化，优化渲染 */\n\t\t\n\t\t.avatar-container {\n\t\t  width: 80rpx;\n\t\t  height: 80rpx;\n\t\t  flex-shrink: 0;\n\t\t}\n\t\t\n\t\t.avatar {\n\t\t  width: 80rpx;\n\t\t  height: 80rpx;\n\t\t  border-radius: 8rpx;\n\t\t}\n\t\t\n\t\t.message-content {\n\t\t  max-width: 70%;\n\t\t  padding: 0 20rpx;\n\t\t  \n\t\t  .sender-name {\n\t\t\tfont-size: 26rpx;\n\t\t\tcolor: #999;\n\t\t\tmargin-bottom: 6rpx;\n\t\t  }\n\t\t  \n\t\t  .bubble {\n\t\t\tpadding: 20rpx;\n\t\t\tbackground: #FFFFFF;\n\t\t\tborder-radius: 4rpx 16rpx 16rpx 16rpx;\n\t\t\t/* 支持中英文自动换行 */\n\t\t\tword-break: break-all;\n\t\t\toverflow-wrap: anywhere;\n\t\t\tword-wrap: break-word;\n\t\t\tdisplay: inline-block;\n\t\t\tmin-width: 40rpx;\n\t\t\tmax-width: 100%;\n\t\t\tbox-sizing: border-box;\n\t\t\twill-change: transform; /* 优化渲染性能 */\n\t\t  }\n\t\t  \n\t\t  .time {\n\t\t\tfont-size: 24rpx;\n\t\t\tcolor: #999;\n\t\t\tmargin-top: 8rpx;\n\t\t\ttext-align: left;\n\t\t  }\n\t\t  \n\t\t  &.self {\n\t\t\ttext-align: right;\n\t\t\t\n\t\t\t.bubble {\n\t\t\t  background: #95EC69;\n\t\t\t  border-radius: 16rpx 4rpx 16rpx 16rpx;\n\t\t\t}\n\t\t\t\n\t\t\t.time {\n\t\t\t  text-align: right;\n\t\t\t}\n\t\t  }\n\t\t}\n\t\t\n\t\t&.self {\n\t\t  justify-content: flex-end;\n\t\t}\n\t\t\n\t\t.text {\n\t\t  font-size: 28rpx;\n\t\t  line-height: 40rpx;\n\t\t  color: #333;\n\t\t  /* 文本支持中英文折行 */\n\t\t  word-break: break-all;\n\t\t  overflow-wrap: anywhere;\n\t\t  word-wrap: break-word;\n\t\t  white-space: pre-line;\n\t\t  max-width: 100%;\n\t\t  display: inline-block;\n\t\t}\n\t\t\n\t\t.image {\n\t\t  max-width: 400rpx;\n\t\t  border-radius: 8rpx;\n\t\t}\n\t\t\n\t\t.file-box, .location-box {\n\t\t  display: flex;\n\t\t  align-items: center;\n\t\t}\n\t\t\n\t\t.file-name, .location-name {\n\t\t  font-size: 28rpx;\n\t\t  color: #333;\n\t\t  margin-left: 10rpx;\n\t\t}\n\t  }\n\t}\n\n\t.input-area {\n\t  display: flex;\n\t  align-items: center;\n\t  padding: 20rpx;\n\t  background: #fff;\n\t  border-top: 1px solid #eee;\n\t  position: fixed;\n\t  left: 0;\n\t  right: 0;\n\t  bottom: 0;\n\t  z-index: 100;\n\t  box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);\n\t  \n\t  .more-btn, .send-btn {\n\t\twidth: 70rpx;\n\t\theight: 70rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tflex-shrink: 0;\n\t  }\n\t  \n\t  .input-wrapper {\n\t\tflex: 1;\n\t\tmargin: 0 20rpx;\n\t\tbackground: #f5f5f5;\n\t\tborder-radius: 8rpx;\n\t\tpadding: 16rpx;\n\t\t\n\t\t.message-input {\n\t\t  width: 100%;\n\t\t  min-height: 40rpx;\n\t\t  max-height: 180rpx;\n\t\t  font-size: 28rpx;\n\t\t  line-height: 1.5;\n\t\t}\n\t  }\n\t  \n\t  .send-btn {\n\t\tbackground: #ddd;\n\t\tborder-radius: 35rpx;\n\t\t\n\t\t&.active {\n\t\t  background: #2979ff;\n\t\t}\n\t  }\n\t}\n\n\t/* 面板展开時，輸入區上移到面板上方 */\n\t.input-area.with-panel {\n    bottom: 300rpx; /* 與面板高度一致 */\n\t}\n\n\t.more-panel {\n\t  display: flex;\n\t  flex-wrap: wrap;\n\t  padding: 30rpx 20rpx;\n\t  background: #fff;\n\t  border-top: 1px solid #eee;\n\t  position: fixed;\n\t  left: 0;\n\t  right: 0;\n\t  bottom: 0; /* 固定在最底部，位於輸入區下方 */\n    height: 300rpx; /* 固定面板高度 */\n    overflow: auto;\n\t  z-index: 99;\n\t  box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);\n\t  \n\t  .panel-item {\n\t\twidth: 25%;\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\talign-items: center;\n\t\tmargin-bottom: 30rpx;\n\t\t\n\t\t.panel-icon {\n\t\t  width: 100rpx;\n\t\t  height: 100rpx;\n\t\t  background: #f5f5f5;\n\t\t  border-radius: 20rpx;\n\t\t  display: flex;\n\t\t  align-items: center;\n\t\t  justify-content: center;\n\t\t  margin-bottom: 10rpx;\n\t\t}\n\t\t\n\t\ttext {\n\t\t  font-size: 24rpx;\n\t\t  color: #666;\n\t\t}\n\t  }\n\t}\n\t</style> ","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/chat/room.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","getUser","uni","computed","apiModule","setUser","wsClient","chatAPI","nextTick","wx","res","onLoad","onUnload","onHide"],"mappings":"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"}