{"version":3,"file":"activityDeatil.js","sources":["pages/activity/activityDeatil.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWN0aXZpdHkvYWN0aXZpdHlEZWF0aWwudnVl"],"sourcesContent":["<template>\n  <view \n    class=\"detail-container pageBg\"\n    @touchstart=\"handleTouchStart\"\n    @touchend=\"handleTouchEnd\"\n  >\n    <!-- 添加左侧边缘滑动区域 -->\n    <view \n      class=\"edge-swipe-area\"\n      @touchstart=\"handleTouchStart\"\n      @touchend=\"handleTouchEnd\"\n    ></view>\n    \n    <!-- 状态栏 -->\n    <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\n    \n    <!-- 顶部导航 -->\n\t<!-- #ifndef MP-TOUTIAO -->\n\t<custom-nav-bar title=\"活动详情\" :showBack=\"true\" @backClick=\"goBack\"></custom-nav-bar>\n\t<!-- #endif -->\n    \n    <!-- 活动内容 -->\n    <scroll-view scroll-y class=\"detail-content\">\n      <!-- 活动海报 -->\n      <view class=\"poster-container\">\n        <image \n          class=\"activity-poster\" \n\t        :src=\"getPosterUrl(activityDetail.poster)\" \n          mode=\"aspectFill\"\n        ></image>\n        <view class=\"poster-overlay\">\n\t        <view class=\"status-tag\" :class=\"getStatusClass(activityDetail)\">\n\t          {{ getStatusText(activityDetail) }}\n          </view>\n        </view>\n      </view>\n      \n      <!-- 活动标题 -->\n      <view class=\"activity-title\">\n        <text>{{ activityDetail.title || '加载中...' }}</text>\n      </view>\n      \n      <!-- 活动信息 -->\n      <view class=\"info-section\">\n        <view class=\"info-item\">\n          <uni-icons type=\"calendar\" size=\"18\" color=\"#b13b7a\"></uni-icons>\n          <text>{{ formatFullDate(activityDetail.startTime) }} 至 {{ formatFullDate(activityDetail.endTime) }}</text>\n        </view>\n        <view class=\"info-item\">\n          <uni-icons type=\"location\" size=\"18\" color=\"#b13b7a\"></uni-icons>\n          <text>{{ activityDetail.address || '未设置地点' }}</text>\n        </view>\n        <view class=\"info-item\">\n          <uni-icons type=\"person\" size=\"18\" color=\"#b13b7a\"></uni-icons>\n          <text>{{ activityDetail.joinCount || 0 }}人已报名</text>\n        </view>\n        <view class=\"info-item\">\n          <uni-icons type=\"eye\" size=\"18\" color=\"#b13b7a\"></uni-icons>\n          <text>{{ activityDetail.viewCount || 0 }}次浏览</text>\n        </view>\n      </view>\n      \n      <!-- 社团信息 -->\n      <view class=\"club-card\" @tap=\"goToClub\" v-if=\"clubInfo.id\">\n        <image class=\"club-logo\" :src=\"clubInfo.logo || '/static/images/default-club.png'\" mode=\"aspectFill\"></image>\n        <view class=\"club-info\">\n          <view class=\"club-name\">{{ clubInfo.name || '加载中...' }}</view>\n          <view class=\"club-desc\">{{ clubInfo.description || '暂无简介' }}</view>\n        </view>\n        <uni-icons type=\"right\" size=\"16\" color=\"#ccc\"></uni-icons>\n      </view>\n      \n      <!-- 活动详情 -->\n      <view class=\"detail-section\">\n        <view class=\"section-title\">活动详情</view>\n        <rich-text :nodes=\"activityDetail.description || '暂无详情'\"></rich-text>\n      </view>\n      \n      <!-- 已报名信息 -->\n      <view v-if=\"hasApplied\" class=\"applied-section\">\n        <view class=\"section-title\">报名状态</view>\n        <view :class=\"['apply-status', getApplyStatusClass(applyInfo.status)]\">\n          {{ getApplyStatusText(applyInfo.status) }}\n        </view>\n        \n        <!-- 签到二维码 -->\n        <view v-if=\"applyInfo.status === 1\" class=\"check-in-section\">\n          <view class=\"check-in-tip\">\n          <uni-icons type=\"info\" size=\"16\" color=\"#ff9800\"></uni-icons>\n            <text>请出示二维码给管理员扫描完成签到</text>\n          </view>\n        </view>\n        \n        <view v-if=\"applyInfo.feedback\" class=\"feedback-info\">\n          <view class=\"feedback-title\">反馈信息：</view>\n          <view class=\"feedback-content\">{{ applyInfo.feedback }}</view>\n        </view>\n        \n        <!-- 显示用户个人信息 -->\n        <view class=\"apply-info\">\n          <view class=\"info-title\">个人信息：</view>\n          <view class=\"info-item\">\n            <text class=\"info-label\">姓名：</text>\n            <text class=\"info-value\">{{ userInfo.username }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"info-label\">学号：</text>\n            <text class=\"info-value\">{{ userInfo.studentId }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"info-label\">手机号：</text>\n            <text class=\"info-value\">{{ userInfo.mobile }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"info-label\">学院：</text>\n            <text class=\"info-value\">{{ userInfo.college }}</text>\n          </view>\n          <view class=\"info-item\">\n            <text class=\"info-label\">班级：</text>\n            <text class=\"info-value\">{{ userInfo.className }}</text>\n          </view>\n        </view>\n      </view>\n      \n      <!-- 底部区域占位 -->\n      <view style=\"height: 150rpx;\"></view>\n    </scroll-view>\n    \n    <!-- 底部操作栏 -->\n    <view class=\"action-bar\" v-if=\"!isPopupOpen\">\n      <view v-if=\"isAdmin\" class=\"admin-actions\">\n        <button class=\"edit-btn\" @tap=\"editActivity\">编辑活动</button>\n        <button class=\"manage-btn\" @tap=\"manageApplies\">管理报名</button>\n      </view>\n      \n      <view v-else class=\"user-actions\">\n        <!-- 未报名且可以报名且按钮应该显示 -->\n        <button v-if=\"!hasApplied && showApplyBtn\" class=\"apply-btn\" @tap=\"showApplyForm\">立即报名</button>\n        \n        <!-- 已报名且报名已通过 -->\n        <button v-else-if=\"hasApplied && applyInfo && applyInfo.status === 1\" class=\"checkin-btn\" @tap=\"showQRCode\">\n          {{ applyInfo && applyInfo.checkInStatus === 1 ? '已签到' : '签到' }}\n        </button>\n        \n        <!-- 已报名但审核中，可以取消报名 -->\n        <button v-else-if=\"hasApplied && applyInfo && applyInfo.status === 0\" class=\"cancel-btn\" @tap=\"cancelApply\">取消报名</button>\n        \n        <!-- 不可报名状态 -->\n        <button v-else class=\"disabled-btn\" disabled>{{ getDisabledReason() }}</button>\n      </view>\n    </view>\n    \n    <!-- 报名表单弹窗 -->\n    <uni-popup ref=\"applyPopup\" type=\"bottom\" @change=\"handlePopupChange\">\n      <view class=\"apply-popup-content\">\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">活动报名</text>\n          <view class=\"close-btn\" @tap=\"closeApplyForm\">\n            <uni-icons type=\"close\" size=\"20\" color=\"#999\"></uni-icons>\n          </view>\n        </view>\n        \n        <scroll-view scroll-y class=\"popup-content\">\n          <view v-if=\"formFields && formFields.length > 0\" class=\"form-content\">\n            <view v-for=\"(field, idx) in formFields\" :key=\"idx\" class=\"form-item\">\n              <text class=\"form-label\">{{ field.label }}{{ field.required ? ' *' : '' }}</text>\n              \n              <!-- 文本输入 -->\n              <input \n                v-if=\"field.type === 'text'\" \n                type=\"text\" \n                v-model=\"field.value\" \n                :placeholder=\"'请输入' + field.label\"\n                class=\"form-input\"\n              />\n              \n              <!-- 数字输入 -->\n              <input \n                v-if=\"field.type === 'number'\" \n                type=\"number\" \n                v-model=\"field.value\" \n                :placeholder=\"'请输入' + field.label\"\n                class=\"form-input\"\n              />\n              \n              <!-- 长文本 -->\n              <textarea \n                v-if=\"field.type === 'textarea'\" \n                v-model=\"field.value\" \n                :placeholder=\"'请输入' + field.label\"\n                class=\"form-textarea\"\n              />\n              \n              <!-- 单选 -->\n              <picker \n                v-if=\"field.type === 'select' || field.type === 'radio'\" \n                mode=\"selector\" \n                :range=\"field.options\" \n                @change=\"(e) => onOptionChange(idx, e)\"\n              >\n                <view class=\"form-picker\">\n                  {{ field.value || '请选择' + field.label }}\n                </view>\n              </picker>\n              \n              <!-- 多选 (checkbox) -->\n              <view v-if=\"field.type === 'checkbox'\" class=\"checkbox-group\">\n                <checkbox-group @change=\"(e) => onCheckboxChange(idx, e)\">\n                  <label v-for=\"(option, optIdx) in field.options\" :key=\"optIdx\" class=\"checkbox-item\">\n                    <checkbox :value=\"option\" :checked=\"isOptionChecked(field.value, option)\" />\n                    <text class=\"checkbox-label\">{{ option }}</text>\n                  </label>\n                </checkbox-group>\n              </view>\n              \n              <!-- 日期选择 -->\n              <picker \n                v-if=\"field.type === 'date'\" \n                mode=\"date\" \n                :value=\"field.value\" \n                @change=\"(e) => onDateChange(idx, e)\"\n              >\n                <view class=\"form-picker\">\n                  {{ field.value || '请选择日期' }}\n                </view>\n              </picker>\n            </view>\n          </view>\n          \n          <view v-else class=\"empty-form\">\n            <text>该活动无需填写报名信息</text>\n          </view>\n        </scroll-view>\n        \n        <view class=\"popup-footer\">\n          <view class=\"footer-buttons\">\n          <button class=\"cancel-btn\" @tap=\"closeApplyForm\">取消</button>\n          <button class=\"confirm-btn\" @tap=\"submitApply\">确认报名</button>\n          </view>\n        </view>\n      </view>\n    </uni-popup>\n    \n    <!-- 操作菜单 -->\n    <uni-popup ref=\"actionSheet\" type=\"bottom\">\n      <view class=\"action-sheet-content\">\n        <view class=\"action-item\" @tap=\"shareActivity\">\n          <uni-icons type=\"redo\" size=\"20\" color=\"#333\"></uni-icons>\n          <text>分享活动</text>\n        </view>\n        <view v-if=\"isAdmin\" class=\"action-item\" @tap=\"cancelActivity\">\n          <uni-icons type=\"trash\" size=\"20\" color=\"#333\"></uni-icons>\n          <text>取消活动</text>\n        </view>\n        <view class=\"action-item cancel\" @tap=\"hideActionSheet\">取消</view>\n      </view>\n    </uni-popup>\n    \n    <!-- 二维码弹窗 -->\n    <uni-popup ref=\"qrcodePopup\" type=\"center\">\n      <view class=\"qrcode-popup\">\n        <view class=\"popup-header\">\n          <text class=\"popup-title\">签到二维码</text>\n          <view class=\"close-btn\" @tap=\"closeQRCode\">\n            <uni-icons type=\"close\" size=\"20\" color=\"#999\"></uni-icons>\n          </view>\n        </view>\n        <view class=\"qrcode-content\">\n          <!-- 简化二维码显示方式 -->\n          <image \n            class=\"qrcode-img\" \n            :src=\"applyInfo.qrCodeUrl\" \n            mode=\"aspectFit\" \n            v-if=\"applyInfo && applyInfo.qrCodeUrl\"\n            @error=\"handleImageError\"\n            @load=\"handleImageLoad\"\n          ></image>\n          \n          <text v-if=\"!applyInfo || !applyInfo.qrCodeUrl\" class=\"qrcode-tips\">请向活动管理员出示此二维码完成签到</text>\n          <text v-if=\"applyInfo && applyInfo.qrCodeUrl\" class=\"qrcode-tips\">请向活动管理员出示此二维码完成签到</text>\n          <text class=\"qrcode-name\">{{ userInfo.username || '未知用户' }}</text>\n          <text class=\"qrcode-activity\">{{ activityDetail.title }}</text>\n          <view class=\"qrcode-status\" :class=\"{ 'checked-in': applyInfo && applyInfo.checkInStatus === 1 }\">\n            {{ applyInfo && applyInfo.checkInStatus === 1 ? '已签到' : '未签到' }}\n          </view>\n          <view v-if=\"applyInfo && applyInfo.expireTime\" class=\"qrcode-expire-time\">\n            签到码有效期: {{ formatExpireTime(applyInfo.expireTime) }}\n          </view>\n          <button v-if=\"applyInfo && applyInfo.qrCodeUrl\" class=\"qrcode-refresh-btn\" @tap=\"refreshCheckInCode\">刷新签到码</button>\n        </view>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted, getCurrentInstance, watch, onBeforeUnmount, nextTick } from 'vue'\nimport { formatDate, getImageUrl } from '@/utils/common.js'\nimport wsClient from '@/utils/websocket'\nimport apiModule from '@/api/api.js'\nimport {\n  getActualStatus,\n  getStatusText,\n  getStatusClass,\n  getApplyStatusText,\n  getApplyStatusClass,\n  checkUserInfoComplete,\n  getFieldDisplayName,\n  parseFormFields,\n  parseFormData,\n  fillUserInfoToForm,\n  validateFormData,\n  buildFormData,\n  notifyActivityDataChanged\n} from '@/utils/activity.js'\n\nconst { proxy } = getCurrentInstance()\n\n// 状态栏高度\nconst statusBarHeight = ref(20)\n// 活动ID\nconst id = ref(null)\n// 用户角色\nconst isAdmin = ref(false)\n// 活动详情\nconst activityDetail = ref({})\n// 社团信息\nconst clubInfo = ref({})\n// 表单字段\nconst formFields = ref([])\n// 报名信息\nconst applyInfo = ref(null)\n// 是否已报名\nconst hasApplied = ref(false)\n// 解析后的表单数据\nconst parsedForms = ref({})\n// 用户信息\nconst userInfo = ref({\n  name: '',\n  studentId: ''\n})\n\n// 弹窗引用\nconst applyPopup = ref(null)\nconst qrcodePopup = ref(null)\nconst actionSheet = ref(null)\n\n// 控制底部按钮区域的显示\nconst isPopupOpen = ref(false);\n\n// 改进的触摸处理\nconst touchStartX = ref(0)\nconst touchStartY = ref(0) // 添加Y坐标检测\nconst touchEndX = ref(0)\nconst minSwipeDistance = 100\nconst edgeWidth = 30 // 边缘检测宽度，单位px\n\n// 在script setup部分添加一个新的ref变量\nconst showApplyBtn = ref(false); // 默认隐藏，等确认不是管理员后再显示\n\n// 弹窗状态变化处理\nconst handlePopupChange = (e) => {\n  // 弹窗打开时，隐藏底部按钮区域\n  isPopupOpen.value = e.show;\n}\n\n// 触摸开始事件处理\nconst handleTouchStart = (e) => {\n  touchStartX.value = e.changedTouches[0].clientX\n  touchStartY.value = e.changedTouches[0].clientY\n}\n\n// 触摸结束事件处理\nconst handleTouchEnd = (e) => {\n  // 只有在屏幕左侧边缘开始的滑动才处理\n  if (touchStartX.value > edgeWidth) {\n    return\n  }\n  \n  // 获取结束位置\n  touchEndX.value = e.changedTouches[0].clientX\n  const touchEndY = e.changedTouches[0].clientY\n  \n  // 计算水平和垂直滑动距离\n  const swipeDistanceX = touchEndX.value - touchStartX.value\n  const swipeDistanceY = Math.abs(touchEndY - touchStartY.value)\n  \n  // 确保是水平滑动(X方向位移大于Y方向)且向右滑动距离超过阈值\n  if (swipeDistanceX > minSwipeDistance && swipeDistanceX > swipeDistanceY * 1.5) {\n    // 执行返回操作，不再判断页面栈\n    goBack();\n  }\n}\n\n// 初始化\nonMounted(() => {\n    // 获取状态栏高度\n    const systemInfo = uni.getSystemInfoSync()\n  statusBarHeight.value = systemInfo.statusBarHeight || 20\n    \n  // 初始化applyInfo为空对象而不是null，避免属性访问错误\n  applyInfo.value = {}\n  \n  // 获取路由参数\n  const pages = getCurrentPages()\n  const currentPage = pages[pages.length - 1]\n  if (currentPage && currentPage.options) {\n    id.value = currentPage.options.id\n    \n    // 检查是否有时间戳参数，表示需要强制刷新\n    const timestamp = currentPage.options.t\n    const forceRefresh = !!timestamp\n    \n    // 如果有时间戳参数或者没有传递活动数据，直接通过API加载最新数据\n    if (forceRefresh || !currentPage.options.itemData) {\n      loadActivityDetail()\n    } else {\n      // 尝试从参数中获取活动数据\n      try {\n        const itemData = JSON.parse(decodeURIComponent(currentPage.options.itemData))\n        \n        // 确保时间戳是数字类型\n        activityDetail.value = {\n          ...itemData,\n          startTime: Number(itemData.startTime),\n          endTime: Number(itemData.endTime)\n        }\n        \n        // 获取社团信息\n        if (activityDetail.value.clubId) {\n          loadClubInfo(activityDetail.value.clubId)\n        }\n        \n        // 解析表单字段\n        parseFormFieldsFromData()\n    \n        // 判断是否可以报名\n        checkCanApply()\n        \n        // 立即获取最新数据\n        refreshActivityData()\n      } catch (e) {\n        console.error('解析活动数据失败:', e)\n        // 解析失败时，回退到API请求\n        loadActivityDetail()\n      }\n    }\n    \n    // 获取用户信息\n    getUserInfo()\n\n    // 检查是否已报名\n    checkApplyStatus()\n\n    // 监听签到成功事件，实现自动刷新\n    uni.$on('activityCheckInSuccess', handleCheckInSuccess)\n\n    // 设置WebSocket签到通知监听\n    setupWebSocketListener()\n  } else {\n    console.error('获取页面参数失败')\n    uni.showToast({\n      title: '页面参数错误',\n      icon: 'none'\n    })\n  }\n})\n\n// 组件销毁前清除事件监听\nonBeforeUnmount(() => {\n  // 移除签到成功事件监听\n  uni.$off('activityCheckInSuccess', handleCheckInSuccess)\n\n  // 移除WebSocket签到通知监听\n  wsClient.messageHandlers.delete('check_in_notification')\n})\n\n// 处理签到成功事件\nconst handleCheckInSuccess = async (data) => {\n  // 检查是否是当前活动的签到事件\n  if (data && data.activityId && data.activityId.toString() === id.value.toString()) {\n    console.log('收到签到成功事件，开始刷新活动详情')\n\n    // 刷新用户的报名状态（包括签到状态），不显示加载框\n    await checkApplyStatus(false)\n\n    // 刷新活动数据\n    await refreshActivityData()\n\n    // 使用 nextTick 确保视图更新\n    await nextTick()\n\n    console.log('活动详情刷新完成，当前签到状态:', applyInfo.value.checkInStatus)\n  }\n}\n\n// 设置WebSocket签到通知监听\nconst setupWebSocketListener = async () => {\n  try {\n    // 获取后端服务器地址\n    const serverUrl = apiModule.baseURL || 'localhost:8081'\n\n    // 检查WebSocket是否已连接\n    if (!wsClient.isConnected) {\n      console.log('WebSocket未连接，正在建立连接...')\n      try {\n        await wsClient.connect(serverUrl)\n        console.log('WebSocket连接成功')\n      } catch (error) {\n        console.warn('WebSocket连接失败，将在重连后自动注册监听器:', error)\n        // 不影响页面加载，WebSocket会自动重连\n      }\n    } else {\n      console.log('WebSocket已连接，直接注册监听器')\n    }\n\n    // 注册签到通知消息处理器\n    wsClient.onMessageType('check_in_notification', (message) => {\n      console.log('【WebSocket】收到签到通知:', message)\n\n      // 检查是否是当前活动的签到通知\n      if (message.activityId && message.activityId.toString() === id.value.toString()) {\n        console.log('【WebSocket】签到通知匹配当前活动，开始刷新')\n\n        // 刷新活动数据和报名状态\n        handleCheckInSuccess({\n          activityId: message.activityId,\n          checkInStatus: message.checkInStatus\n        })\n\n        // 显示签到成功提示\n        uni.showToast({\n          title: '签到成功',\n          icon: 'success',\n          duration: 2000\n        })\n      } else {\n        console.log('【WebSocket】签到通知不匹配当前活动', {\n          messageActivityId: message.activityId,\n          currentActivityId: id.value\n        })\n      }\n    })\n\n    console.log('WebSocket签到通知监听已设置，当前连接状态:', wsClient.isConnected)\n  } catch (error) {\n    console.error('设置WebSocket监听器失败:', error)\n  }\n}\n\n// 刷新活动数据\nconst refreshActivityData = async () => {\n  try {\n    if (!id.value) return\n    \n    const res = await proxy.$api.activity.getActivityDetail(id.value)\n    if (res.code === 200 && res.data) {\n      // 更新活动详情数据，确保所有字段都更新\n      const newData = res.data\n      \n      // 保存当前值以便比较\n      const oldPoster = activityDetail.value.poster\n      const oldJoinCount = activityDetail.value.joinCount\n      const oldViewCount = activityDetail.value.viewCount\n      \n      // 更新整个对象\n      Object.keys(newData).forEach(key => {\n        activityDetail.value[key] = newData[key]\n      })\n      \n      // 如果海报URL发生变化，记录日志\n      if (oldPoster !== activityDetail.value.poster) {\n        console.log('海报已更新:', activityDetail.value.poster)\n      }\n      \n      // 记录报名人数和浏览量变化\n      if (oldJoinCount !== activityDetail.value.joinCount || oldViewCount !== activityDetail.value.viewCount) {\n        console.log('数据已更新:', {\n          joinCount: activityDetail.value.joinCount,\n          viewCount: activityDetail.value.viewCount\n        })\n      }\n      \n      // 重新检查是否可以报名\n      checkCanApply()\n    }\n  } catch (error) {\n    console.error('刷新活动数据失败:', error)\n  }\n}\n\n// 获取用户信息\nconst getUserInfo = async () => {\n  try {\n    const res = await proxy.$api.user.getUserInfo()\n    if (res.code === 200) {\n      userInfo.value = res.data\n      \n      // 检查用户是否是管理员\n      checkAdmin()\n    }\n  } catch (error) {\n    // 错误已处理\n  }\n}\n\n// 加载活动详情\nconst loadActivityDetail = async () => {\n  if (!id.value) {\n    console.error('活动ID不存在')\n    uni.showToast({\n      title: '活动ID不存在',\n      icon: 'none'\n    })\n    return\n  }\n  \n  try {\n    uni.showLoading({ title: '加载中...' })\n    \n    // 不再添加时间戳防止缓存\n    const res = await proxy.$api.activity.getActivityDetail(id.value)\n    \n    if (res.code === 200 && res.data) {\n      // 完全替换活动详情数据\n      activityDetail.value = res.data\n      \n      // 获取社团信息\n      if (activityDetail.value.clubId) {\n        loadClubInfo(activityDetail.value.clubId)\n      }\n      \n      // 解析表单字段\n      parseFormFieldsFromData()\n        \n        // 判断是否可以报名\n      checkCanApply()\n    } else {\n      uni.showToast({\n        title: res.message || '加载失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('加载活动详情失败:', error)\n    uni.showToast({\n      title: '网络异常，请稍后重试',\n      icon: 'none'\n    })\n  } finally {\n    uni.hideLoading()\n  }\n}\n\n// 解析活动详情中的表单字段\nconst parseFormFieldsFromData = () => {\n  try {\n    console.log('解析表单字段，活动详情:', JSON.stringify(activityDetail.value));\n    \n    if (activityDetail.value && activityDetail.value.forms) {\n      formFields.value = parseFormFields(activityDetail.value.forms);\n    } else {\n      console.log('活动没有自定义表单，使用默认表单');\n      // 使用默认表单\n      formFields.value = parseFormFields(null);\n    }\n  } catch (e) {\n    console.error('解析表单字段失败:', e);\n    // 解析失败时使用默认表单\n    formFields.value = parseFormFields(null);\n  }\n}\n\n// 加载社团信息\nconst loadClubInfo = async (clubId) => {\n  try {\n    const res = await proxy.$api.club.getClubDetail(clubId)\n    if (res.code === 200) {\n      clubInfo.value = res.data\n    }\n  } catch (error) {\n    // 错误已处理\n  }\n}\n    \n    // 检查用户是否是管理员\nconst checkAdmin = async () => {\n  try {\n    // 确保有clubId再发送请求\n    const clubId = activityDetail.value.clubId || (clubInfo.value ? clubInfo.value.id : null);\n    if (!clubId) {\n      isAdmin.value = false;\n      console.log('没有clubId，设置为非管理员');\n      checkCanApply(); // 确认不是管理员后，更新按钮状态\n      return;\n    }\n\n    // 通过社团Id发送api查询\n    const res = await proxy.$api.club.getUserRole(clubId);\n\n    console.log('getUserRole 返回结果:', res);\n\n    // 判断用户是否是管理员\n    if (res.code === 200 && res.data && res.data.type > 0 && res.data.status == 1) {\n      isAdmin.value = true;\n      console.log('确认用户是管理员');\n    } else {\n      isAdmin.value = false;\n      console.log('确认用户不是管理员');\n    }\n\n    // 管理员身份确认后，重新检查是否可以报名（更新按钮显示状态）\n    checkCanApply();\n\n    // 查询完管理员状态后，刷新活动数据以获取最新的浏览量和报名人数\n    refreshActivityData();\n  } catch (error) {\n    console.error('检查管理员身份失败:', error);\n    isAdmin.value = false;\n    checkCanApply(); // 出错时也要更新按钮状态\n  }\n}\n\n\n// 检查是否已报名\nconst checkApplyStatus = async (showLoading = true) => {\n  try {\n    if (!id.value) return\n\n    if (showLoading) {\n      uni.showLoading({ title: '加载中...' })\n    }\n    \n    // 调用API检查用户是否已报名该活动\n    const res = await proxy.$api.activity.checkApplyStatus(id.value)\n\n    console.log('checkApplyStatus API 返回结果:', res)\n\n    if (res.code === 200) {\n      if (res.data) {\n        // 有报名数据，表示已报名\n        hasApplied.value = true\n        // 直接替换整个对象以确保响应式更新\n        applyInfo.value = { ...res.data }\n\n        console.log('applyInfo 已更新:', JSON.stringify(applyInfo.value))\n          \n          // 解析已提交的表单数据\n          try {\n          if (applyInfo.value.forms) {\n            // 使用工具函数解析表单数据\n            parsedForms.value = parseFormData(applyInfo.value.forms)\n            \n            // 如果解析后是空对象，添加默认字段\n            if (Object.keys(parsedForms.value).length === 0) {\n              parsedForms.value = { reason: '用户未填写参加原因' }\n            }\n          } else {\n            parsedForms.value = { reason: '用户未填写参加原因' }\n          }\n          } catch (e) {\n          console.error('解析表单数据失败:', e)\n          parsedForms.value = { reason: '表单数据解析失败' }\n          }\n        } else {\n        // data为null，表示未报名\n        hasApplied.value = false\n        applyInfo.value = {} // 使用空对象而不是null\n        parsedForms.value = {}\n      }\n\n      // 在获取报名状态后，不在这里更新按钮显示状态\n      // 按钮状态由 checkAdmin() -> checkCanApply() 统一控制\n\n      // 打印签到状态用于调试\n      console.log('报名信息已更新:', {\n        hasApplied: hasApplied.value,\n        checkInStatus: applyInfo.value.checkInStatus,\n        applyId: applyInfo.value.id\n      })\n    } else {\n      uni.showToast({\n        title: res.message || '获取报名状态失败',\n        icon: 'none'\n      })\n      // 确保applyInfo是一个空对象而不是null\n      applyInfo.value = {}\n    }\n  } catch (error) {\n    console.error('检查报名状态失败:', error)\n    hasApplied.value = false // 出错时默认为未报名\n    applyInfo.value = {} // 使用空对象而不是null\n    parsedForms.value = {}\n    uni.showToast({\n      title: '网络异常，请稍后重试',\n      icon: 'none'\n    })\n  } finally {\n    if (showLoading) {\n      uni.hideLoading()\n    }\n  }\n}\n    \n    // 判断是否可以报名\nconst checkCanApply = () => {\n  // 获取活动实际状态\n  const actualStatus = getActualStatus(activityDetail.value)\n\n  console.log('checkCanApply 执行:', {\n    isAdmin: isAdmin.value,\n    actualStatus: actualStatus,\n    hasApplied: hasApplied.value\n  })\n\n  // 如果用户是管理员，不显示报名按钮\n  if (isAdmin.value) {\n    showApplyBtn.value = false\n    console.log('用户是管理员，隐藏报名按钮')\n    return\n  }\n\n  // 只有在实际状态为\"报名中\"(1)时且未报名才可以报名\n  showApplyBtn.value = actualStatus === 1 && !hasApplied.value\n  console.log('用户不是管理员，showApplyBtn =', showApplyBtn.value)\n}\n\n// 获取无法报名的原因\nconst getDisabledReason = () => {\n  // 如果用户已报名但不符合上面的条件\n  if (hasApplied.value) {\n    return '您已报名此活动';\n  }\n  \n  const actualStatus = getActualStatus(activityDetail.value);\n  \n  if (actualStatus === 0) {\n    return '活动已取消';\n      }\n      \n  if (actualStatus === 3) {\n    return '活动已结束';\n      }\n      \n  if (actualStatus === 2) {\n    return '活动进行中';\n      }\n      \n  return '报名已截止';\n}\n    \n    // 格式化完整日期\nconst formatFullDate = (timestamp) => {\n      if (!timestamp) return '未设置'\n  timestamp = Number(timestamp)\n      const date = new Date(timestamp)\n  return formatDate(date)\n}\n\n// 获取字段标签\nconst getFieldLabel = (key) => {\n  const field = formFields.value.find(f => f.key === key)\n  return field ? field.label : getFieldDisplayName(key) || key\n}\n\n// 返回上一页\nconst goBack = () => {\n  // 获取当前页面栈\n  const pages = getCurrentPages()\n  \n  // 先发送数据变化事件，确保列表刷新\n  notifyActivityDataChanged()\n  \n  // 添加短暂延迟，确保通知事件被处理\n  setTimeout(() => {\n    // 如果页面栈中有多个页面，说明可以返回\n    if (pages.length > 1) {\n    // 返回上一页\n      uni.navigateBack()\n    } else {\n      // 如果没有上一页，跳转到活动列表页\n      uni.switchTab({\n        url: '/pages/activity/activity'\n      })\n    }\n  }, 100) // 添加100ms延迟\n}\n    \n    // 前往社团详情\nconst goToClub = () => {\n  if (clubInfo.value.id) {\n      uni.navigateTo({\n      url: `/pages/club/detail?id=${clubInfo.value.id}`\n      })\n  }\n}\n\n// 显示报名表单\nconst showApplyForm = () => {\n  // 立即隐藏报名按钮\n  showApplyBtn.value = false;\n  \n  // 检查用户信息是否完善\n  const result = checkUserInfoComplete(userInfo.value);\n  if (!result.isComplete) {\n    uni.showModal({\n      title: '信息不完整',\n      content: `您的个人信息不完整，缺少: ${result.missingFields.join('、')}，请先完善个人信息后再报名活动`,\n      confirmText: '去完善',\n      success: (res) => {\n        if (res.confirm) {\n          uni.switchTab({\n            url: '/pages/user/user'\n          });\n        } else {\n          // 如果用户取消，恢复报名按钮\n          showApplyBtn.value = true;\n        }\n      }\n    });\n    return;\n  }\n  \n  // 如果表单字段为空，尝试重新解析\n  if (!formFields.value || formFields.value.length === 0) {\n    parseFormFieldsFromData();\n  }\n  \n  // 确保表单字段存在\n  if (formFields.value && formFields.value.length > 0) {\n    console.log('填充前的表单字段:', JSON.stringify(formFields.value));\n    \n    // 自动填充用户信息到表单\n    formFields.value = fillUserInfoToForm(formFields.value, userInfo.value);\n    \n    console.log('填充后的表单字段:', JSON.stringify(formFields.value));\n  } else {\n    console.error('表单字段为空，无法显示报名表单');\n      uni.showToast({\n      title: '表单加载失败，请重试',\n        icon: 'none'\n    });\n    // 恢复报名按钮\n    showApplyBtn.value = true;\n    return;\n  }\n  \n  applyPopup.value.open();\n}\n\n// 关闭报名表单\nconst closeApplyForm = () => {\n  applyPopup.value.close();\n  \n  // 恢复报名按钮状态，如果活动仍在报名中\n  if (getActualStatus(activityDetail.value) === 1 && !hasApplied.value) {\n    showApplyBtn.value = true;\n  }\n}\n    \n    // 选项变更\nconst onOptionChange = (index, e) => {\n      const selectedIndex = e.detail.value\n  formFields.value[index].value = formFields.value[index].options[selectedIndex]\n}\n    \n    // 日期变更\nconst onDateChange = (index, e) => {\n  formFields.value[index].value = e.detail.value\n}\n    \n    // 提交报名\nconst submitApply = async () => {\n  // 验证表单数据\n  const validation = validateFormData(formFields.value)\n  if (!validation.isValid) {\n        uni.showToast({\n      title: validation.errorMessage,\n          icon: 'none'\n        })\n        return\n      }\n      \n  // 构建表单数据\n  const formData = buildFormData(formFields.value)\n      \n  try {\n    uni.showLoading({ title: '提交中...' })\n      \n    // 调用API提交报名\n    const res = await proxy.$api.activity.applyActivity(id.value, formData)\n    \n    // 确保无论成功与否都隐藏加载提示\n        uni.hideLoading()\n        \n    if (res.code === 200) {\n      // 先关闭表单弹窗\n      closeApplyForm()\n      \n      // 更新本地状态\n      hasApplied.value = true\n      // 初始化为空对象，然后添加属性\n      applyInfo.value = {\n        id: res.data.applyId,\n        activityId: id.value,\n        userId: userInfo.value.id,\n        status: res.data.status || 0,\n          forms: JSON.stringify(formData),\n          feedback: '',\n        checkInStatus: 0,\n        checkInTime: 0,\n        createTime: Date.now(),\n        qrCodeUrl: '', // 确保qrCodeUrl属性存在\n        expireTime: 0  // 确保expireTime属性存在\n        }\n        \n      // 保存解析后的表单数据，直接使用对象\n      parsedForms.value = formData\n        \n      // 显示成功提示\n        uni.showToast({\n        title: res.data.needApproval ? '报名成功，等待审核' : '报名成功',\n          icon: 'success'\n        })\n        \n      // 报名成功后确保按钮不会再显示\n      showApplyBtn.value = false\n      \n      // 重新检查报名状态和是否可以报名\n      checkCanApply()\n      \n      // 立即刷新活动数据\n      refreshActivityData()\n    } else {\n      // 显示错误提示\n      uni.showToast({\n        title: res.message || '报名失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('提交报名失败:', error)\n    uni.hideLoading()\n    \n    // 尝试检查是否已经报名成功\n    await checkApplyStatus()\n    \n    // 如果检查后发现已报名，不显示错误\n    if (hasApplied.value) {\n      // 如果已经报名成功，关闭表单\n      closeApplyForm()\n      // 确保按钮不会再显示\n      showApplyBtn.value = false\n    } else {\n      uni.showToast({\n        title: '提交请求失败，请稍后重试',\n        icon: 'none'\n      })\n    }\n  }\n}\n    \n    // 取消报名\nconst cancelApply = () => {\n  // 确保applyInfo存在且有id属性\n  if (!applyInfo.value || !applyInfo.value.id) {\n    uni.showToast({\n      title: '报名信息不存在',\n      icon: 'none'\n    })\n    return\n  }\n  \n      uni.showModal({\n        title: '取消报名',\n        content: '确定要取消报名吗？',\n    success: async (res) => {\n          if (res.confirm) {\n        try {\n            uni.showLoading({\n              title: '取消中...'\n            })\n            \n          // 调用API取消报名\n          const result = await proxy.$api.activity.cancelApply(applyInfo.value.id)\n          \n          if (result.code === 200) {\n            hasApplied.value = false\n            applyInfo.value = {} // 使用空对象而不是null\n            parsedForms.value = {}\n              \n              // 清空表单\n            formFields.value.forEach(field => {\n                field.value = ''\n              })\n            \n            // 重新显示报名按钮\n            showApplyBtn.value = true\n            \n            // 重新检查是否可以报名\n            checkCanApply()\n            \n            // 立即刷新活动数据\n            refreshActivityData();\n              \n              uni.showToast({\n                title: '已取消报名',\n                icon: 'success'\n              })\n          } else {\n            uni.showToast({\n              title: result.message || '取消失败',\n              icon: 'none'\n            })\n          }\n        } catch (error) {\n          uni.showToast({\n            title: '网络异常，请稍后重试',\n            icon: 'none'\n          })\n        } finally {\n          uni.hideLoading()\n        }\n          }\n        }\n      })\n}\n\n// 显示二维码按钮的点击处理函数\nconst showQRCode = async () => {\n  try {\n    // 确保applyInfo存在\n    if (!applyInfo.value) {\n        uni.showToast({\n        title: '报名信息不存在',\n          icon: 'none'\n        })\n        return\n      }\n\t  if(applyInfo.value.checkInStatus === 1) {\n\t\t  uni.showToast({\n\t\t  title: '已签到',\n\t\t    icon: 'none'\n\t\t  })\n\t\t  return\n\t  }\n\n    // 检查活动是否已开始\n    const currentTime = Date.now()\n    const startTime = Number(activityDetail.value.startTime)\n\n    if (currentTime < startTime) {\n      uni.showToast({\n        title: '活动未开始，未到签到时间',\n        icon: 'none',\n        duration: 2000\n      })\n      return\n    }\n\n\n    // 显示加载中\n    uni.showLoading({ title: '生成签到码中...' })\n    \n    // 调用后端接口生成签到码\n    const res = await proxy.$api.activity.generateCheckInCode({\n      activityId: id.value,\n      applyId: applyInfo.value.id,\n      expireMinutes: 1  // 1分钟有效期\n    })\n    \n    if (res.code === 200 && res.data) {\n      // 更新签到码信息\n      if (res.data.checkInCode) {\n        applyInfo.value.checkInCode = res.data.checkInCode\n      }\n      \n      if (res.data.qrCodeUrl) {\n        applyInfo.value.qrCodeUrl = res.data.qrCodeUrl\n      } else {\n        uni.showToast({\n          title: '二维码生成失败',\n          icon: 'none'\n        })\n        return\n      }\n      \n      if (res.data.expireTime) {\n        applyInfo.value.expireTime = res.data.expireTime\n      }\n      \n      // 打开二维码弹窗\n      qrcodePopup.value.open()\n      \n      // 设置定时器，在签到码过期前10秒提醒用户\n      const now = Date.now()\n      const expireTime = res.data.expireTime\n      const timeToExpire = expireTime - now\n      \n      if (timeToExpire > 1000) {  // 如果还有超过10秒过期\n            setTimeout(() => {\n          if (qrcodePopup.value && qrcodePopup.value.isOpen) {  // 确保弹窗对象存在且在打开状态\n            uni.showToast({\n              title: '签到码即将过期，请点击刷新',\n              icon: 'none',\n              duration: 3000\n            })\n          }\n        }, timeToExpire - 5 * 60 * 1000)\n      }\n    } else {\n      uni.showToast({\n        title: res.message || '生成签到码失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('生成签到码错误:', error)\n    uni.showToast({\n      title: '网络异常，请稍后重试',\n      icon: 'none'\n    })\n  } finally {\n              uni.hideLoading()\n  }\n}\n\n// 格式化过期时间\nconst formatExpireTime = (timestamp) => {\n  if (!timestamp) return '未设置'\n  try {\n    const date = new Date(Number(timestamp))\n    return formatDate(date, 'yyyy-MM-dd hh:mm:ss')\n  } catch (error) {\n    console.error('格式化时间错误:', error)\n    return '时间格式错误'\n  }\n}\n\n// 关闭二维码弹窗\nconst closeQRCode = () => {\n  qrcodePopup.value.close()\n}\n\n// 刷新签到码\nconst refreshCheckInCode = async () => {\n  await showQRCode()  // 重新调用showQRCode生成新的签到码\n}\n\n// 显示操作菜单\nconst showActionSheet = () => {\n  actionSheet.value.open()\n}\n\n// 隐藏操作菜单\nconst hideActionSheet = () => {\n  actionSheet.value.close()\n}\n\n// 分享活动\nconst shareActivity = () => {\n              uni.showToast({\n    title: '分享功能开发中',\n    icon: 'none'\n  })\n  hideActionSheet()\n}\n\n// 取消活动\nconst cancelActivity = () => {\n  uni.showModal({\n    title: '取消活动',\n    content: '确定要取消该活动吗？取消后无法恢复，已报名的用户将收到通知。',\n    success: (res) => {\n      if (res.confirm) {\n        activityDetail.value.status = 0\n        uni.showToast({\n          title: '活动已取消',\n                icon: 'success'\n              })\n      }\n    }\n  })\n  hideActionSheet()\n}\n\n// 编辑活动\nconst editActivity = () => {\n  // 在跳转到编辑页面前，先记录当前状态\n  const currentTime = Date.now();\n  \n  // 使用redirectTo而不是navigateTo，避免页面栈堆积\n  uni.redirectTo({\n    url: `/pages/activity/edit?id=${id.value}&clubId=${activityDetail.value.clubId}`\n  });\n};\n\n// 管理报名\nconst manageApplies = () => {\n  uni.navigateTo({\n    url: `/pages/activity/applies?id=${id.value}`\n  });\n};\n\n// 处理多选框变更\nconst onCheckboxChange = (index, e) => {\n  // 确保值是数组，然后转为逗号分隔的字符串\n  const selectedValues = e.detail.value;\n  if (Array.isArray(selectedValues) && selectedValues.length > 0) {\n    formFields.value[index].value = selectedValues.join(',');\n  } else {\n    // 如果没有选择任何项，设置为空字符串\n    formFields.value[index].value = '';\n  }\n  \n  console.log(`选项变更 - 字段: ${formFields.value[index].label}, 值: ${formFields.value[index].value}`);\n}\n\n// 检查选项是否被选中\nconst isOptionChecked = (value, option) => {\n  if (!value) return false;\n  const values = value.split(',');\n  return values.includes(option);\n}\n\n// 获取海报URL（不添加时间戳，保留缓存）\nconst getPosterUrl = (url) => {\n  return getImageUrl(url, '/static/images/default-poster.png', false);\n}\n\n// 处理图片加载错误\nconst handleImageError = (e) => {\n  console.error('二维码图片加载失败:', e)\n  // 启用备用显示方式\n  showBackupQRCode.value = true\n  \n  // 检查二维码URL的有效性\n  if (applyInfo.value && applyInfo.value.qrCodeUrl) {\n    console.log('尝试使用备用方式显示二维码:', applyInfo.value.qrCodeUrl.substring(0, 50) + '...')\n          }\n        }\n\n// 图片加载成功\nconst handleImageLoad = () => {\n  console.log('二维码图片加载成功')\n  // 关闭备用显示方式\n  showBackupQRCode.value = false\n}\n\n// 是否使用备用显示方式\nconst showBackupQRCode = ref(false)\n\n// 检测用户授权相机权限\nconst checkCameraPermission = () => {\n  // #ifdef APP-PLUS || MP-WEIXIN\n  uni.getSetting({\n    success: (res) => {\n      if (!res.authSetting['scope.camera']) {\n        uni.authorize({\n          scope: 'scope.camera',\n          success: () => {\n            console.log('用户已授权相机权限')\n          },\n          fail: () => {\n            uni.showModal({\n              title: '提示',\n              content: '需要相机权限才能扫描二维码，是否前往设置？',\n              success: (res) => {\n                if (res.confirm) {\n                  uni.openSetting()\n                }\n              }\n            })\n          }\n        })\n      }\n    }\n  })\n  // #endif\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.detail-container {\n  position: relative;\n}\n\n.status-bar {\n  width: 100%;\n  background: rgba(255, 255, 255, 0.9);\n}\n\n.nav-header {\n  background: rgba(255, 255, 255, 0.9);\n  padding: 0 30rpx;\n  height: 90rpx;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n}\n\n.back-btn, .more-btn {\n  width: 70rpx;\n  height: 70rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.nav-title {\n  font-size: 34rpx;\n  font-weight: bold;\n  color: #333;\n  flex: 1;\n  text-align: center;\n}\n\n.detail-content {\n  height: calc(100vh - 180rpx);\n}\n\n.poster-container {\n  position: relative;\n  width: 100%;\n  height: 420rpx;\n}\n\n.activity-poster {\n  width: 100%;\n  height: 100%;\n}\n\n.poster-overlay {\n  position: absolute;\n  top: 30rpx;\n  right: 30rpx;\n}\n\n.status-tag {\n  padding: 8rpx 20rpx;\n  border-radius: 8rpx;\n  font-size: 24rpx;\n  color: #fff;\n  background: rgba(0, 0, 0, 0.6);\n}\n\n.status-tag.planned {\n  background: rgba(255, 152, 0, 0.9);\n}\n\n.status-tag.ongoing {\n  background: rgba(41, 121, 255, 0.9);\n}\n\n.status-tag.ended {\n  background: rgba(153, 153, 153, 0.9);\n}\n\n.status-tag.cancelled {\n  background: rgba(244, 67, 54, 0.9);\n}\n\n.activity-title {\n  padding: 30rpx;\n  background: #fff;\n  margin-bottom: 20rpx;\n}\n\n.activity-title text {\n  font-size: 36rpx;\n  font-weight: bold;\n  color: #333;\n  line-height: 1.4;\n}\n\n.info-section {\n  padding: 30rpx;\n  background: #fff;\n  margin-bottom: 20rpx;\n}\n\n.info-item {\n  display: flex;\n  align-items: center;\n  margin-bottom: 20rpx;\n}\n\n.info-item:last-child {\n  margin-bottom: 0;\n}\n\n.info-item text {\n  font-size: 28rpx;\n  color: #666;\n  margin-left: 16rpx;\n}\n\n.club-card {\n  margin: 0 20rpx 20rpx;\n  padding: 24rpx;\n  background: #fff;\n  border-radius: 16rpx;\n  display: flex;\n  align-items: center;\n}\n\n.club-logo {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 40rpx;\n  margin-right: 20rpx;\n  flex-shrink: 0;\n}\n\n.club-info {\n  flex: 1;\n  overflow: hidden;\n}\n\n.club-name {\n  font-size: 30rpx;\n  font-weight: 500;\n  color: #333;\n  margin-bottom: 6rpx;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.club-desc {\n  font-size: 24rpx;\n  color: #999;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  word-break: break-all;\n  line-height: 1.3;\n}\n\n.detail-section, .applied-section {\n  margin: 0 20rpx 20rpx;\n  padding: 24rpx;\n  background: #fff;\n  border-radius: 16rpx;\n}\n\n.section-title {\n  font-size: 32rpx;\n    font-weight: 500;\n    color: #333;\n    margin-bottom: 20rpx;\n    padding-bottom: 16rpx;\n    border-bottom: 1rpx solid #f0f0f0;\n  }\n  \n  .form-content {\n    margin-top: 30rpx;\n  }\n  \n  .form-item {\n    margin-bottom: 30rpx;\n  }\n  \n  .form-label {\n    display: block;\n    font-size: 28rpx;\n    color: #333;\n    margin-bottom: 16rpx;\n  }\n  \n  .form-input {\n    width: 100%;\n    height: 80rpx;\n    padding: 0 20rpx;\n    background: #f8f8f8;\n    border-radius: 8rpx;\n    font-size: 28rpx;\n    box-sizing: border-box;\n  }\n  \n  .form-textarea {\n    width: 100%;\n    height: 180rpx;\n    padding: 20rpx;\n    background: #f8f8f8;\n    border-radius: 8rpx;\n    font-size: 28rpx;\n    box-sizing: border-box;\n  }\n  \n  .form-picker {\n    width: 100%;\n    height: 80rpx;\n    line-height: 80rpx;\n    padding: 0 20rpx;\n    background: #f8f8f8;\n    border-radius: 8rpx;\n    font-size: 28rpx;\n    box-sizing: border-box;\n  }\n  \n  .empty-form {\n    text-align: center;\n    padding: 40rpx 0;\n  }\n  \n  .empty-form text {\n    font-size: 28rpx;\n    color: #999;\n  }\n  \n  .apply-status {\n    padding: 16rpx 30rpx;\n    border-radius: 8rpx;\n    font-size: 30rpx;\n    text-align: center;\n    margin-bottom: 20rpx;\n  }\n  \n  .apply-status.pending {\n    color: #ff9800;\n    background: #fff9e6;\n  }\n  \n  .apply-status.approved {\n    color: #4caf50;\n    background: #e8f5e9;\n  }\n  \n  .apply-status.rejected {\n    color: #f44336;\n    background: #ffebee;\n  }\n  \n  .check-in-tip {\n    display: flex;\n    align-items: center;\n    padding: 16rpx;\n    background: #fff9e6;\n    border-radius: 8rpx;\n    margin-bottom: 20rpx;\n  }\n  \n  .check-in-tip text {\n    font-size: 26rpx;\n    color: #ff9800;\n    margin-left: 10rpx;\n  }\n  \n  .feedback-info {\n    padding: 16rpx;\n    background: #f5f5f5;\n    border-radius: 8rpx;\n    margin-bottom: 20rpx;\n  }\n  \n  .feedback-title {\n    font-size: 26rpx;\n    color: #666;\n    margin-bottom: 10rpx;\n  }\n  \n  .feedback-content {\n    font-size: 28rpx;\n    color: #333;\n    line-height: 1.5;\n  }\n  \n  .action-bar {\n    display: flex;\n    align-items: center;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    background: #fff;\n    padding: 20rpx 30rpx;\n    box-sizing: border-box;\n    box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n    z-index: 100;\n  }\n  \n  .admin-actions, .user-actions {\n    display: flex;\n    flex: 1;\n    width: 100%; /* 确保占据整个宽度 */\n  \n    button {\n    flex: 1;\n    height: 80rpx;\n    line-height: 80rpx;\n    text-align: center;\n    border-radius: 40rpx;\n    margin: 0 10rpx;\n    font-size: 28rpx;\n    }\n  }\n  \n  .edit-btn {\n    background: #f0f0f0;\n    color: #666;\n  }\n  \n  .manage-btn, .apply-btn {\n    background: #2979ff;\n    color: #fff;\n  }\n  \n  .checkin-btn {\n    background: #4caf50;\n    color: #fff;\n  }\n  \n  .cancel-btn {\n    background: #ff9800;\n    color: #fff;\n  }\n  \n  .disabled-btn {\n    background: #f5f5f5;\n    color: #999;\n  }\n  \n  /* 操作菜单样式 */\n  .action-sheet-content {\n    background: #fff;\n    border-radius: 20rpx 20rpx 0 0;\n    padding-bottom: env(safe-area-inset-bottom);\n  }\n  \n  .action-item {\n    height: 110rpx;\n    line-height: 110rpx;\n    text-align: center;\n    font-size: 30rpx;\n    color: #333;\n    border-bottom: 1rpx solid #f5f5f5;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  \n  .action-item text {\n    margin-left: 10rpx;\n  }\n  \n  .action-item.cancel {\n    color: #999;\n    margin-top: 16rpx;\n    border-top: 16rpx solid #f5f5f5;\n    border-bottom: none;\n  }\n  \n  /* 报名弹窗样式 */\n  .apply-popup-content {\n    background: #fff;\n    border-radius: 20rpx 20rpx 0 0;\n    height: 80vh;\n    display: flex;\n    flex-direction: column;\n  }\n  \n  .popup-header {\n    padding: 30rpx;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1rpx solid #f0f0f0;\n  }\n  \n  .popup-title {\n    font-size: 32rpx;\n    font-weight: 500;\n    color: #333;\n  }\n  \n  .close-btn {\n    padding: 10rpx;\n  }\n  \n  .popup-content {\n    flex: 1;\n    padding: 30rpx;\n    overflow-y: auto;\n  }\n  \n  .popup-footer {\n    padding: 20rpx 30rpx;\n    border-top: 1rpx solid #f0f0f0;\n    box-sizing: border-box;\n  }\n  \n  .footer-buttons {\n    display: flex;\n    width: 100%;\n  }\n  \n  .footer-buttons button {\n    flex: 1;\n    height: 80rpx;\n    line-height: 80rpx;\n    text-align: center;\n    border-radius: 40rpx;\n    margin: 0 10rpx;\n    font-size: 28rpx;\n  }\n  \n  .footer-buttons .cancel-btn {\n    background: #f5f5f5;\n    color: #666;\n  }\n  \n  .footer-buttons .confirm-btn {\n    background: #b13b7a;\n    color: #fff;\n  }\n  \n  /* 已报名信息样式 */\n  .apply-info {\n    margin-top: 20rpx;\n    padding: 16rpx;\n    background: #f5f5f5;\n    border-radius: 8rpx;\n  }\n  \n  .info-title {\n    font-size: 26rpx;\n    color: #666;\n    margin-bottom: 16rpx;\n    font-weight: 500;\n  }\n  \n  .apply-info .info-item {\n    margin-bottom: 12rpx;\n    display: flex;\n    align-items: flex-start;\n  }\n  \n  .info-label {\n    font-size: 26rpx;\n    color: #666;\n    min-width: 140rpx;\n    flex-shrink: 0;\n  }\n  \n  .info-value {\n    font-size: 26rpx;\n    color: #333;\n    flex: 1;\n    word-break: break-all;\n    line-height: 1.4;\n  }\n  \n  /* 新增样式 */\n  .action-bar {\n    display: flex;\n    align-items: center;\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n    background: #fff;\n    padding: 20rpx 30rpx;\n    box-sizing: border-box;\n    box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n    z-index: 100;\n    \n    .admin-actions, .user-actions {\n      display: flex;\n      flex: 1;\n      \n      button {\n        flex: 1;\n        height: 80rpx;\n        line-height: 80rpx;\n        text-align: center;\n        border-radius: 40rpx;\n        margin: 0 10rpx;\n        font-size: 28rpx;\n      }\n    }\n    \n    .manage-btn, .apply-btn {\n      background: #b13b7a;\n      color: #fff;\n    }\n  }\n  \n  .check-in-section {\n    margin-top: 20rpx;\n    \n    .qrcode-btn {\n      width: 100%;\n      height: 80rpx;\n      line-height: 80rpx;\n      text-align: center;\n      background: #b13b7a;\n      color: #fff;\n      font-size: 28rpx;\n      border-radius: 40rpx;\n      margin-bottom: 20rpx;\n    }\n  }\n  \n  /* 二维码弹窗样式 */\n  .qrcode-popup {\n    background: #fff;\n    border-radius: 16rpx;\n    width: 600rpx;\n    padding: 30rpx;\n    position: relative;\n    overflow: hidden;\n    \n    .popup-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding-bottom: 20rpx;\n      border-bottom: 1px solid #f5f5f5;\n      margin-bottom: 30rpx;\n      \n      .popup-title {\n        font-size: 32rpx;\n        font-weight: 600;\n        color: #333;\n      }\n      \n      .close-btn {\n        padding: 10rpx;\n      }\n    }\n    \n    .qrcode-content {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      padding: 20rpx 0;\n      \n      .qrcode-img {\n        width: 400rpx;\n        height: 400rpx;\n        margin-bottom: 30rpx;\n        border: 1px solid #eee;\n        box-shadow: 0 4rpx 16rpx rgba(0,0,0,0.1);\n        padding: 10rpx;\n        background-color: #fff;\n      }\n      \n      .qrcode-tips {\n        font-size: 28rpx;\n        color: #666;\n        margin-bottom: 20rpx;\n        text-align: center;\n      }\n      \n      .qrcode-name {\n        font-size: 32rpx;\n        font-weight: bold;\n        color: #333;\n        margin-bottom: 10rpx;\n      }\n      \n      .qrcode-activity {\n        font-size: 28rpx;\n        color: #666;\n        margin-bottom: 20rpx;\n        text-align: center;\n      }\n      \n      .qrcode-status {\n        padding: 8rpx 30rpx;\n        border-radius: 30rpx;\n        background: #f8f8f8;\n        color: #ff8400;\n        font-size: 28rpx;\n        margin-bottom: 20rpx;\n        \n        &.checked-in {\n          background: #e6f7ec;\n          color: #07c160;\n        }\n      }\n    \n      .qrcode-expire-time {\n        font-size: 24rpx;\n        color: #999;\n        margin-bottom: 30rpx;\n      }\n    \n      .qrcode-refresh-btn {\n        padding: 10rpx 30rpx;\n        background: #f0f0f0;\n        color: #333;\n        font-size: 28rpx;\n        border-radius: 30rpx;\n        border: none;\n        \n        &:active {\n          background: #e0e0e0;\n        }\n      }\n    }\n  }\n\n  /* 备用二维码显示方式 */\n  .backup-qrcode {\n    background-position: center;\n    background-repeat: no-repeat;\n    background-size: contain;\n  }\n\n  .checkbox-group {\n    display: flex;\n    flex-direction: column;\n    background: #f8f8f8;\n    border-radius: 8rpx;\n    padding: 10rpx 20rpx;\n  }\n\n  .checkbox-item {\n    display: flex;\n    align-items: center;\n    margin: 10rpx 0;\n  }\n\n  .checkbox-label {\n    font-size: 28rpx;\n    margin-left: 10rpx;\n  }\n\n  /* 添加边缘滑动区域样式 */\n  .edge-swipe-area {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 30rpx; /* 与edgeWidth对应 */\n    height: 100%;\n    z-index: 999;\n    /* 不设置背景色，保持透明 */\n  }\n\n  .qrcode-img {\n    width: 400rpx;\n    height: 400rpx;\n    margin-bottom: 20rpx;\n    background: #f5f5f5;\n  }\n\n  .backup-qrcode {\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n  }\n  </style>","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/activity/activityDeatil.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","onMounted","uni","onBeforeUnmount","wsClient","nextTick","apiModule","parseFormFields","parseFormData","getActualStatus","formatDate","notifyActivityDataChanged","checkUserInfoComplete","fillUserInfoToForm","validateFormData","buildFormData","getImageUrl"],"mappings":"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"}