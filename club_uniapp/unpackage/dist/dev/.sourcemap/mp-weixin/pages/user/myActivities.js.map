{"version":3,"file":"myActivities.js","sources":["pages/user/myActivities.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9teUFjdGl2aXRpZXMudnVl"],"sourcesContent":["<template>\n  <view class=\"my-activities\">\n    <custom-nav-bar title=\"我的活动\" :showBack=\"true\" @backClick=\"goBack\" />\n    <scroll-view\n      scroll-y\n      class=\"activity-list\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"refreshActivities\"\n      @scrolltolower=\"loadMore\"\n      :show-scrollbar=\"false\"\n      enhanced\n    >\n      <view class=\"list-container\">\n        <view\n          v-for=\"(act, idx) in activityList\"\n          :key=\"idx\"\n          class=\"activity-card\"\n          @tap=\"goToDetail(act)\"\n        >\n          <image\n            class=\"activity-cover\"\n            :src=\"act.poster || '/static/images/default-activity.png'\"\n            mode=\"aspectFill\"\n          />\n          <view class=\"activity-info\">\n            <view class=\"activity-title\">{{ act.title || '活动标题加载中...' }}</view>\n            <view class=\"activity-meta\">\n              <view class=\"meta-item\" v-if=\"act.startTime\">\n                <uni-icons type=\"calendar\" size=\"14\" color=\"#999\" />\n                <text class=\"meta-text\">{{ formatTime(act.startTime) }}</text>\n              </view>\n              <view class=\"meta-item\" v-if=\"act.address\">\n                <uni-icons type=\"location\" size=\"14\" color=\"#999\" />\n                <text class=\"meta-text\">{{ act.address }}</text>\n              </view>\n            </view>\n            <view class=\"status-tags\">\n              <text :class=\"['status-tag', getApplyStatusClass(act.status)]\">\n                {{ getApplyStatusText(act.status) }}\n              </text>\n              <text :class=\"['status-tag', getCheckInStatusClass(act.checkInStatus)]\">\n                {{ getCheckInStatusText(act.checkInStatus) }}\n              </text>\n              <text :class=\"['status-tag', getActivityStatusClass(act.activityStatus)]\" v-if=\"act.activityStatus !== undefined\">\n                {{ getActivityStatusText(act.activityStatus) }}\n              </text>\n            </view>\n          </view>\n        </view>\n        <view v-if=\"isLoading\" class=\"loading-more\">\n          <uni-icons type=\"spinner-cycle\" size=\"20\" color=\"#999\" />\n          <text>加载中...</text>\n        </view>\n        <view v-if=\"activityList.length === 0 && !isLoading\" class=\"empty-data\">\n          <uni-icons type=\"inbox\" size=\"80\" color=\"#ddd\" />\n          <text class=\"empty-text\">暂无活动记录</text>\n          <text class=\"empty-hint\">快去参加活动吧~</text>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getCurrentInstance } from 'vue'\n\nconst { proxy } = getCurrentInstance()\n\nconst activityList = ref([])\nconst page = ref(1)\nconst pageSize = ref(10)\nconst hasMore = ref(true)\nconst isLoading = ref(false)\nconst refreshing = ref(false)\n\n// 格式化时间\nconst formatTime = (timestamp) => {\n  if (!timestamp) return '';\n  // 判断时间戳是秒级还是毫秒级（秒级小于10000000000）\n  const ts = timestamp < 10000000000 ? timestamp * 1000 : timestamp;\n  const date = new Date(ts);\n\n  // 验证日期是否有效\n  if (isNaN(date.getTime())) {\n    console.warn('[时间格式化] 无效的时间戳:', timestamp);\n    return '';\n  }\n\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  const hours = String(date.getHours()).padStart(2, '0');\n  const minutes = String(date.getMinutes()).padStart(2, '0');\n  return `${month}-${day} ${hours}:${minutes}`;\n};\n\n// 加载当前用户报名的活动列表\nconst loadActivities = async () => {\n  if (isLoading.value) return;\n  isLoading.value = true;\n  try {\n    console.log('[我的活动] 开始加载活动列表...');\n    const res = await proxy.$api.activity.getMyActivities();\n    console.log('[我的活动] API响应:', res);\n\n    if (res.code === 200) {\n      const applies = res.data || [];\n      console.log('[我的活动] 获取到报名记录数:', applies.length);\n\n      // 并行获取活动详情，但确保即使失败也能显示基本信息\n      const enriched = await Promise.all(\n        applies.map(async (apply) => {\n          try {\n            const detailRes = await proxy.$api.activity.getActivityDetail(apply.activityId);\n            if (detailRes.code === 200) {\n              const detail = detailRes.data;\n              // 合并报名信息和活动详情\n              return {\n                ...apply,\n                poster: detail.poster,\n                title: detail.title,\n                description: detail.description,\n                startTime: detail.startTime,\n                endTime: detail.endTime,\n                address: detail.address,\n                activityStatus: detail.status, // 活动状态（0=取消 1=计划中 2=进行中 3=已结束）\n              };\n            } else {\n              console.warn(`[我的活动] 获取活动详情失败 activityId=${apply.activityId}`, detailRes);\n              return apply; // 即使详情加载失败，也返回报名信息\n            }\n          } catch (err) {\n            console.error(`[我的活动] 获取活动详情异常 activityId=${apply.activityId}`, err);\n            return apply; // 即使详情加载失败，也返回报名信息\n          }\n        })\n      );\n\n      activityList.value = enriched;\n      console.log('[我的活动] 最终活动列表:', enriched);\n    } else {\n      console.error('[我的活动] API返回错误码:', res.code, res.msg);\n      uni.showToast({\n        title: res.msg || '加载失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('[我的活动] 加载活动列表异常:', error);\n    uni.showToast({\n      title: '网络错误，请重试',\n      icon: 'none'\n    });\n  } finally {\n    isLoading.value = false;\n    refreshing.value = false;\n  }\n};\n\n// 获取报名状态文本\nconst getApplyStatusText = (status) => {\n  switch (status) {\n    case 0: return '待审核';\n    case 1: return '已通过';\n    case 2: return '已拒绝';\n    default: return '未知';\n  }\n};\n\n// 获取报名状态样式类\nconst getApplyStatusClass = (status) => {\n  switch (status) {\n    case 0: return 'status-pending';\n    case 1: return 'status-approved';\n    case 2: return 'status-rejected';\n    default: return 'status-unknown';\n  }\n};\n\n// 获取签到状态文本\nconst getCheckInStatusText = (status) => {\n  switch (status) {\n    case 0: return '未签到';\n    case 1: return '已签到';\n    default: return '未知';\n  }\n};\n\n// 获取签到状态样式类\nconst getCheckInStatusClass = (status) => {\n  switch (status) {\n    case 0: return 'status-not-checked';\n    case 1: return 'status-checked';\n    default: return 'status-unknown';\n  }\n};\n\n// 获取活动状态文本\nconst getActivityStatusText = (status) => {\n  switch (status) {\n    case 0: return '已取消';\n    case 1: return '计划中';\n    case 2: return '进行中';\n    case 3: return '已结束';\n    default: return '';\n  }\n};\n\n// 获取活动状态样式类\nconst getActivityStatusClass = (status) => {\n  switch (status) {\n    case 0: return 'status-cancelled';\n    case 1: return 'status-planned';\n    case 2: return 'status-ongoing';\n    case 3: return 'status-finished';\n    default: return 'status-unknown';\n  }\n};\n\nconst refreshActivities = () => {\n  refreshing.value = true\n  page.value = 1\n  loadActivities()\n}\n\nconst loadMore = () => {\n  if (hasMore.value && !isLoading.value) loadActivities()\n}\n\nconst goBack = () => {\n  uni.navigateBack()\n}\n\nconst goToDetail = (act) => {\n  uni.navigateTo({ url: `/pages/activity/activityDeatil?id=${act.activityId}` })\n}\n\nonMounted(() => {\n  loadActivities()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.my-activities {\n  height: 100vh;\n  background: #f5f5f5;\n}\n\n.activity-list {\n  height: calc(100vh - 88rpx);\n}\n\n.list-container {\n  padding: 20rpx;\n}\n\n.activity-card {\n  display: flex;\n  padding: 24rpx;\n  margin-bottom: 20rpx;\n  border-radius: 16rpx;\n  background: #fff;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.06);\n  transition: all 0.3s ease;\n\n  &:active {\n    transform: scale(0.98);\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n  }\n}\n\n.activity-cover {\n  width: 160rpx;\n  height: 160rpx;\n  border-radius: 12rpx;\n  margin-right: 24rpx;\n  background: #f0f0f0;\n  flex-shrink: 0;\n}\n\n.activity-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-between;\n  min-width: 0; // 防止flex子元素溢出\n}\n\n.activity-title {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #333;\n  line-height: 44rpx;\n  margin-bottom: 12rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.activity-meta {\n  display: flex;\n  flex-direction: column;\n  gap: 8rpx;\n  margin-bottom: 12rpx;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 6rpx;\n}\n\n.meta-text {\n  font-size: 24rpx;\n  color: #999;\n  line-height: 32rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.status-tags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 12rpx;\n}\n\n.status-tag {\n  padding: 6rpx 16rpx;\n  border-radius: 24rpx;\n  font-size: 22rpx;\n  font-weight: 500;\n  color: #fff;\n  white-space: nowrap;\n\n  &.status-pending {\n    background: linear-gradient(135deg, #FFA500 0%, #FF8C00 100%);\n  }\n\n  &.status-approved {\n    background: linear-gradient(135deg, #52C41A 0%, #389E0D 100%);\n  }\n\n  &.status-rejected {\n    background: linear-gradient(135deg, #FF4D4F 0%, #CF1322 100%);\n  }\n\n  &.status-not-checked {\n    background: linear-gradient(135deg, #FAAD14 0%, #D48806 100%);\n  }\n\n  &.status-checked {\n    background: linear-gradient(135deg, #1890FF 0%, #096DD9 100%);\n  }\n\n  &.status-cancelled {\n    background: linear-gradient(135deg, #D9D9D9 0%, #8C8C8C 100%);\n  }\n\n  &.status-planned {\n    background: linear-gradient(135deg, #722ED1 0%, #531DAB 100%);\n  }\n\n  &.status-ongoing {\n    background: linear-gradient(135deg, #13C2C2 0%, #08979C 100%);\n  }\n\n  &.status-finished {\n    background: linear-gradient(135deg, #595959 0%, #262626 100%);\n  }\n\n  &.status-unknown {\n    background: #D9D9D9;\n  }\n}\n\n.loading-more {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12rpx;\n  padding: 30rpx;\n  text-align: center;\n  font-size: 28rpx;\n  color: #999;\n}\n\n.empty-data {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 120rpx 60rpx;\n  text-align: center;\n}\n\n.empty-text {\n  font-size: 32rpx;\n  color: #999;\n  margin-top: 24rpx;\n  font-weight: 500;\n}\n\n.empty-hint {\n  font-size: 26rpx;\n  color: #bbb;\n  margin-top: 12rpx;\n}\n</style>","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/user/myActivities.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","uni","onMounted"],"mappings":"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"}