{"version":3,"file":"myClubs.js","sources":["pages/user/myClubs.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9teUNsdWJzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"my-clubs\">\n    <custom-nav-bar title=\"我的社团\" :showBack=\"true\" @backClick=\"goBack\" />\n    <scroll-view\n      scroll-y\n      class=\"club-list\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"refreshClubs\"\n      @scrolltolower=\"loadMore\"\n      :show-scrollbar=\"false\"\n      enhanced\n    >\n      <view class=\"list-container\">\n        <view\n          v-for=\"(club, idx) in clubList\"\n          :key=\"idx\"\n          class=\"club-card\"\n          @tap=\"goToDetail(club)\"\n        >\n          <image\n            class=\"club-logo\"\n            :src=\"club.logo || '/static/images/default-club.png'\"\n            mode=\"aspectFill\"\n          />\n          <view class=\"club-info\">\n            <view class=\"club-name\">{{ club.name }}</view>\n            <text class=\"member-status\">{{ getMemberStatusText(club.memberStatus) }}</text>\n          </view>\n        </view>\n        <view v-if=\"isLoading\" class=\"loading-more\">\n          <uni-icons type=\"spinner-cycle\" size=\"20\" color=\"#999\" />\n          <text>加载中...</text>\n        </view>\n        <view v-if=\"clubList.length === 0 && !isLoading\" class=\"empty-data\">\n          <text>暂无社团</text>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getCurrentInstance } from 'vue'\n\nconst { proxy } = getCurrentInstance()\n\nconst clubList = ref([])\nconst page = ref(1)\nconst pageSize = ref(9999)  // 临时调整为大分页，拉取所有社团以展示所有已加入社团\nconst hasMore = ref(true)\nconst isLoading = ref(false)\nconst refreshing = ref(false)\n\nconst loadClubs = async () => {\n  if (isLoading.value) return;\n  isLoading.value = true;\n  try {\n    const res = await proxy.$api.club.getMyClubs();\n    if (res.code === 200) {\n      let list = res.data || [];\n      // 并行获取每个社团的申请状态\n      list = await Promise.all(\n        list.map(async (c) => {\n          const statusRes = await proxy.$api.club.checkApplyStatus(c.id);\n          c.memberStatus = statusRes.code === 200 && statusRes.data ? statusRes.data.status : 0;\n          return c;\n        })\n      );\n      clubList.value = list;\n    }\n  } catch (error) {\n    console.error('加载我的社团失败', error);\n    clubList.value = [];\n  } finally {\n    isLoading.value = false;\n    refreshing.value = false;\n  }\n};\n\n// 获取会员状态文本\nconst getMemberStatusText = (status) => {\n  switch (status) {\n    case 0: return '未通过';\n    case 1: return '已入社';\n    case 2: return '退社申请中';\n    default: return '未知';\n  }\n};\n\nconst refreshClubs = () => {\n  refreshing.value = true\n  page.value = 1\n  loadClubs()\n}\n\nconst loadMore = () => {\n  if (hasMore.value && !isLoading.value) {\n    loadClubs()\n  }\n}\n\nconst goBack = () => {\n  uni.navigateBack()\n}\n\nconst goToDetail = (club) => {\n  uni.navigateTo({ url: `/pages/club/detail?id=${club.id}` })\n}\n\nonMounted(() => {\n  loadClubs()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.club-card {\n  display: flex;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n  border-radius: 12rpx;\r\n  background: #fff;\n}\n.club-logo {\n  width: 80rpx;\n  height: 80rpx;\n  border-radius: 40rpx;\n  margin-right: 20rpx;\n  background: #fff;\t\n}\n.club-name {\n  font-size: 30rpx;\n  color: #333;\n  line-height: 80rpx;\n}\n.member-status, .status-tag {\n  display: inline-block;\n  margin-left: 10rpx;\n  padding: 4rpx 10rpx;\n  border-radius: 12rpx;\n  font-size: 24rpx;\n  color: #fff;\n  background: #409EFF;\n}\n.loading-more,\n.empty-data {\n  text-align: center;\n  padding: 30rpx;\n}\n</style>","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/user/myClubs.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","uni","onMounted"],"mappings":";;;;;;;;;;;;;;;AA8CA,UAAM,EAAE,MAAO,IAAGA,iCAAoB;AAEtC,UAAM,WAAWC,cAAG,IAAC,EAAE;AACvB,UAAM,OAAOA,cAAG,IAAC,CAAC;AACDA,kBAAG,IAAC,IAAI;AACzB,UAAM,UAAUA,cAAG,IAAC,IAAI;AACxB,UAAM,YAAYA,cAAG,IAAC,KAAK;AAC3B,UAAM,aAAaA,cAAG,IAAC,KAAK;AAE5B,UAAM,YAAY,YAAY;AAC5B,UAAI,UAAU;AAAO;AACrB,gBAAU,QAAQ;AAClB,UAAI;AACF,cAAM,MAAM,MAAM,MAAM,KAAK,KAAK,WAAU;AAC5C,YAAI,IAAI,SAAS,KAAK;AACpB,cAAI,OAAO,IAAI,QAAQ;AAEvB,iBAAO,MAAM,QAAQ;AAAA,YACnB,KAAK,IAAI,OAAO,MAAM;AACpB,oBAAM,YAAY,MAAM,MAAM,KAAK,KAAK,iBAAiB,EAAE,EAAE;AAC7D,gBAAE,eAAe,UAAU,SAAS,OAAO,UAAU,OAAO,UAAU,KAAK,SAAS;AACpF,qBAAO;AAAA,YACjB,CAAS;AAAA,UACT;AACM,mBAAS,QAAQ;AAAA,QAClB;AAAA,MACF,SAAQ,OAAO;AACdC,sBAAA,MAAA,MAAA,SAAA,gCAAc,YAAY,KAAK;AAC/B,iBAAS,QAAQ;MACrB,UAAY;AACR,kBAAU,QAAQ;AAClB,mBAAW,QAAQ;AAAA,MACpB;AAAA,IACH;AAGA,UAAM,sBAAsB,CAAC,WAAW;AACtC,cAAQ,QAAM;AAAA,QACZ,KAAK;AAAG,iBAAO;AAAA,QACf,KAAK;AAAG,iBAAO;AAAA,QACf,KAAK;AAAG,iBAAO;AAAA,QACf;AAAS,iBAAO;AAAA,MACjB;AAAA,IACH;AAEA,UAAM,eAAe,MAAM;AACzB,iBAAW,QAAQ;AACnB,WAAK,QAAQ;AACb,gBAAW;AAAA,IACb;AAEA,UAAM,WAAW,MAAM;AACrB,UAAI,QAAQ,SAAS,CAAC,UAAU,OAAO;AACrC,kBAAW;AAAA,MACZ;AAAA,IACH;AAEA,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,aAAc;AAAA,IACpB;AAEA,UAAM,aAAa,CAAC,SAAS;AAC3BA,0BAAI,WAAW,EAAE,KAAK,yBAAyB,KAAK,EAAE,IAAI;AAAA,IAC5D;AAEAC,kBAAAA,UAAU,MAAM;AACd,gBAAW;AAAA,IACb,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChHD,GAAG,WAAW,eAAe;"}