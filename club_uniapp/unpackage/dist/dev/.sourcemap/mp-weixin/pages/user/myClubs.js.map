{"version":3,"file":"myClubs.js","sources":["pages/user/myClubs.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvdXNlci9teUNsdWJzLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"my-clubs\">\n    <custom-nav-bar title=\"我的社团\" :showBack=\"true\" @backClick=\"goBack\" />\n    <scroll-view\n      scroll-y\n      class=\"club-list\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"refreshClubs\"\n      @scrolltolower=\"loadMore\"\n      :show-scrollbar=\"false\"\n      enhanced\n    >\n      <view class=\"list-container\">\n        <view\n          v-for=\"(club, idx) in clubList\"\n          :key=\"idx\"\n          class=\"club-card\"\n          @tap=\"goToDetail(club)\"\n        >\n          <image\n            class=\"club-logo\"\n            :src=\"club.logo || '/static/images/default-club.png'\"\n            mode=\"aspectFill\"\n          />\n          <view class=\"club-info\">\n            <view class=\"club-name\">{{ club.name }}</view>\n            <view class=\"club-desc\" v-if=\"club.description\">{{ club.description }}</view>\n            <view class=\"club-meta\">\n              <view class=\"meta-item\" v-if=\"club.memberCount !== undefined\">\n                <uni-icons type=\"person\" size=\"14\" color=\"#999\" />\n                <text class=\"meta-text\">{{ club.memberCount }}人</text>\n              </view>\n              <view class=\"meta-item\" v-if=\"club.category\">\n                <uni-icons type=\"flag\" size=\"14\" color=\"#999\" />\n                <text class=\"meta-text\">{{ club.category }}</text>\n              </view>\n            </view>\n          </view>\n          <view class=\"club-status\">\n            <text :class=\"['status-badge', getMemberStatusClass(club.memberStatus)]\">\n              {{ getMemberStatusText(club.memberStatus) }}\n            </text>\n          </view>\n        </view>\n        <view v-if=\"isLoading\" class=\"loading-more\">\n          <uni-icons type=\"spinner-cycle\" size=\"20\" color=\"#999\" />\n          <text>加载中...</text>\n        </view>\n        <view v-if=\"clubList.length === 0 && !isLoading\" class=\"empty-data\">\n          <uni-icons type=\"home\" size=\"80\" color=\"#ddd\" />\n          <text class=\"empty-text\">暂未加入社团</text>\n          <text class=\"empty-hint\">快去发现感兴趣的社团吧~</text>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { getCurrentInstance } from 'vue'\n\nconst { proxy } = getCurrentInstance()\n\nconst clubList = ref([])\nconst page = ref(1)\nconst pageSize = ref(9999)  // 临时调整为大分页，拉取所有社团以展示所有已加入社团\nconst hasMore = ref(true)\nconst isLoading = ref(false)\nconst refreshing = ref(false)\n\nconst loadClubs = async () => {\n  if (isLoading.value) return;\n  isLoading.value = true;\n  try {\n    console.log('[我的社团] 开始加载社团列表...');\n    const res = await proxy.$api.club.getMyClubs();\n    console.log('[我的社团] API响应:', res);\n\n    if (res.code === 200) {\n      let list = res.data || [];\n      console.log('[我的社团] 获取到社团数:', list.length);\n\n      // 并行获取每个社团的申请状态\n      list = await Promise.all(\n        list.map(async (c) => {\n          try {\n            const statusRes = await proxy.$api.club.checkApplyStatus(c.id);\n            c.memberStatus = statusRes.code === 200 && statusRes.data ? statusRes.data.status : 0;\n            return c;\n          } catch (err) {\n            console.warn(`[我的社团] 获取社团状态失败 clubId=${c.id}`, err);\n            c.memberStatus = 0;\n            return c;\n          }\n        })\n      );\n\n      clubList.value = list;\n      console.log('[我的社团] 最终社团列表:', list);\n    } else {\n      console.error('[我的社团] API返回错误码:', res.code, res.msg);\n      uni.showToast({\n        title: res.msg || '加载失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('[我的社团] 加载社团列表异常:', error);\n    clubList.value = [];\n    uni.showToast({\n      title: '网络错误，请重试',\n      icon: 'none'\n    });\n  } finally {\n    isLoading.value = false;\n    refreshing.value = false;\n  }\n};\n\n// 获取会员状态文本\nconst getMemberStatusText = (status) => {\n  switch (status) {\n    case 0: return '未通过';\n    case 1: return '已入社';\n    case 2: return '退社申请中';\n    default: return '未知';\n  }\n};\n\n// 获取会员状态样式类\nconst getMemberStatusClass = (status) => {\n  switch (status) {\n    case 0: return 'status-rejected';\n    case 1: return 'status-active';\n    case 2: return 'status-pending';\n    default: return 'status-unknown';\n  }\n};\n\nconst refreshClubs = () => {\n  refreshing.value = true\n  page.value = 1\n  loadClubs()\n}\n\nconst loadMore = () => {\n  if (hasMore.value && !isLoading.value) {\n    loadClubs()\n  }\n}\n\nconst goBack = () => {\n  uni.navigateBack()\n}\n\nconst goToDetail = (club) => {\n  uni.navigateTo({ url: `/pages/club/detail?id=${club.id}` })\n}\n\nonMounted(() => {\n  loadClubs()\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.my-clubs {\n  height: 100vh;\n  background: #f5f5f5;\n}\n\n.club-list {\n  height: calc(100vh - 88rpx);\n}\n\n.list-container {\n  padding: 20rpx;\n}\n\n.club-card {\n  display: flex;\n  align-items: center;\n  padding: 24rpx;\n  margin-bottom: 20rpx;\n  border-radius: 16rpx;\n  background: #fff;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.06);\n  transition: all 0.3s ease;\n  position: relative;\n\n  &:active {\n    transform: scale(0.98);\n    box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);\n  }\n}\n\n.club-logo {\n  width: 120rpx;\n  height: 120rpx;\n  border-radius: 60rpx;\n  margin-right: 24rpx;\n  background: #f0f0f0;\n  flex-shrink: 0;\n  box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.1);\n}\n\n.club-info {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  min-width: 0;\n  padding-right: 20rpx;\n}\n\n.club-name {\n  font-size: 32rpx;\n  font-weight: 600;\n  color: #333;\n  line-height: 44rpx;\n  margin-bottom: 8rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.club-desc {\n  font-size: 24rpx;\n  color: #999;\n  line-height: 36rpx;\n  margin-bottom: 8rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 2;\n  -webkit-box-orient: vertical;\n}\n\n.club-meta {\n  display: flex;\n  gap: 20rpx;\n  margin-top: 4rpx;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 6rpx;\n}\n\n.meta-text {\n  font-size: 22rpx;\n  color: #999;\n  line-height: 28rpx;\n}\n\n.club-status {\n  flex-shrink: 0;\n  display: flex;\n  align-items: center;\n}\n\n.status-badge {\n  padding: 8rpx 20rpx;\n  border-radius: 24rpx;\n  font-size: 24rpx;\n  font-weight: 500;\n  color: #fff;\n  white-space: nowrap;\n\n  &.status-active {\n    background: linear-gradient(135deg, #52C41A 0%, #389E0D 100%);\n  }\n\n  &.status-pending {\n    background: linear-gradient(135deg, #FAAD14 0%, #D48806 100%);\n  }\n\n  &.status-rejected {\n    background: linear-gradient(135deg, #FF4D4F 0%, #CF1322 100%);\n  }\n\n  &.status-unknown {\n    background: linear-gradient(135deg, #D9D9D9 0%, #8C8C8C 100%);\n  }\n}\n\n.loading-more {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 12rpx;\n  padding: 30rpx;\n  text-align: center;\n  font-size: 28rpx;\n  color: #999;\n}\n\n.empty-data {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 120rpx 60rpx;\n  text-align: center;\n}\n\n.empty-text {\n  font-size: 32rpx;\n  color: #999;\n  margin-top: 24rpx;\n  font-weight: 500;\n}\n\n.empty-hint {\n  font-size: 26rpx;\n  color: #bbb;\n  margin-top: 12rpx;\n}\n</style>","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/user/myClubs.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","uni","onMounted"],"mappings":"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"}