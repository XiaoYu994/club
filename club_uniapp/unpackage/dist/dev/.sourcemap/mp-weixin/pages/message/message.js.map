{"version":3,"file":"message.js","sources":["pages/message/message.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9tZXNzYWdlLnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"message-container pageBg\">\n    <!-- 顶部导航栏 -->\n    <custom-nav-bar title=\"群聊\" background=\"#fff\" title-color=\"#333\"></custom-nav-bar>\n\n    <!-- 群聊列表 -->\n    <scroll-view scroll-y class=\"scroll-panel\">\n      <view class=\"chat-list\">\n        <view\n          v-for=\"(chat, idx) in chatGroups\"\n          :key=\"idx\"\n          class=\"chat-item\"\n          @tap=\"enterChatRoom(chat)\"\n        >\n          <image\n            class=\"chat-avatar\"\n            :src=\"chat.avatar || '/static/images/group-default.png'\"\n            mode=\"aspectFill\"\n          ></image>\n          <view class=\"chat-info\">\n            <view class=\"chat-name\">{{ chat.name }}</view>\n            <view class=\"chat-last-msg\">{{ chat.lastMessage || '暂无消息' }}</view>\n          </view>\n          <view class=\"chat-meta\">\n            <view class=\"chat-time\">{{ formatTime(chat.lastTime) }}</view>\n          </view>\n        </view>\n\n        <!-- 空状态 -->\n        <view v-if=\"chatGroups.length === 0\" class=\"empty-data\">\n          <image class=\"empty-image\" src=\"/static/img/empty-chat.png\" mode=\"aspectFit\"></image>\n          <text class=\"empty-text\">暂无聊天会话</text>\n          <text class=\"empty-tip\">加入群组或创建新群组开始聊天</text>\n        </view>\n      </view>\n    </scroll-view>\n\n    <!-- 创建群组按钮 -->\n    <view v-if=\"isAdmin\" class=\"float-btn\" @tap=\"createChatGroup\">\n      <uni-icons type=\"plus\" size=\"24\" color=\"#fff\"></uni-icons>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport { chatAPI } from '@/api/api.js';\nimport { getUser } from '@/utils/auth.js';\n\n// 当前用户信息\nconst userInfo = getUser();\nconst isAdmin = ref(userInfo ? userInfo.isAdmin : false);\n\n// 聊天群组数据\nconst chatGroups = ref([]);\nconst chatLoading = ref(false);\n\n// 加载群组列表\nasync function loadChatGroups() {\n  chatLoading.value = true;\n  try {\n    const response = await chatAPI.getGroups();\n    if (response.code === 200) {\n      chatGroups.value = response.data.map(group => ({\n        id: group.id,\n        name: group.name,\n        avatar: group.avatar || '/static/images/group-default.png',\n        lastMessage: group.lastMessage || '',\n        lastTime: group.lastMessageTime != null ? Number(group.lastMessageTime) : null,\n        unread: group.unreadCount || 0\n      }));\n    } else {\n      uni.showToast({ title: response.msg || '获取群组失败', icon: 'none' });\n    }\n  } catch (error) {\n    console.error('获取聊天群组数据失败:', error);\n  } finally {\n    chatLoading.value = false;\n  }\n}\n\nonMounted(loadChatGroups);\n/**\n * @description 页面展示时重新加载群组列表，确保最新消息显示\n */\nonShow(loadChatGroups);\n\n// 进入聊天室\nconst enterChatRoom = (chat) => {\n  uni.navigateTo({\n    url: `/pages/chat/room?id=${chat.id}&name=${encodeURIComponent(chat.name)}`\n  });\n};\n\n// 创建群组\nconst createChatGroup = () => {\n  uni.navigateTo({ url: '/pages/chat/create' });\n};\n\n// 时间格式化\nfunction formatTime(timestamp) {\n  if (!timestamp) return \"\";\n\n  const date = new Date(timestamp);\n  const now = new Date();\n\n  // 今天\n  if (date.toDateString() === now.toDateString()) {\n    const hours = date.getHours().toString().padStart(2, '0');\n    const minutes = date.getMinutes().toString().padStart(2, '0');\n    return `${hours}:${minutes}`;\n  }\n\n  // 昨天\n  const yesterday = new Date(now);\n  yesterday.setDate(yesterday.getDate() - 1);\n  if (date.toDateString() === yesterday.toDateString()) {\n    return \"昨天\";\n  }\n\n  // 本周\n  const oneWeekAgo = new Date(now);\n  oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n  if (date > oneWeekAgo) {\n    const days = ['周日', '周一', '周二', '周三', '周四', '周五', '周六'];\n    return days[date.getDay()];\n  }\n\n  // 更早\n  return `${date.getMonth() + 1}/${date.getDate()}`;\n}\n</script>\n\n<style lang=\"scss\">\n\n.message-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n\n  .scroll-panel {\n    flex: 1;\n    padding: 20rpx 0;\n  }\n}\n\n.chat-list {\n  padding: 0 30rpx;\n}\n\n.chat-item {\n  display: flex;\n  align-items: center;\n  padding: 25rpx 20rpx;\n  background: #fff;\n  border-radius: 20rpx;\n  margin-bottom: 20rpx;\n  box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.03);\n  transition: all 0.3s ease;\n\n  &:active {\n    transform: scale(0.98);\n    background-color: #f9f9f9;\n  }\n}\n\n.chat-avatar {\n  width: 100rpx;\n  height: 100rpx;\n  border-radius: 16rpx;\n  background-color: #f0f2f5;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.chat-info {\n  flex: 1;\n  margin-left: 25rpx;\n  overflow: hidden;\n}\n\n.chat-name {\n  font-size: 32rpx;\n  color: #333;\n  font-weight: 500;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-last-msg {\n  font-size: 26rpx;\n  color: #999;\n  margin-top: 12rpx;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.chat-meta {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  min-width: 120rpx;\n}\n\n.chat-time {\n  font-size: 24rpx;\n  color: #bbb;\n  margin-bottom: 15rpx;\n}\n\n.unread-badge {\n  background-color: #ff3b30;\n  color: #fff;\n  font-size: 22rpx;\n  min-width: 36rpx;\n  height: 36rpx;\n  line-height: 36rpx;\n  border-radius: 18rpx;\n  text-align: center;\n  padding: 0 8rpx;\n  box-shadow: 0 4rpx 8rpx rgba(255, 59, 48, 0.2);\n}\n\n.empty-data {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 80rpx 0;\n  text-align: center;\n\n  .empty-image {\n    width: 280rpx;\n    height: 280rpx;\n    opacity: 0.8;\n  }\n\n  .empty-text {\n    font-size: 32rpx;\n    color: #999;\n    margin-top: 30rpx;\n    font-weight: 500;\n  }\n\n  .empty-tip {\n    font-size: 26rpx;\n    color: #bbb;\n    margin-top: 15rpx;\n  }\n}\n\n.float-btn {\n  position: fixed;\n  bottom: 60rpx;\n  right: 40rpx;\n  width: 100rpx;\n  height: 100rpx;\n  background: linear-gradient(135deg, #2979ff, #4dabf7);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  box-shadow: 0 8rpx 30rpx rgba(41, 121, 255, 0.4);\n  z-index: 100;\n  transition: all 0.3s;\n\n  &:active {\n    transform: scale(0.95);\n    box-shadow: 0 4rpx 15rpx rgba(41, 121, 255, 0.3);\n  }\n}\n</style>\n","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/message/message.vue'\nwx.createPage(MiniProgramPage)"],"names":["getUser","ref","chatAPI","uni","onMounted","onShow","MiniProgramPage"],"mappings":";;;;;;;;;;;;;;;;;;AAmDA,UAAM,WAAWA,WAAO,QAAA;AACxB,UAAM,UAAUC,cAAG,IAAC,WAAW,SAAS,UAAU,KAAK;AAGvD,UAAM,aAAaA,cAAAA,IAAI,CAAA,CAAE;AACzB,UAAM,cAAcA,cAAAA,IAAI,KAAK;AAG7B,mBAAe,iBAAiB;AAC9B,kBAAY,QAAQ;AACpB,UAAI;AACF,cAAM,WAAW,MAAMC,gBAAQ;AAC/B,YAAI,SAAS,SAAS,KAAK;AACzB,qBAAW,QAAQ,SAAS,KAAK,IAAI,YAAU;AAAA,YAC7C,IAAI,MAAM;AAAA,YACV,MAAM,MAAM;AAAA,YACZ,QAAQ,MAAM,UAAU;AAAA,YACxB,aAAa,MAAM,eAAe;AAAA,YAClC,UAAU,MAAM,mBAAmB,OAAO,OAAO,MAAM,eAAe,IAAI;AAAA,YAC1E,QAAQ,MAAM,eAAe;AAAA,UAC9B,EAAC;AAAA,QACR,OAAW;AACLC,8BAAI,UAAU,EAAE,OAAO,SAAS,OAAO,UAAU,MAAM,OAAM,CAAE;AAAA,QAChE;AAAA,MACF,SAAQ,OAAO;AACdA,sBAAc,MAAA,MAAA,SAAA,mCAAA,eAAe,KAAK;AAAA,MACtC,UAAY;AACR,oBAAY,QAAQ;AAAA,MACrB;AAAA,IACH;AAEAC,kBAAS,UAAC,cAAc;AAIxBC,kBAAM,OAAC,cAAc;AAGrB,UAAM,gBAAgB,CAAC,SAAS;AAC9BF,oBAAAA,MAAI,WAAW;AAAA,QACb,KAAK,uBAAuB,KAAK,EAAE,SAAS,mBAAmB,KAAK,IAAI,CAAC;AAAA,MAC7E,CAAG;AAAA,IACH;AAGA,UAAM,kBAAkB,MAAM;AAC5BA,oBAAAA,MAAI,WAAW,EAAE,KAAK,qBAAsB,CAAA;AAAA,IAC9C;AAGA,aAAS,WAAW,WAAW;AAC7B,UAAI,CAAC;AAAW,eAAO;AAEvB,YAAM,OAAO,IAAI,KAAK,SAAS;AAC/B,YAAM,MAAM,oBAAI;AAGhB,UAAI,KAAK,aAAY,MAAO,IAAI,aAAY,GAAI;AAC9C,cAAM,QAAQ,KAAK,SAAU,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AACxD,cAAM,UAAU,KAAK,WAAY,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG;AAC5D,eAAO,GAAG,KAAK,IAAI,OAAO;AAAA,MAC3B;AAGD,YAAM,YAAY,IAAI,KAAK,GAAG;AAC9B,gBAAU,QAAQ,UAAU,QAAS,IAAG,CAAC;AACzC,UAAI,KAAK,aAAY,MAAO,UAAU,aAAY,GAAI;AACpD,eAAO;AAAA,MACR;AAGD,YAAM,aAAa,IAAI,KAAK,GAAG;AAC/B,iBAAW,QAAQ,WAAW,QAAS,IAAG,CAAC;AAC3C,UAAI,OAAO,YAAY;AACrB,cAAM,OAAO,CAAC,MAAM,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI;AACtD,eAAO,KAAK,KAAK,OAAM,CAAE;AAAA,MAC1B;AAGD,aAAO,GAAG,KAAK,aAAa,CAAC,IAAI,KAAK,QAAS,CAAA;AAAA,IACjD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClIA,GAAG,WAAWG,SAAe;"}