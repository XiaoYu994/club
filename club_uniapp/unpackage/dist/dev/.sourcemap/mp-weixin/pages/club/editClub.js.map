{"version":3,"file":"editClub.js","sources":["pages/club/editClub.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2x1Yi9lZGl0Q2x1Yi52dWU"],"sourcesContent":["<template>\n  <view class=\"edit-club-container pageBg\">\n    <view class=\"status-bar\" :style=\"{ height: statusBarHeight + 'px' }\"></view>\n    <!-- 顶部导航 -->\n    <custom-nav-bar title=\"编辑社团\" :showBack=\"true\" @backClick=\"goBack\"></custom-nav-bar>\n    \n    <!-- 表单区域 -->\n    <view class=\"activity-form\">\n      <scroll-view scroll-y class=\"form-container\">\n        <!-- 基本信息 -->\n        <view class=\"form-section\">\n          <view class=\"section-title\">基本信息</view>\n          <!-- 名称 -->\n          <view class=\"form-item\">\n            <text class=\"form-label\">社团名称</text>\n            <input v-model=\"club.name\" placeholder=\"请输入社团名称\" class=\"form-input\" />\n          </view>\n          <!-- Logo -->\n          <view class=\"form-item\">\n            <text class=\"form-label\">社团Logo</text>\n            <view class=\"poster-upload\" @tap=\"uploadLogo\">\n              <image v-if=\"club.logo\" :src=\"club.logo\" class=\"poster-preview\" mode=\"aspectFill\" />\n              <view v-else class=\"upload-placeholder\">\n                <uni-icons type=\"image\" size=\"50\" color=\"#999\" />\n                <text>点击上传Logo</text>\n              </view>\n            </view>\n          </view>\n          <!-- 简介 -->\n          <view class=\"form-item\">\n            <text class=\"form-label\">社团简介</text>\n            <textarea v-model=\"club.description\" placeholder=\"请输入社团简介\" class=\"form-textarea\" />\n          </view>\n          <!-- 地址 -->\n          <view class=\"form-item\">\n            <text class=\"form-label\">地址</text>\n            <input v-model=\"club.address\" placeholder=\"请输入地址\" class=\"form-input\" />\n          </view>\n          <!-- 联系方式 -->\n          <view class=\"form-item\">\n            <text class=\"form-label\">联系方式</text>\n            <input v-model=\"club.contact\" placeholder=\"请输入联系方式\" class=\"form-input\" />\n          </view>\n        </view>\n      </scroll-view>\n      <!-- 底部操作栏 -->\n      <view class=\"form-actions\">\n        <button class=\"cancel-btn\" @tap=\"goBack\">取消</button>\n        <button class=\"submit-btn\" @tap=\"submit\">保存</button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch, getCurrentInstance } from 'vue'\nimport { nextTick } from 'vue'\nimport { getImageUrl } from '@/utils/common.js'\nconst { proxy } = getCurrentInstance()\n\n// 状态栏高度\nconst statusBarHeight = ref(20)\n// 表单数据\nconst club = ref({ id: '', name: '', logo: '', description: '', type: 0, address: '', contact: '' })\n\n// 类型选项\nconst typeOptions = ['普通社团', '院级社团', '校级社团']\n\n// 初始化：获取传参并加载详情\nonMounted(async () => {\n  statusBarHeight.value = uni.getSystemInfoSync().statusBarHeight || 20\n  const pages = getCurrentPages()\n  const currentPage = pages[pages.length - 1]\n  club.value.id = currentPage.options.id\n\n  // 加载社团详情\n  try {\n    const res = await proxy.$api.club.getClubDetail(club.value.id)\n    if (res.code === 200) {\n      Object.assign(club.value, res.data)\n    } else {\n      uni.showToast({ title: res.message || '加载失败', icon: 'none' })\n    }\n  } catch (e) {\n    uni.showToast({ title: '网络异常', icon: 'none' })\n  }\n})\n\n// 上传 Logo\nconst uploadLogo = () => {\n  uni.chooseImage({ count: 1, sizeType: ['compressed'], sourceType: ['album', 'camera'], success: (res) => {\n    const path = res.tempFilePaths[0]\n    uni.showLoading({ title: '上传中...' })\n    proxy.$api.common.upload(path).then(r => {\n      uni.hideLoading()\n      if (r.code === 200) {\n        // 处理 URL\n        club.value.logo = getImageUrl(r.data.url || r.data, '', false)\n      } else {\n        uni.showToast({ title: r.message || '上传失败', icon: 'none' })\n      }\n    }).catch(() => {\n      uni.hideLoading()\n      uni.showToast({ title: '上传出错', icon: 'none' })\n    })\n  }})\n}\n\n// 类型切换\nconst onTypeChange = (e) => {\n  club.value.type = Number(e.detail.value)\n}\n\n// 提交保存时，将 formFields 转为 JSON\nconst submit = async () => {\n  if (!club.value.name) { uni.showToast({ title: '请输入名称', icon: 'none' }); return }\n  try {\n    uni.showLoading({ title: '保存中...' })\n    // 合并更新数据\n    const updateData = {\n      name: club.value.name,\n      logo: club.value.logo,\n      description: club.value.description,\n      type: club.value.type,\n      address: club.value.address,\n      contact: club.value.contact\n    }\n    const res = await proxy.$api.club.updateClub(club.value.id, updateData)\n    uni.hideLoading()\n    if (res.code === 200) {\n      uni.showToast({ title: '保存成功', icon: 'success' })\n      setTimeout(() => {\n        uni.redirectTo({ url: `/pages/club/detail?id=${club.value.id}` })\n      }, 800)\n    } else {\n      uni.showToast({ title: res.message || '保存失败', icon: 'none' })\n    }\n  } catch (e) {\n    uni.hideLoading()\n    uni.showToast({ title: '网络异常', icon: 'none' })\n  }\n}\n\n// 返回上一页\nconst goBack = () => {\n  uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.edit-club-container {\n    display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n  background-color: #f8f8f8;\n  }\n\n// 表单样式\n.activity-form {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n}\n\n.form-container {\n  flex: 1;\n  padding: 20rpx 30rpx;\n}\n\n.form-section {\n  background-color: #fff;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  margin-bottom: 30rpx;\n}\n\n.section-title {\n  font-size: 32rpx;\n  font-weight: bold;\n  color: #333;\n  margin-bottom: 20rpx;\n}\n\n.form-item {\n  margin-bottom: 30rpx;\n}\n\n.form-label {\n  display: block;\n  font-size: 28rpx;\n  color: #666;\n  margin-bottom: 15rpx;\n}\n\n.form-input {\n  width: 100%;\n  height: 80rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n  padding: 0 20rpx;\n  font-size: 28rpx;\n}\n\n.form-textarea {\n  width: 100%;\n  height: 240rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n  padding: 20rpx;\n  font-size: 28rpx;\n}\n\n.form-actions {\n  display: flex;\n  padding: 20rpx 30rpx;\n  background-color: #fff;\n  box-shadow: 0 -2rpx 10rpx rgba(0,0,0,0.05);\n}\n\n.poster-upload {\n  width: 100%;\n  height: 320rpx;\n  background-color: #f5f5f5;\n  border-radius: 8rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  overflow: hidden;\n}\n\n.poster-preview {\n  width: 100%;\n  height: 100%;\n  object-fit: cover;\n}\n\n.upload-placeholder {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  color: #999;\n  \n  text {\n    margin-top: 20rpx;\n    font-size: 28rpx;\n}\n}\n\n// 按钮样式\n.cancel-btn, .submit-btn {\n  flex: 1;\n  height: 80rpx;\n  border-radius: 40rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 30rpx;\n}\n\n.cancel-btn {\n  background-color: #f0f0f0;\n  color: #666;\n  margin-right: 20rpx;\n}\n\n.submit-btn {\n  background-color: #b13b7a;\n  color: #fff;\n}\n</style>","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/club/editClub.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","onMounted","uni","getImageUrl"],"mappings":";;;;;;;;;;;;;;;;AA0DA,UAAM,EAAE,MAAO,IAAGA,iCAAoB;AAGtC,UAAM,kBAAkBC,cAAG,IAAC,EAAE;AAE9B,UAAM,OAAOA,cAAG,IAAC,EAAE,IAAI,IAAI,MAAM,IAAI,MAAM,IAAI,aAAa,IAAI,MAAM,GAAG,SAAS,IAAI,SAAS,IAAI;AAMnGC,kBAAAA,UAAU,YAAY;AACpB,sBAAgB,QAAQC,cAAAA,MAAI,kBAAmB,EAAC,mBAAmB;AACnE,YAAM,QAAQ,gBAAiB;AAC/B,YAAM,cAAc,MAAM,MAAM,SAAS,CAAC;AAC1C,WAAK,MAAM,KAAK,YAAY,QAAQ;AAGpC,UAAI;AACF,cAAM,MAAM,MAAM,MAAM,KAAK,KAAK,cAAc,KAAK,MAAM,EAAE;AAC7D,YAAI,IAAI,SAAS,KAAK;AACpB,iBAAO,OAAO,KAAK,OAAO,IAAI,IAAI;AAAA,QACxC,OAAW;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAAA,QAC7D;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9C;AAAA,IACH,CAAC;AAGD,UAAM,aAAa,MAAM;AACvBA,oBAAAA,MAAI,YAAY,EAAE,OAAO,GAAG,UAAU,CAAC,YAAY,GAAG,YAAY,CAAC,SAAS,QAAQ,GAAG,SAAS,CAAC,QAAQ;AACvG,cAAM,OAAO,IAAI,cAAc,CAAC;AAChCA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAQ,CAAE;AACnC,cAAM,KAAK,OAAO,OAAO,IAAI,EAAE,KAAK,OAAK;AACvCA,wBAAAA,MAAI,YAAa;AACjB,cAAI,EAAE,SAAS,KAAK;AAElB,iBAAK,MAAM,OAAOC,aAAAA,YAAY,EAAE,KAAK,OAAO,EAAE,MAAM,IAAI,KAAK;AAAA,UACrE,OAAa;AACLD,gCAAI,UAAU,EAAE,OAAO,EAAE,WAAW,QAAQ,MAAM,QAAQ;AAAA,UAC3D;AAAA,QACP,CAAK,EAAE,MAAM,MAAM;AACbA,wBAAAA,MAAI,YAAa;AACjBA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,QACnD,CAAK;AAAA,MACL,EAAG,CAAC;AAAA,IACJ;AAQA,UAAM,SAAS,YAAY;AACzB,UAAI,CAAC,KAAK,MAAM,MAAM;AAAEA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAM,CAAE;AAAG;AAAA,MAAQ;AACjF,UAAI;AACFA,sBAAAA,MAAI,YAAY,EAAE,OAAO,SAAQ,CAAE;AAEnC,cAAM,aAAa;AAAA,UACjB,MAAM,KAAK,MAAM;AAAA,UACjB,MAAM,KAAK,MAAM;AAAA,UACjB,aAAa,KAAK,MAAM;AAAA,UACxB,MAAM,KAAK,MAAM;AAAA,UACjB,SAAS,KAAK,MAAM;AAAA,UACpB,SAAS,KAAK,MAAM;AAAA,QACrB;AACD,cAAM,MAAM,MAAM,MAAM,KAAK,KAAK,WAAW,KAAK,MAAM,IAAI,UAAU;AACtEA,sBAAAA,MAAI,YAAa;AACjB,YAAI,IAAI,SAAS,KAAK;AACpBA,wBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,WAAW;AAChD,qBAAW,MAAM;AACfA,gCAAI,WAAW,EAAE,KAAK,yBAAyB,KAAK,MAAM,EAAE,IAAI;AAAA,UACjE,GAAE,GAAG;AAAA,QACZ,OAAW;AACLA,8BAAI,UAAU,EAAE,OAAO,IAAI,WAAW,QAAQ,MAAM,QAAQ;AAAA,QAC7D;AAAA,MACF,SAAQ,GAAG;AACVA,sBAAAA,MAAI,YAAa;AACjBA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,QAAQ;AAAA,MAC9C;AAAA,IACH;AAGA,UAAM,SAAS,MAAM;AACnBA,oBAAAA,MAAI,aAAc;AAAA,IACpB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACjJA,GAAG,WAAW,eAAe;"}