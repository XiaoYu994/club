{"version":3,"file":"recruitment.js","sources":["pages/club/recruitment.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY2x1Yi9yZWNydWl0bWVudC52dWU"],"sourcesContent":["<template>\n  <view class=\"recruitment-container pageBg\">\n    <!-- 顶部导航 -->\n    <custom-nav-bar title=\"社团招新\" :showBack=\"true\" @backClick=\"goBack\"></custom-nav-bar>\n    \n    <!-- 搜索欄 -->\n    <view class=\"search-bar\">\n      <view class=\"search-input\">\n        <uni-icons type=\"search\" size=\"16\" color=\"#999\"></uni-icons>\n        <input \n          type=\"text\" \n          v-model=\"searchKeyword\" \n          placeholder=\"搜索社团\" \n          confirm-type=\"search\"\n          @confirm=\"searchClubs\"\n        />\n      </view>\n    </view>\n    \n    <!-- 筛选标签 -->\n    <scroll-view class=\"filter-tabs\" scroll-x>\n      <view \n        v-for=\"(tag, idx) in filterTags\" \n        :key=\"idx\" \n        :class=\"['tag-item', currentTag === idx ? 'active' : '']\"\n        @tap=\"switchTag(idx)\"\n      >\n        {{ tag.name }}\n      </view>\n    </scroll-view>\n    \n    <!-- 社團列表 -->\n    <scroll-view \n      scroll-y \n      class=\"clubs-list\"\n      refresher-enabled\n      :refresher-triggered=\"refreshing\"\n      @refresherrefresh=\"refreshClubs\"\n      @scrolltolower=\"loadMore\"\n      :show-scrollbar=\"false\"\n      enhanced\n    >\n      <view class=\"list-container\">\n        <!-- 社團卡片 -->\n        <view \n          v-for=\"(item, idx) in clubList\" \n          :key=\"idx\" \n          class=\"club-card\"\n          @tap=\"goToApply(item)\"\n        >\n          <image class=\"club-logo\" :src=\"item.logo || '/static/images/default-club.png'\" mode=\"aspectFill\"></image>\n          <view class=\"club-info\">\n            <view class=\"club-title\">{{ item.name }}</view>\n            <view class=\"club-desc\">{{ item.description || '暂无简介' }}</view>\n            <view class=\"club-meta\">\n              <view class=\"meta-item\">\n                <uni-icons type=\"calendar\" size=\"14\" color=\"#666\"></uni-icons>\n                <text>招新截止: {{ item.endTime ? formatDate(item.endTime) : '暂无' }}</text>\n              </view>\n              <view class=\"meta-item\">\n                <uni-icons type=\"personadd\" size=\"14\" color=\"#666\"></uni-icons>\n                <text>已有 {{ item.memberCount || 0 }} 人加入</text>\n              </view>\n            </view>\n            <view class=\"club-tags\">\n              <view class=\"tag\" v-for=\"(tag, tagIdx) in (item.tags ? item.tags.split(',') : [])\" :key=\"tagIdx\">\n                {{ tag }}\n              </view>\n            </view>\n          </view>\n        </view>\n        \n        <!-- 加載狀態 -->\n        <view v-if=\"isLoading\" class=\"loading-more\">\n          <uni-icons type=\"spinner-cycle\" size=\"20\" color=\"#999\"></uni-icons>\n          <text>加载中...</text>\n        </view>\n        \n        <!-- 無數據提示 -->\n        <view v-if=\"clubList.length === 0 && !isLoading\" class=\"empty-data\">\n          <image src=\"/static/images/empty-club.png\" mode=\"aspectFit\"></image>\n          <text>暂无招新社团</text>\n        </view>\n        \n        <!-- 加載完畢提示 -->\n        <view v-if=\"clubList.length > 0 && !hasMore\" class=\"no-more\">\n          <text>没有更多了</text>\n        </view>\n      </view>\n    </scroll-view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, onMounted, getCurrentInstance } from 'vue'\nimport { formatDate } from '@/utils/common.js'\n\nconst { proxy } = getCurrentInstance()\n\n// 搜索關鍵字\nconst searchKeyword = ref('')\n\n// 當前選中的標籤\nconst currentTag = ref(0)\n\n// 篩選標籤\nconst filterTags = ref([\n  { name: '全部社团', type: 'all' },\n  { name: '普通社团', type: 'normal' },\n  { name: '院级社团', type: 'college' },\n  { name: '校级社团', type: 'school' }\n])\n\n// 列表數據\nconst clubList = ref([])\nconst page = ref(1)\nconst pageSize = ref(10)\nconst hasMore = ref(true)\nconst isLoading = ref(false)\nconst refreshing = ref(false)\n\n// 加载招新详情到列表\nonMounted(() => {\n  loadClubs()\n})\n\n// 加載社團列表\nconst loadClubs = async () => {\n  if (isLoading.value) return\n  \n  isLoading.value = true\n  \n  try {\n    // 構建查詢參數\n    const params = {\n      pageNo: page.value,\n      pageSize: pageSize.value,\n      keyword: searchKeyword.value,\n      isRecruiting: true // 只查詢正在招新的社團\n    }\n    \n    // 根據當前選中的標籤添加對應的篩選條件\n    if (currentTag.value > 0) {\n      const tagType = filterTags.value[currentTag.value].type\n      if (tagType === 'normal') {\n        params.type = 0\n      } else if (tagType === 'college') {\n        params.type = 1\n      } else if (tagType === 'school') {\n        params.type = 2\n      }\n    }\n    \n    // 調用API獲取數據\n    const res = await proxy.$api.club.getClubList(params)\n    \n    if (res.code === 200) {\n      const clubs = res.data.list || []\n      // 并行获取所有社团的招新详情\n      const clubsWithRecruit = await Promise.all(\n        clubs.map(async item => {\n          const recRes = await proxy.$api.club.getActiveRecruitment(item.id)\n          if (recRes.code === 200 && recRes.data) {\n            item.startTime = recRes.data.startTime\n            item.endTime = recRes.data.endTime\n          }\n          return item\n        })\n      )\n      if (page.value === 1) {\n        clubList.value = clubsWithRecruit\n      } else {\n        clubList.value = [...clubList.value, ...clubsWithRecruit]\n      }\n      hasMore.value = clubsWithRecruit.length === pageSize.value\n      page.value++\n    } else {\n      uni.showToast({\n        title: res.message || '加载失败',\n        icon: 'none'\n      })\n    }\n  } catch (error) {\n    console.error('加載社團列表失敗', error)\n    uni.showToast({\n      title: '網絡異常，請稍後重試',\n      icon: 'none'\n    })\n  } finally {\n    isLoading.value = false\n    refreshing.value = false\n  }\n}\n\n// 刷新社團列表\nconst refreshClubs = () => {\n  refreshing.value = true\n  page.value = 1\n  hasMore.value = true\n  \n  // 重置搜索關鍵字\n  searchKeyword.value = ''\n  \n  // 重置當前選中的標籤\n  currentTag.value = 0\n  \n  // 重新加載數據\n  loadClubs()\n}\n\n// 加載更多\nconst loadMore = () => {\n  if (hasMore.value && !isLoading.value) {\n    loadClubs()\n  }\n}\n\n// 搜索社團\nconst searchClubs = () => {\n  page.value = 1\n  loadClubs()\n}\n\n// 切換標籤\nconst switchTag = (idx) => {\n  if (currentTag.value === idx) return\n  currentTag.value = idx\n  page.value = 1\n  loadClubs()\n}\n\n// 跳转到社团申请表单\nconst goToApply = (club) => {\n  uni.navigateTo({\n    url: `/pages/club/apply?clubId=${club.id}`\n  })\n}\n\n// 返回上一頁\nconst goBack = () => {\n  uni.navigateBack()\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.recruitment-container {\n  display: flex;\n  flex-direction: column;\n  height: 100vh;\n  \n  .search-bar {\n    padding: 30rpx;\n    display: flex;\n    align-items: center;\n    \n    .search-input {\n      flex: 1;\n      height: 72rpx;\n      background: rgba(255, 255, 255, 0.8);\n      border-radius: 36rpx;\n      display: flex;\n      align-items: center;\n      padding: 0 30rpx;\n      box-shadow: 0 2rpx 12rpx rgba(0,0,0,0.06);\n      \n      input {\n        flex: 1;\n        height: 72rpx;\n        font-size: 28rpx;\n        margin-left: 20rpx;\n      }\n    }\n  }\n  \n  .filter-tabs {\n    height: 80rpx;\n    white-space: nowrap;\n    padding: 0 20rpx;\n    margin: 0 10rpx;\n    \n    .tag-item {\n      display: inline-block;\n      padding: 12rpx 30rpx;\n      font-size: 28rpx;\n      color: #666;\n      margin-right: 20rpx;\n      border-radius: 30rpx;\n      background: rgba(255, 255, 255, 0.8);\n      box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.05);\n      \n      &.active {\n        color: #fff;\n        background: #b13b7a;\n        box-shadow: 0 2rpx 10rpx rgba(177, 59, 122, 0.3);\n      }\n    }\n  }\n  \n  .clubs-list {\n    flex: 1;\n    padding: 20rpx 30rpx;\n    box-sizing: border-box;\n    \n    /* 隱藏滾動條 - 樣式方式 */\n    &::-webkit-scrollbar {\n      width: 0;\n      background: transparent;\n      display: none;\n    }\n    \n    /* 兼容Firefox瀏覽器 */\n    scrollbar-width: none;\n    /* 兼容IE和Edge瀏覽器 */\n    -ms-overflow-style: none;\n    \n    .list-container {\n      padding-bottom: 40rpx;\n      width: 100%;\n    }\n    \n    .club-card {\n      margin-bottom: 30rpx;\n      background: #fff;\n      border-radius: 18rpx;\n      overflow: hidden;\n      box-shadow: 0 2rpx 12rpx rgba(0,0,0,0.08);\n      padding: 24rpx;\n      position: relative;\n      width: 100%;\n      box-sizing: border-box;\n      display: flex;\n      \n      .club-logo {\n        width: 120rpx;\n        height: 120rpx;\n        border-radius: 12rpx;\n        flex-shrink: 0;\n        margin-right: 24rpx;\n        object-fit: cover;\n      }\n      \n      .club-info {\n        flex: 1;\n        overflow: hidden;\n        \n        .club-title {\n          font-size: 32rpx;\n          font-weight: 600;\n          color: #333;\n          margin-bottom: 10rpx;\n          white-space: nowrap;\n          overflow: hidden;\n          text-overflow: ellipsis;\n        }\n        \n        .club-desc {\n          font-size: 26rpx;\n          color: #666;\n          margin-bottom: 16rpx;\n          display: -webkit-box;\n          -webkit-line-clamp: 2;\n          -webkit-box-orient: vertical;\n          overflow: hidden;\n          text-overflow: ellipsis;\n          line-height: 1.4;\n        }\n        \n        .club-meta {\n          display: flex;\n          flex-wrap: wrap;\n          margin-bottom: 16rpx;\n          \n          .meta-item {\n            display: flex;\n            align-items: center;\n            font-size: 24rpx;\n            color: #666;\n            margin-right: 30rpx;\n            margin-bottom: 8rpx;\n            \n            text {\n              margin-left: 8rpx;\n              white-space: nowrap;\n              overflow: hidden;\n              text-overflow: ellipsis;\n            }\n          }\n        }\n        \n        .club-tags {\n          display: flex;\n          flex-wrap: wrap;\n          \n          .tag {\n            padding: 4rpx 16rpx;\n            border-radius: 20rpx;\n            font-size: 22rpx;\n            color: #b13b7a;\n            background: rgba(177, 59, 122, 0.1);\n            margin-right: 16rpx;\n            margin-bottom: 8rpx;\n          }\n        }\n      }\n    }\n    \n    .loading-more {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 30rpx 0;\n      \n      text {\n        font-size: 24rpx;\n        color: #999;\n        margin-left: 10rpx;\n      }\n    }\n    \n    .empty-data {\n      padding: 100rpx 0;\n      text-align: center;\n      \n      image {\n        width: 200rpx;\n        height: 200rpx;\n        margin-bottom: 20rpx;\n        opacity: 0.8;\n      }\n      \n      text {\n        font-size: 28rpx;\n        color: #999;\n      }\n    }\n    \n    .no-more {\n      text-align: center;\n      padding: 30rpx 0;\n      \n      text {\n        font-size: 24rpx;\n        color: #999;\n      }\n    }\n  }\n}\n</style> ","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/club/recruitment.vue'\nwx.createPage(MiniProgramPage)"],"names":["getCurrentInstance","ref","onMounted","uni"],"mappings":"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"}