{"version":3,"file":"edit.js","sources":["pages/admin/notices/edit.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcYWRtaW5cbm90aWNlc1xlZGl0LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"notice-edit-container\">\n    <custom-nav-bar :title=\"isEdit ? '编辑公告' : '发布公告'\" />\n    \n    <!-- 加载中 -->\n    <view v-if=\"loading\" class=\"loading-box\">\n      <uni-icons type=\"spinner-cycle\" size=\"32\" color=\"#2979ff\"></uni-icons>\n      <text>加载中...</text>\n    </view>\n    \n    <!-- 编辑表单 -->\n    <view v-else class=\"notice-form\">\n      <uni-forms ref=\"form\" :modelValue=\"formData\" :rules=\"rules\" labelWidth=\"80px\">\n        <!-- 标题 -->\n        <uni-forms-item label=\"标题\" name=\"title\" required>\n          <uni-easyinput\n            v-model=\"formData.title\"\n            placeholder=\"请输入公告标题\"\n            maxlength=\"50\"\n            trim=\"both\"\n          />\n        </uni-forms-item>\n        \n        <!-- 封面图 -->\n        <uni-forms-item label=\"封面图\" name=\"coverImage\">\n          <view class=\"upload-box\">\n            <view v-if=\"!formData.coverImage\" class=\"upload-btn\" @tap=\"chooseImage\">\n              <uni-icons type=\"image\" size=\"32\" color=\"#999\"></uni-icons>\n              <text>点击上传封面</text>\n            </view>\n            <view v-else class=\"image-preview\">\n              <image :src=\"formData.coverImage\" mode=\"aspectFill\" @tap=\"previewImage\"></image>\n              <view class=\"remove-btn\" @tap.stop=\"removeImage\">\n                <uni-icons type=\"trash\" size=\"20\" color=\"#fff\"></uni-icons>\n              </view>\n            </view>\n          </view>\n        </uni-forms-item>\n        \n        <!-- 内容 -->\n        <uni-forms-item label=\"内容\" name=\"content\" required>\n          <view class=\"editor-container\">\n            <textarea\n              v-model=\"formData.content\"\n              class=\"content-textarea\"\n              placeholder=\"请输入公告内容\"\n              maxlength=\"10000\"\n              :style=\"{ height: editorHeight }\"\n            />\n            <view class=\"character-count\">\n              {{ formData.content.length }}/10000\n            </view>\n          </view>\n        </uni-forms-item>\n        \n        <!-- 公告类型 -->\n        <uni-forms-item label=\"类型\" name=\"type\">\n          <uni-data-select \n            v-model=\"formData.type\" \n            :localdata=\"typeOptions\"\n            :clear=\"false\"\n            placeholder=\"请选择公告类型\"\n          />\n        </uni-forms-item>\n        \n        <!-- 是否置顶 -->\n        <uni-forms-item label=\"置顶\" name=\"isTop\">\n          <switch \n            :checked=\"formData.isTop === 1\" \n            @change=\"onTopChange\"\n            color=\"#2979ff\"\n          />\n        </uni-forms-item>\n      </uni-forms>\n      \n      <!-- 表单操作 -->\n      <view class=\"form-actions\">\n        <button class=\"action-btn cancel-btn\" @tap=\"goBack\">取消</button>\n        <button class=\"action-btn confirm-btn\" :disabled=\"submitting\" @tap=\"submitForm\">\n          {{ submitting ? '提交中...' : (isEdit ? '保存修改' : '发布公告') }}\n        </button>\n      </view>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, computed, onMounted } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport apiModule from '@/api/api.js';\n\n// 公告ID\nconst noticeId = ref(null);\n// 是否是编辑模式\nconst isEdit = computed(() => !!noticeId.value);\n// 加载状态\nconst loading = ref(false);\n// 提交状态\nconst submitting = ref(false);\n// 表单引用\nconst form = ref(null);\n// 编辑器高度\nconst editorHeight = ref('300px');\n// 表单数据\nconst formData = reactive({\n  title: '',\n  content: '',\n  coverImage: '',\n  type: 0,\n  isTop: 0\n});\n\n// 公告类型选项\nconst typeOptions = ref([\n  { value: 0, text: '普通公告' },\n  { value: 1, text: '重要公告' },\n  { value: 2, text: '紧急公告' }\n]);\n\n// 表单验证规则\nconst rules = {\n  title: {\n    rules: [\n      { required: true, errorMessage: '请输入公告标题' },\n      { minLength: 2, maxLength: 50, errorMessage: '标题长度应在2-50个字符之间' }\n    ]\n  },\n  content: {\n    rules: [\n      { required: true, errorMessage: '请输入公告内容' },\n      { minLength: 5, errorMessage: '内容不能少于5个字符' }\n    ]\n  }\n};\n\n// 添加onLoad生命周期钩子\nonLoad((options) => {\n  console.log('onLoad options:', options);\n  if (options && options.id) {\n    noticeId.value = options.id;\n    console.log('Setting noticeId in onLoad to:', noticeId.value);\n    // 加载公告详情\n    loadNoticeDetail();\n  }\n});\n\n// 页面加载\nonMounted(() => {\n  // 验证管理员登录状态\n  const token = uni.getStorageSync('adminToken');\n  if (!token) {\n    uni.reLaunch({\n      url: '/pages/admin/login'\n    });\n    return;\n  }\n  \n  // 适配屏幕高度设置编辑器高度\n  uni.getSystemInfo({\n    success: (res) => {\n      const windowHeight = res.windowHeight;\n      // 设置编辑器高度为屏幕高度的40%\n      editorHeight.value = windowHeight * 0.4 + 'px';\n    }\n  });\n});\n\n/**\n * @description 加载公告详情\n */\nconst loadNoticeDetail = async () => {\n  loading.value = true;\n  try {\n    const response = await apiModule.admin.notice.getNoticeDetail(noticeId.value);\n    console.log('Notice detail response:', response);\n    \n    if (response.code === 200 && response.data) {\n      const detail = response.data;\n      \n      // 填充表单数据\n      formData.title = detail.title || '';\n      formData.content = detail.content || '';\n      formData.coverImage = detail.coverImage || '';\n      formData.type = detail.type || 0;\n      formData.isTop = detail.isTop || 0;\n      \n    } else {\n      uni.showToast({\n        title: response.message || '获取公告详情失败',\n        icon: 'none'\n      });\n      setTimeout(() => {\n        goBack();\n      }, 1500);\n    }\n  } catch (error) {\n    console.error('获取公告详情失败:', error);\n    uni.showToast({\n      title: '获取公告详情失败，请重试',\n      icon: 'none'\n    });\n    setTimeout(() => {\n      goBack();\n    }, 1500);\n  } finally {\n    loading.value = false;\n  }\n};\n\n/**\n * @description 选择封面图片\n */\nconst chooseImage = () => {\n  uni.chooseImage({\n    count: 1,\n    sizeType: ['compressed'],\n    sourceType: ['album', 'camera'],\n    success: (res) => {\n      // 上传图片\n      uploadImage(res.tempFilePaths[0]);\n    }\n  });\n};\n\n/**\n * @description 上传图片\n */\nconst uploadImage = async (filePath) => {\n  uni.showLoading({\n    title: '上传中...'\n  });\n  \n  try {\n    const res = await apiModule.common.upload(filePath);\n    \n    if (res && res.code === 200) {\n      formData.coverImage = res.data;\n      uni.hideLoading();\n      uni.showToast({\n        title: '上传成功',\n        icon: 'success'\n      });\n    } else {\n      uni.hideLoading();\n      uni.showToast({\n        title: res?.message || '上传失败',\n        icon: 'none'\n      });\n    }\n  } catch (error) {\n    console.error('上传图片失败:', error);\n    uni.hideLoading();\n    uni.showToast({\n      title: '上传失败，请重试',\n      icon: 'none'\n    });\n  }\n};\n\n/**\n * @description 预览图片\n */\nconst previewImage = () => {\n  if (formData.coverImage) {\n    uni.previewImage({\n      urls: [formData.coverImage],\n      current: 0\n    });\n  }\n};\n\n/**\n * @description 移除图片\n */\nconst removeImage = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确定要移除封面图片吗？',\n    success: (res) => {\n      if (res.confirm) {\n        formData.coverImage = '';\n      }\n    }\n  });\n};\n\n/**\n * @description 提交表单\n */\nconst submitForm = () => {\n  form.value.validate().then(async (res) => {\n    if (res) {\n      submitting.value = true;\n      \n      try {\n        let response;\n        \n        // 编辑模式\n        if (isEdit.value) {\n          response = await apiModule.admin.notice.updateNotice(noticeId.value, formData);\n        } \n        // 创建模式\n        else {\n          response = await apiModule.admin.notice.createNotice(formData);\n        }\n        \n        if (response.code === 200) {\n          uni.showToast({\n            title: isEdit.value ? '修改成功' : '发布成功',\n            icon: 'success'\n          });\n          \n          // 返回上一页\n          setTimeout(() => {\n            goBack();\n          }, 1500);\n        } else {\n          uni.showToast({\n            title: response.message || (isEdit.value ? '修改失败' : '发布失败'),\n            icon: 'none'\n          });\n        }\n      } catch (error) {\n        console.error(isEdit.value ? '修改公告失败:' : '发布公告失败:', error);\n        uni.showToast({\n          title: isEdit.value ? '修改失败，请重试' : '发布失败，请重试',\n          icon: 'none'\n        });\n      } finally {\n        submitting.value = false;\n      }\n    }\n  });\n};\n\n/**\n * @description 处理置顶开关变化\n */\nconst onTopChange = (e) => {\n  formData.isTop = e.detail.value ? 1 : 0;\n};\n\n/**\n * @description 返回上一页\n */\nconst goBack = () => {\n  uni.navigateBack();\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.notice-edit-container {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding-bottom: 40rpx;\n}\n\n.loading-box {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  height: 50vh;\n  \n  text {\n    margin-top: 20rpx;\n    color: #999;\n    font-size: 28rpx;\n  }\n}\n\n.notice-form {\n  padding: 30rpx;\n  \n  :deep(.uni-forms) {\n    background-color: #fff;\n    border-radius: 12rpx;\n    padding: 20rpx;\n    box-shadow: 0 2rpx 10rpx rgba(0, 0, 0, 0.05);\n    margin-bottom: 30rpx;\n    \n    .uni-forms-item {\n      padding: 15rpx 0;\n      \n      .uni-forms-item__label {\n        font-size: 28rpx;\n        color: #333;\n        font-weight: 500;\n      }\n      \n      .uni-easyinput,\n      .uni-easyinput__content-input {\n        height: 80rpx;\n      }\n      \n      .uni-easyinput__content-input {\n        font-size: 28rpx;\n      }\n    }\n  }\n  \n  .upload-box {\n    width: 100%;\n    \n    .upload-btn {\n      width: 300rpx;\n      height: 200rpx;\n      border: 2rpx dashed #ddd;\n      border-radius: 8rpx;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      background-color: #f9f9f9;\n      \n      text {\n        margin-top: 15rpx;\n        font-size: 24rpx;\n        color: #999;\n      }\n    }\n    \n    .image-preview {\n      position: relative;\n      width: 300rpx;\n      height: 200rpx;\n      border-radius: 8rpx;\n      overflow: hidden;\n      \n      image {\n        width: 100%;\n        height: 100%;\n      }\n      \n      .remove-btn {\n        position: absolute;\n        right: 10rpx;\n        top: 10rpx;\n        width: 50rpx;\n        height: 50rpx;\n        background-color: rgba(0, 0, 0, 0.5);\n        border-radius: 25rpx;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n    }\n  }\n  \n  .editor-container {\n    position: relative;\n    width: 100%;\n    border: 1rpx solid #ddd;\n    border-radius: 8rpx;\n    \n    .content-textarea {\n      width: 100%;\n      padding: 20rpx;\n      font-size: 28rpx;\n      color: #333;\n      line-height: 1.6;\n      box-sizing: border-box;\n    }\n    \n    .character-count {\n      position: absolute;\n      right: 20rpx;\n      bottom: 10rpx;\n      font-size: 24rpx;\n      color: #999;\n    }\n  }\n  \n  .form-actions {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 30rpx;\n    padding: 0 30rpx;\n    \n    .action-btn {\n      width: 45%;\n      height: 80rpx;\n      line-height: 80rpx;\n      font-size: 32rpx;\n      border-radius: 40rpx;\n      \n      &.cancel-btn {\n        color: #666;\n        background-color: #f0f0f0;\n        border: 1rpx solid #ddd;\n      }\n      \n      &.confirm-btn {\n        color: #fff;\n        background-color: #2979ff;\n        box-shadow: 0 4rpx 8rpx rgba(41, 121, 255, 0.2);\n        \n        &:active {\n          transform: scale(0.98);\n        }\n        \n        &:disabled {\n          opacity: 0.6;\n        }\n      }\n    }\n  }\n}\n</style> ","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/admin/notices/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","computed","reactive","onLoad","uni","onMounted","apiModule"],"mappings":"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"}