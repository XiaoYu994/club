{"version":3,"file":"index.js","sources":["pages/admin/index.vue","../../../../../Software/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcYWRtaW5caW5kZXgudnVl"],"sourcesContent":["<template>\n  <view class=\"admin-index pageBg\">\n    <custom-nav-bar title=\"系统管理控制台\">\n    </custom-nav-bar>\n    \n    <!-- 数据概览 -->\n    <view class=\"data-overview\">\n      <view class=\"data-card\" @tap=\"navigateTo('/pages/admin/users')\">\n        <view class=\"card-value\">{{ statistics.userCount || 0 }}</view>\n        <view class=\"card-title\">\n          <uni-icons type=\"person\" size=\"22\" color=\"#2979ff\"></uni-icons>\n          <text>用户总数</text>\n        </view>\n      </view>\n      <view class=\"data-card\" @tap=\"navigateTo('/pages/admin/clubs')\">\n        <view class=\"card-value\">{{ statistics.clubCount || 0 }}</view>\n        <view class=\"card-title\">\n          <uni-icons type=\"flag\" size=\"22\" color=\"#2979ff\"></uni-icons>\n          <text>社团总数</text>\n        </view>\n      </view>\n      <view class=\"data-card\" @tap=\"navigateTo('/pages/admin/activities')\">\n        <view class=\"card-value\">{{ statistics.activityCount || 0 }}</view>\n        <view class=\"card-title\">\n          <uni-icons type=\"calendar\" size=\"22\" color=\"#2979ff\"></uni-icons>\n          <text>活动总数</text>\n        </view>\n      </view>\n      <view class=\"data-card\" @tap=\"navigateTo('/pages/admin/notices')\">\n        <view class=\"card-value\">{{ statistics.noticeCount || 0 }}</view>\n        <view class=\"card-title\">\n          <uni-icons type=\"notification\" size=\"22\" color=\"#2979ff\"></uni-icons>\n          <text>公告总数</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 管理功能区 -->\n    <view class=\"module-section\">\n      <view class=\"section-title\">管理功能</view>\n      <view class=\"module-grid\">\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/users')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"personadd\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">用户管理</text>\n        </view>\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/clubs')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"flag\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">社团管理</text>\n        </view>\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/activities')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"calendar\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">活动管理</text>\n        </view>\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/notices')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"notification\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">公告管理</text>\n        </view>\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/recruitment/configs')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"paperplane\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">招新配置</text>\n        </view>\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/recruitment/audit')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"checkmarkempty\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">招新审核</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 管理员设置区 -->\n    <view class=\"module-section\">\n      <view class=\"section-title\">管理员设置</view>\n      <view class=\"module-grid\">\n        <!-- 超级管理员才能看到的功能 -->\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/admins')\" v-if=\"isSuper\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"staff\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">管理员</text>\n        </view>\n        <!-- 移动过来的修改密码 -->\n        <view class=\"module-item\" @tap=\"navigateTo('/pages/admin/password')\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"locked\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">修改密码</text>\n        </view>\n        <!-- 新增退出登录按钮 -->\n        <view class=\"module-item\" @tap=\"confirmLogout\">\n          <view class=\"module-icon\">\n            <uni-icons type=\"close\" size=\"38\" color=\"#2979ff\"></uni-icons>\n          </view>\n          <text class=\"module-name\">退出登录</text>\n        </view>\n      </view>\n    </view>\n    \n    <!-- 最近公告 -->\n    <view class=\"notice-section\">\n      <view class=\"section-title\">最近公告</view>\n      <view class=\"notice-list\" v-if=\"notices.length > 0\">\n        <view class=\"notice-card\" v-for=\"(item, index) in notices\" :key=\"index\" >\n          <view class=\"notice-title\">{{ item.title }}</view>\n          <view class=\"notice-date\">{{ formatDate(item.createTime) }}</view>\n        </view>\n      </view>\n      <view class=\"empty-tip\" v-else>\n        <text>暂无公告数据</text>\n      </view>\n    </view>\n    <!-- 管理员菜单弹出层 -->\n    <uni-popup ref=\"adminMenuPopup\" type=\"bottom\">\n      <view class=\"admin-menu\">\n        <view class=\"menu-item\" @tap=\"modifyPassword\">\n          <uni-icons type=\"locked\" size=\"20\" color=\"#666\"></uni-icons>\n          <text>修改密码</text>\n        </view>\n        <view class=\"menu-item\" @tap=\"handleLogout\">\n          <uni-icons type=\"poweroff\" size=\"20\" color=\"#666\"></uni-icons>\n          <text>退出登录</text>\n        </view>\n        <view class=\"menu-cancel\" @tap=\"closeAdminMenu\">取消</view>\n      </view>\n    </uni-popup>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue';\nimport { onShow } from '@dcloudio/uni-app';\nimport apiModule from '@/api/api.js';\n\n// 数据统计\nconst statistics = reactive({\n  userCount: 0,\n  clubCount: 0,\n  activityCount: 0,\n  noticeCount: 0\n});\n\n// 最近公告\nconst notices = ref([]);\n\n// 新增\n// 判断是否为超级管理员\nconst isSuper = ref(false);\n\n// 防止重复请求的标志\nconst isInitialLoadDone = ref(false);\n\n// 弹出层引用\nconst adminMenuPopup = ref(null);\n\n/**\n * @description 获取统计数据\n */\nconst loadStatistics = async () => {\n  try {\n    const response = await apiModule.admin.getStatistics();\n    if (response.code === 200) {\n      Object.assign(statistics, response.data);\n    }\n  } catch (error) {\n    console.error('获取统计数据失败:', error);\n  }\n};\n\n/**\n * @description 获取最近公告\n */\nconst loadRecentNotices = async () => {\n  try {\n    const response = await apiModule.admin.getRecentNotices();\n    if (response.code === 200) {\n      notices.value = response.data || [];\n    }\n  } catch (error) {\n    console.error('获取最近公告失败:', error);\n  }\n};\n\n/**\n * @description 页面导航\n */\nconst navigateTo = (url) => {\n  uni.navigateTo({ url });\n};\n\n\n/**\n * @description 显示管理员菜单\n */\nconst showAdminMenu = () => {\n  adminMenuPopup.value.open();\n};\n\n/**\n * @description 关闭管理员菜单\n */\nconst closeAdminMenu = () => {\n  adminMenuPopup.value.close();\n};\n\n/**\n * @description 修改密码\n */\nconst modifyPassword = () => {\n  closeAdminMenu();\n  navigateTo('/pages/admin/password');\n};\n\n/**\n * @description 管理员退出登录\n */\nconst confirmLogout = () => {\n  uni.showModal({\n    title: '提示',\n    content: '确认退出登录？',\n    success: function(res) {\n      if (res.confirm) {\n        // 清除管理员登录信息\n        uni.removeStorageSync('adminToken');\n        uni.removeStorageSync('adminInfo');\n        \n        // 跳转到登录页\n        uni.reLaunch({\n          url: '/pages/admin/login'\n        });\n      }\n    }\n  });\n};\n\n/**\n * @description 格式化日期\n */\nconst formatDate = (timestamp) => {\n  if (!timestamp) return '';\n  \n  // 确保时间戳是数字类型\n  const time = parseInt(timestamp);\n  if (isNaN(time)) return '';\n  \n  const d = new Date(time);\n  \n  // 检查日期对象是否有效\n  if (isNaN(d.getTime())) return '';\n  \n  const year = d.getFullYear();\n  const month = (d.getMonth() + 1).toString().padStart(2, '0');\n  const day = d.getDate().toString().padStart(2, '0');\n  return `${year}-${month}-${day}`;\n};\n\n// 页面加载\nonMounted(() => {\n  // 检查管理员是否已登录\n  const token = uni.getStorageSync('adminToken');\n  if (!token) {\n    uni.reLaunch({\n      url: '/pages/admin/login'\n    });\n    return;\n  }\n  \n  // 检查是否为超级管理员\n  const adminInfo = uni.getStorageSync('adminInfo');\n  if (adminInfo && adminInfo.type === 1) {\n    isSuper.value = true;\n  }\n  \n  loadStatistics();\n  loadRecentNotices();\n  isInitialLoadDone.value = true;\n});\n\n// 每次显示页面时刷新数据\nonShow(() => {\n  // 如果初次加载已完成，才执行刷新，避免重复请求\n  if (isInitialLoadDone.value) {\n    loadStatistics();\n    loadRecentNotices();\n  }\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.admin-index {\n  min-height: 100vh;\n  background-color: #f5f5f5;\n  padding-bottom: 40rpx;\n  position: relative;\n}\n\n.admin-avatar-btn {\n  display: flex;\n  align-items: center;\n  margin-right: 8rpx;\n  .admin-avatar {\n    width: 48rpx;\n    height: 48rpx;\n    border-radius: 50%;\n    box-shadow: 0 2rpx 8rpx rgba(41,121,255,0.08);\n    border: 2rpx solid #fff;\n  }\n}\n\n.data-overview {\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: space-between;\n  padding: 40rpx 24rpx 0 24rpx;\n  gap: 32rpx 0;\n  .data-card {\n    width: 48%;\n    background: #fff;\n    border-radius: 24rpx;\n    box-shadow: 0 4rpx 24rpx rgba(41,121,255,0.08);\n    padding: 38rpx 0 32rpx 0;\n    margin-bottom: 0;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    transition: box-shadow 0.2s;\n    &:active {\n      box-shadow: 0 8rpx 32rpx rgba(41,121,255,0.18);\n    }\n    .card-value {\n      font-size: 54rpx;\n      font-weight: 700;\n      color: #2979ff;\n      margin-bottom: 12rpx;\n    }\n    .card-title {\n      display: flex;\n      align-items: center;\n      color: #666;\n      font-size: 28rpx;\n      text {\n        margin-left: 10rpx;\n      }\n    }\n  }\n}\n\n.module-section {\n  margin: 48rpx 24rpx 0 24rpx;\n  background-color: #fff;\n  border-radius: 24rpx;\n  padding: 36rpx 0 24rpx 0;\n  box-shadow: 0 4rpx 24rpx rgba(41,121,255,0.08);\n  .section-title {\n    font-size: 30rpx;\n    font-weight: bold;\n    color: #2979ff;\n    margin-bottom: 32rpx;\n    padding-left: 32rpx;\n    border-left: 6rpx solid #2979ff;\n  }\n  .module-grid {\n    display: flex;\n    justify-content: space-around;\n    align-items: center;\n    .module-item {\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      .module-icon {\n        width: 104rpx;\n        height: 104rpx;\n        background: linear-gradient(135deg, #e3f0ff 0%, #f5faff 100%);\n        border-radius: 50%;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        margin-bottom: 12rpx;\n        box-shadow: 0 2rpx 12rpx rgba(41,121,255,0.08);\n      }\n      .module-name {\n        font-size: 28rpx;\n        color: #222;\n        font-weight: 600;\n      }\n    }\n  }\n}\n\n.notice-section {\n  margin: 48rpx 24rpx 0 24rpx;\n  background-color: #fff;\n  border-radius: 24rpx;\n  padding: 36rpx 24rpx 24rpx 24rpx;\n  box-shadow: 0 4rpx 24rpx rgba(41,121,255,0.08);\n  .section-title {\n    font-size: 30rpx;\n    font-weight: bold;\n    color: #2979ff;\n    margin-bottom: 32rpx;\n    padding-left: 32rpx;\n    border-left: 6rpx solid #2979ff;\n  }\n  .notice-list {\n    .notice-card {\n      background: #f8faff;\n      border-radius: 16rpx;\n      padding: 28rpx 24rpx;\n      margin-bottom: 18rpx;\n      box-shadow: 0 2rpx 8rpx rgba(41,121,255,0.04);\n      .notice-title {\n        font-size: 28rpx;\n        color: #222;\n        font-weight: 600;\n        margin-bottom: 8rpx;\n      }\n      .notice-date {\n        font-size: 22rpx;\n        color: #aaa;\n      }\n    }\n  }\n  .empty-tip {\n    padding: 40rpx 0;\n    text-align: center;\n    color: #bbb;\n    font-size: 26rpx;\n  }\n}\n\n.admin-menu {\n  background-color: #fff;\n  border-radius: 16rpx 16rpx 0 0;\n  overflow: hidden;\n  .menu-item {\n    display: flex;\n    align-items: center;\n    padding: 30rpx;\n    border-bottom: 1rpx solid #eee;\n    text {\n      margin-left: 20rpx;\n      font-size: 28rpx;\n      color: #333;\n    }\n    &.logout text {\n      color: #dd524d;\n    }\n  }\n  .menu-cancel {\n    padding: 30rpx;\n    text-align: center;\n    font-size: 28rpx;\n    color: #333;\n    background-color: #f5f5f5;\n  }\n}\n</style> ","import MiniProgramPage from 'D:/CODE/capstone-project/club-master/club/club_uniapp/pages/admin/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","ref","apiModule","uni","onMounted","onShow"],"mappings":"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"}