# 社团招新小程序数据库文档

## 数据库表结构

### 1. 社团信息表 (club_info)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| name | varchar(100) | 否 | | 社团名称 |
| logo | varchar(255) | 是 | null | 社团logo |
| description | text | 是 | null | 社团简介 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| order_num | int | 否 | 9999 | 排序号 |
| type | int | 否 | 0 | 社团类型 0=普通社团 1=院级社团 2=校级社团 |
| member_count | int | 否 | 0 | 社团成员数 |
| join_count | int | 否 | 0 | 申请加入数 |
| view_count | int | 否 | 0 | 浏览量 |
| address | varchar(255) | 是 | null | 社团地址 |
| contact | varchar(100) | 是 | null | 联系方式 |
| create_user_id | int | 否 | 0 | 创建人ID(系统管理员) |
| forms | longtext | 是 | null | 社团自定义表单 |
| ext_json | longtext | 是 | null | 社团扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_name` (`name`) COMMENT '社团名称唯一索引'

### 2. 社团成员表 (club_member)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| user_id | int | 否 | | 用户ID |
| club_id | int | 否 | | 社团ID |
| type | int | 否 | 0 | 成员类型 0=普通成员 1=干部 2=社长 3=指导老师 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 2=退社申请中 |
| join_time | bigint | 否 | 0 | 加入时间 |
| quit_time | bigint | 否 | 0 | 退出时间 |
| position | varchar(50) | 是 | null | 职位名称 |
| department | varchar(50) | 是 | null | 部门 |
| intro | text | 是 | null | 个人简介 |
| ext_json | longtext | 是 | null | 成员扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_user_club` (`user_id`, `club_id`)

### 3. 社团招新表 (club_recruitment)

存储社团发布的招新信息。

**字段说明：**

| 字段名 | 类型 | 必填 | 默认值 | 说明 |
| ------ | --- | ---- | ----- | ---- |
| id | int | 是 | 自增 | 招新ID |
| club_id | int | 是 | | 社团ID |
| config_id | int | 否 | null | 招新配置ID |
| title | varchar(255) | 是 | | 招新标题 |
| description | text | 否 | | 招新描述 |
| status | int | 是 | 0 | 状态 0=审核中 1=进行中 2=已结束 3=已驳回 |
| start_time | bigint | 是 | 0 | 开始时间 |
| end_time | bigint | 是 | 0 | 结束时间 |
| plan_count | int | 是 | 0 | 计划招收人数 |
| join_count | int | 是 | 0 | 已申请人数 |
| pass_count | int | 是 | 0 | 已通过人数 |
| need_interview | int | 是 | 0 | 是否需要面试 0=不需要 1=需要 |
| poster | varchar(255) | 否 | | 招新海报 |
| forms | longtext | 是 | | 招新表单JSON |
| review_comment | text | 否 | | 审核意见 |
| ext_json | longtext | 否 | | 招新扩展信息JSON |
| create_time | bigint | 是 | 0 | 创建时间 |
| update_time | bigint | 是 | 0 | 修改时间 |

**索引：**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)
- INDEX `idx_config_id` (`config_id`)
- UNIQUE INDEX `idx_club_recruitment_title` (`club_id`, `title`) COMMENT '同一社团下招新标题唯一索引'

**说明：**
- `status`字段表示招新状态，改为0=审核中 1=进行中 2=已结束 3=已驳回
- `forms`字段存储JSON格式的表单定义，支持自定义表单
- 增加`config_id`字段关联到招新配置表，保证招新活动符合学校统一规定的时间
- 增加`review_comment`字段用于存储管理员审核意见

### 3.1 招新配置表 (club_recruitment_config)

存储系统管理员设置的全校统一招新时间配置。

**字段说明：**

| 字段名 | 类型 | 必填 | 默认值 | 说明 |
| ------ | --- | ---- | ----- | ---- |
| id | int | 是 | 自增 | 配置ID |
| name | varchar(100) | 是 | | 配置名称 |
| semester | varchar(50) | 是 | | 学期(如2023-2024-1) |
| global_start_time | bigint | 是 | 0 | 全局招新开始时间 |
| global_end_time | bigint | 是 | 0 | 全局招新结束时间 |
| status | int | 是 | 1 | 状态 0=禁用 1=启用 |
| type_config | longtext | 否 | | 社团类型配置JSON |
| description | varchar(255) | 否 | | 配置说明 |
| create_user_id | int | 是 | 0 | 创建人ID |
| create_time | bigint | 是 | 0 | 创建时间 |
| update_time | bigint | 是 | 0 | 修改时间 |

**索引：**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_semester` (`semester`) COMMENT '学期唯一索引'

**说明：**
- `type_config`字段存储JSON格式的社团类型招新时间配置，例如：
```json
[
  {
    "type": 0,  // 普通社团
    "startTime": 1693584000000,
    "endTime": 1696176000000,
    "name": "普通社团招新时间"
  },
  {
    "type": 1,  // 院级社团
    "startTime": 1696262400000,
    "endTime": 1697472000000,
    "name": "院级社团招新时间"
  }
]
```
- 每学期只能有一个招新配置处于启用状态

### 4. 社团申请表 (club_apply)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| user_id | int | 否 | | 用户ID |
| club_id | int | 否 | | 社团ID |
| recruitment_id | int | 否 | | 招新ID |
| status | int | 否 | 0 | 状态 0=待审核 1=已通过 2=已拒绝 3=已面试 4=已入社 |
| interview_time | bigint | 否 | 0 | 面试时间 |
| interview_place | varchar(255) | 是 | null | 面试地点 |
| interview_note | text | 是 | null | 面试备注 |
| interview_result | text | 是 | null | 面试结果 |
| forms | longtext | 否 | | 申请表单数据JSON |
| feedback | text | 是 | null | 反馈意见 |
| ext_json | longtext | 是 | null | 申请扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_user_recruit` (`user_id`, `recruitment_id`)
- INDEX `idx_club_id` (`club_id`)

### 5. 社团活动表 (club_activity)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| title | varchar(255) | 否 | | 活动标题 |
| description | text | 是 | null | 活动描述 |
| status | int | 否 | 1 | 状态 0=取消 1=计划中 2=进行中 3=已结束 |
| start_time | bigint | 否 | 0 | 开始时间 |
| end_time | bigint | 否 | 0 | 结束时间 |
| address | text | 是 | null | 活动地点 |
| join_count | int | 否 | 0 | 参与人数 |
| view_count | int | 否 | 0 | 浏览量 |
| poster | varchar(255) | 是 | null | 活动海报 |
| forms | longtext | 是 | null | 活动表单JSON |
| ext_json | longtext | 是 | null | 活动扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)

### 5.1 活动报名表 (club_activity_apply)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 报名ID |
| activity_id | int | 否 | | 活动ID |
| user_id | int | 否 | | 用户ID |
| status | int | 否 | 0 | 状态 0=待审核 1=已通过 2=已拒绝 |
| is_member | int | 否 | 0 | 是否为社团成员 0=否 1=是 |
| forms | longtext | 是 | null | 报名表单数据JSON |
| feedback | text | 是 | null | 反馈信息 |
| check_in_status | int | 否 | 0 | 签到状态 0=未签到 1=已签到 |
| check_in_time | bigint | 否 | 0 | 签到时间 |
| ext_json | longtext | 是 | null | 扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_activity_user` (`activity_id`, `user_id`)
- INDEX `idx_user_id` (`user_id`)
- INDEX `idx_activity_id` (`activity_id`)

**说明:**
- `forms`字段存储JSON格式的报名表单数据，对应活动表中定义的表单结构
- `is_member`字段用于区分报名者是否为社团成员，支持面向全校或仅面向社团成员的活动报名
- `check_in_status`和`check_in_time`字段用于记录活动签到情况

### 6. 社团退出申请表 (club_quit)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| user_id | int | 否 | | 用户ID |
| club_id | int | 否 | | 社团ID |
| member_id | int | 否 | | 成员ID |
| reason | text | 是 | null | 退出原因 |
| status | int | 否 | 0 | 状态 0=待审核 1=已通过 2=已拒绝 |
| feedback | text | 是 | null | 反馈意见 |
| ext_json | longtext | 是 | null | 退出扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_user_club` (`user_id`, `club_id`)

### 7. 社团消息表 (club_message)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| user_id | int | 否 | | 发送用户ID |
| type | int | 否 | 0 | 消息类型 0=普通消息 1=通知公告 2=活动通知 |
| content | text | 否 | | 消息内容 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| attachments | text | 是 | null | 附件JSON |
| ext_json | longtext | 是 | null | 消息扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)

### 8. 消息阅读表 (club_message_read)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| message_id | int | 否 | | 消息ID |
| user_id | int | 否 | | 用户ID |
| status | int | 否 | 0 | 状态 0=未读 1=已读 |
| read_time | bigint | 否 | 0 | 阅读时间 |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_message_user` (`message_id`, `user_id`)

### 9. 管理员表 (club_admin)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| username | varchar(200) | 否 | | 管理员名称 |
| password | varchar(255) | 否 | | 密码 |
| description | varchar(255) | 是 | null | 描述 |
| phone | varchar(255) | 是 | null | 手机号 |
| login_count | int | 否 | 0 | 登录次数 |
| type | int | 否 | 0 | 类型 0=普通管理员 1=超级管理员 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| last_login_time | bigint | 否 | 0 | 最后登录时间 |
| permissions | varchar(500) | 是 | null | 系统权限(逗号分隔) |
| ext_json | longtext | 是 | null | 管理员扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_username` (`username`) COMMENT '管理员用户名唯一索引'

### 10. 社团管理员关联表 (club_admin_relation)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| user_id | int | 否 | | 用户ID |
| admin_type | int | 否 | 0 | 管理员类型 0=社团管理员 1=社团超级管理员 |
| permissions | varchar(255) | 是 | null | 权限集合(逗号分隔的权限代码) |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| remark | varchar(255) | 是 | null | 备注 |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |
| operator_id | int | 否 | 0 | 操作人ID(授权人) |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_club_user` (`club_id`, `user_id`)
- INDEX `idx_user_id` (`user_id`)

### 11. 用户表 (club_user)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| username | varchar(255) | 否 | | 用户名称 |
| account | varchar(255) | 否 | | 账号 |
| password | varchar(32) | 否 | | 密码 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| avatar | varchar(255) | 是 | null | 头像 |
| gender | int | 否 | 0 | 性别 0=未知 1=男 2=女 |
| mobile | varchar(50) | 是 | null | 手机号 |
| email | varchar(100) | 是 | null | 邮箱 |
| openid | varchar(100) | 是 | null | 微信OpenID |
| unionid | varchar(100) | 是 | null | 微信UnionID |
| last_login_time | bigint | 否 | 0 | 最后登录时间 |
| login_count | int | 否 | 0 | 登录次数 |
| student_id | varchar(50) | 是 | null | 学号 |
| college | varchar(100) | 是 | null | 学院 |
| major | varchar(100) | 是 | null | 专业 |
| class_name | varchar(100) | 是 | null | 班级 |
| forms | longtext | 是 | null | 用户表单数据JSON |
| ext_json | longtext | 是 | null | 用户扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_account` (`account`)
- UNIQUE INDEX `idx_student_id` (`student_id`) COMMENT '学号唯一索引'
- UNIQUE INDEX `idx_openid` (`openid`) COMMENT '微信OpenID唯一索引'
- UNIQUE INDEX `idx_unionid` (`unionid`) COMMENT '微信UnionID唯一索引'

### 12. 社团部门表 (club_department)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| name | varchar(100) | 否 | | 部门名称 |
| description | text | 是 | null | 部门描述 |
| order_num | int | 否 | 9999 | 排序号 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| member_count | int | 否 | 0 | 成员数量 |
| ext_json | longtext | 是 | null | 部门扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)
- UNIQUE INDEX `idx_club_dept_name` (`club_id`, `name`) COMMENT '同一社团下部门名称唯一索引'

### 13. 社团通知公告表 (club_notice)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| title | varchar(255) | 否 | | 通知标题 |
| content | text | 否 | | 通知内容 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| type | int | 否 | 0 | 类型 0=普通通知 1=重要通知 |
| view_count | int | 否 | 0 | 浏览量 |
| ext_json | longtext | 是 | null | 通知扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)
- UNIQUE INDEX `idx_club_notice_title` (`club_id`, `title`) COMMENT '同一社团下通知标题唯一索引'

### 14. 系统设置表 (club_setup)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| type | varchar(255) | 否 | | 设置类型 |
| key_name | varchar(255) | 否 | | 设置键 |
| value | longtext | 否 | | 设置值 |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_type_key` (`type`, `key_name`)

### 15. 社团聊天群组表 (club_chat_group)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| club_id | int | 否 | | 社团ID |
| name | varchar(100) | 否 | | 群组名称 |
| type | int | 否 | 0 | 群组类型 0=公共群 1=部门群 2=管理员群 |
| creator_id | int | 否 | | 创建者ID |
| avatar | varchar(255) | 是 | null | 群头像 |
| description | text | 是 | null | 群组描述 |
| status | int | 否 | 1 | 状态 0=禁用 1=正常 |
| member_count | int | 否 | 0 | 成员数量 |
| ext_json | longtext | 是 | null | 扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_club_id` (`club_id`)

### 16. 聊天消息表 (club_chat_message)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| group_id | int | 是 | null | 群组ID(为空表示私聊) |
| sender_id | int | 否 | | 发送者ID |
| receiver_id | int | 是 | null | 接收者ID(私聊时有值) |
| content | text | 否 | | 消息内容 |
| content_type | int | 否 | 0 | 内容类型 0=文本 1=图片 2=语音 3=文件 4=位置 |
| status | int | 否 | 1 | 状态 0=已删除 1=正常 2=已撤回 |
| ref_message_id | int | 是 | null | 引用消息ID(回复某条消息) |
| media_url | varchar(255) | 是 | null | 媒体文件URL |
| media_size | int | 是 | null | 媒体文件大小(KB) |
| read_count | int | 否 | 0 | 已读数量 |
| ext_json | longtext | 是 | null | 扩展信息JSON |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- INDEX `idx_group` (`group_id`)
- INDEX `idx_private` (`sender_id`, `receiver_id`)
- INDEX `idx_create_time` (`create_time`)

### 17. 用户-群组关系表 (club_chat_user_relation)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| user_id | int | 否 | | 用户ID |
| group_id | int | 否 | | 群组ID |
| nickname | varchar(100) | 是 | null | 群内昵称 |
| role | int | 否 | 0 | 角色 0=普通成员 1=管理员 2=群主 |
| mute | int | 否 | 0 | 是否禁言 0=否 1=是 |
| join_time | bigint | 否 | 0 | 加入时间 |
| create_time | bigint | 否 | 0 | 创建时间 |
| update_time | bigint | 否 | 0 | 修改时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_user_group` (`user_id`, `group_id`)

### 18. 消息阅读状态表 (club_chat_read_status)

| 字段名 | 类型 | 是否为空 | 默认值 | 说明 |
| --- | --- | --- | --- | --- |
| id | int | 否 | 自增 | 主键ID |
| user_id | int | 否 | | 用户ID |
| message_id | int | 否 | | 消息ID |
| status | int | 否 | 0 | 状态 0=未读 1=已读 |
| read_time | bigint | 否 | 0 | 阅读时间 |

**索引:**
- PRIMARY KEY (`id`)
- UNIQUE INDEX `idx_user_message` (`user_id`, `message_id`)

## 表关系

### 一对多关系

1. 社团(club_info) → 社团成员(club_member)
   - 一个社团有多个成员

2. 社团(club_info) → 社团招新(club_recruitment)
   - 一对多关系：一个社团可以发布多个招新活动
   - 关联字段：club_recruitment.club_id → club_info.id

3. 招新配置(club_recruitment_config) → 社团招新(club_recruitment)
   - 一对多关系：一个招新配置可以关联多个社团招新活动
   - 关联字段：club_recruitment.config_id → club_recruitment_config.id

4. 社团(club_info) → 社团活动(club_activity)
   - 一个社团可以组织多个活动

5. 社团(club_info) → 社团部门(club_department)
   - 一个社团可以有多个部门

6. 社团(club_info) → 社团通知(club_notice)
   - 一个社团可以发布多个通知

7. 用户(club_user) → 社团成员(club_member)
   - 一个用户可以加入多个社团

8. 用户(club_user) → 社团申请(club_apply)
   - 一个用户可以申请多个社团

9. 用户(club_user) → 消息阅读(club_message_read)
   - 一个用户可以阅读多条消息

10. 社团招新(club_recruitment) → 社团申请(club_apply)
    - 一次招新可以收到多个申请

11. 社团成员(club_member) → 退社申请(club_quit)
    - 一个成员可以申请退社

12. 社团消息(club_message) → 消息阅读(club_message_read)
    - 一条消息可以被多人阅读

13. 社团(club_info) → 社团管理员关联(club_admin_relation)
    - 一个社团可以有多个管理员

14. 用户(club_user) → 社团管理员关联(club_admin_relation)
    - 一个用户可以成为多个社团的管理员

15. 社团(club_info) → 社团聊天群组(club_chat_group)
    - 一个社团可以有多个聊天群组(公共群、部门群、管理员群等)

16. 聊天群组(club_chat_group) → 聊天消息(club_chat_message)
    - 一个群组可以包含多条聊天消息

17. 用户(club_user) → 聊天消息(club_chat_message)
    - 一个用户可以发送多条聊天消息

18. 聊天群组(club_chat_group) → 用户-群组关系(club_chat_user_relation)
    - 一个群组可以有多个成员

19. 用户(club_user) → 用户-群组关系(club_chat_user_relation)
    - 一个用户可以加入多个聊天群组

20. 聊天消息(club_chat_message) → 消息阅读状态(club_chat_read_status)
    - 一条消息可以有多个用户的阅读状态

21. 社团活动(club_activity) → 活动报名(club_activity_apply)
    - 一对多关系：一个活动可以有多人报名
    - 关联字段：club_activity_apply.activity_id → club_activity.id

22. 用户(club_user) → 活动报名(club_activity_apply)
    - 一对多关系：一个用户可以报名多个活动
    - 关联字段：club_activity_apply.user_id → club_user.id

## 业务流程

### 招新流程

1. 系统管理员创建学期招新配置(club_recruitment_config)，设置全局招新时间和各类型社团的招新时间窗口
2. 社团管理员在允许的时间窗口内创建招新活动(club_recruitment)，设置招新表单和要求，并提交审核
3. 系统管理员审核招新信息，确认时间合规性并决定是否通过
4. 学生浏览招新信息，填写申请表单(club_apply)提交申请
5. 社团管理员审核申请，决定是否通过/拒绝/面试
6. 如需面试，安排面试时间和地点，记录面试结果
7. 最终确定录取名单，系统自动将录取学生添加为社团成员(club_member)

### 退社流程

1. 社团成员提交退社申请 (club_quit)
2. 社团管理员审核申请
3. 申请通过后，更新社团成员状态或删除记录

### 社团活动管理

1. 社团管理员创建活动 (club_activity)
2. 社团成员/普通用户浏览活动信息
3. 用户报名参与活动 (club_activity_apply)
4. 社团管理员审核活动报名申请
5. 活动开始时进行签到
6. 活动结束后，更新活动状态

### 活动报名流程

1. **活动创建**
   - 社团管理员创建活动并设置活动信息(时间、地点、描述等)
   - 设置活动是否需要审核、是否仅限社团成员参与
   - 可选择设计自定义报名表单

2. **活动报名**
   - 用户浏览活动信息
   - 填写报名表单提交申请
   - 系统记录用户是否为社团成员

3. **报名审核**
   - 若活动设置为需要审核，管理员审核报名申请
   - 审核通过/拒绝并可添加反馈信息
   - 若无需审核，系统自动通过申请

4. **活动签到**
   - 活动开始时，参与者可通过扫码或输入签到码进行签到
   - 系统记录签到状态和时间
   - 管理员可查看实时签到情况

5. **活动统计**
   - 活动结束后，系统自动统计参与人数、签到率等数据
   - 管理员可查看活动参与情况分析

### 社团内部沟通

1. 社团管理员发布通知 (club_notice)
2. 社团成员发送消息 (club_message)
3. 系统记录消息阅读状态 (club_message_read)

### 社团内部聊天流程

1. **公共群聊流程**
   - 社团创建时自动创建默认公共群
   - 用户加入社团后自动加入社团公共群
   - 用户发送消息后，所有在线群成员实时接收
   - 离线成员下次上线时会收到未读消息提醒

2. **部门群聊流程**
   - 社团管理员可为特定部门创建部门群
   - 部门成员自动加入对应部门群
   - 部门内消息仅在部门成员间传递
   - 支持部门公告、文件共享等功能

3. **私聊流程**
   - 用户从社团成员列表或群成员列表中选择成员发起私聊
   - 系统建立两人之间的私聊会话
   - 消息仅在两人之间传递
   - 私聊记录保存在双方的聊天记录中

4. **多媒体消息处理**
   - 用户可发送图片、语音、文件等多媒体消息
   - 系统自动处理多媒体内容(压缩、转码等)
   - 接收方可预览、下载多媒体内容
   - 系统限制文件大小和类型，防止滥用

5. **消息管理流程**
   - 用户可查看历史消息记录
   - 发送者可在一定时间内撤回消息
   - 群组管理员可管理群内消息(删除、置顶等)
   - 系统自动过滤敏感内容，维护良好聊天环境

## 系统特点

1. **灵活的表单设计**
   - 多处使用forms字段存储JSON格式的表单数据
   - 可自定义招新表单、申请表单等

2. **扩展性设计**
   - 所有表都有ext_json字段，用于存储扩展数据
   - 可以添加新属性而不需要修改表结构

3. **完整的状态管理**
   - 统一的状态字段(status)，用于管理记录状态
   - 完整的时间戳记录(create_time, update_time)

4. **微信小程序支持**
   - 用户表中包含openid和unionid字段
   - 支持微信登录和身份关联 

5. **严格分离的多级管理权限体系**
   - **系统管理员权限**
     - 创建和管理社团基础信息
     - 授予用户对特定社团的管理权限
     - 管理系统全局设置和用户账号
     - 无权参与社团内部事务管理
   - **社团管理员权限**
     - 仅限于管理自己所属社团的内部事务
     - 管理社团招新流程（发布招新、审核申请、安排面试等）
     - 管理社团成员（添加、删除、职位调整等）
     - 管理社团活动和通知
     - 无法干预其他社团的事务
   - **权限隔离机制**
     - 通过club_admin_relation表实现权限隔离
     - 每个操作都会检查操作者与社团的关联关系
     - 使用细粒度的权限控制，可自定义社团管理员的权限范围

6. **数据完整性保障**
   - **唯一性约束设计**
     - 社团名称唯一：确保不同社团之间名称不重复
     - 用户唯一标识：学号、微信OpenID、UnionID等均设置唯一约束
     - 上下文唯一性：同一社团内部门名称、招新标题、通知标题等均设置组合唯一约束
     - 管理员账号唯一：确保管理员用户名不重复
   - **冗余控制**
     - 通过外键关系和唯一索引，最大限度减少数据冗余
     - 支持数据一致性和引用完整性
   - **业务规则保障**
     - 唯一性约束直接在数据库层面实现业务规则
     - 防止错误数据进入系统，提高应用程序稳定性

## 权限流程说明

### 社团创建流程
1. 系统管理员创建社团基础信息(club_info)
2. 系统管理员指定社团初始管理员，在club_admin_relation表中创建关联记录
3. 社团管理员接管社团后续运营管理

### 社团管理员授权流程
1. 系统管理员在club_admin_relation表中为用户创建社团管理权限记录
2. 可设置不同级别的社团管理员(admin_type)和具体权限(permissions)
3. 记录授权操作人(operator_id)以便追踪权限变更

### 招新管理流程
1. 只有社团管理员可以为自己的社团发布招新信息(club_recruitment)
2. 系统通过club_admin_relation表验证用户是否有权限操作特定社团
3. 社团管理员负责审核申请、安排面试、接纳新成员等全部招新流程

### 社团内部管理
1. 社团管理员可管理本社团的部门、成员、活动等
2. 一个用户可以是多个社团的管理员，但权限严格隔离
3. 系统管理员无法干预社团内部事务，除非被特别授予某社团的管理权限 